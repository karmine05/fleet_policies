apiVersion: v1
kind: policy
spec:
  name: CIS - /tmp is a separate partition
  platform: linux
  description: |
    Ensures the world-writable /tmp directory resides on its own filesystem. Separating /tmp limits the blast radius of resource exhaustion (fill, inode consumption) and constrains mount options (nosuid,nodev,noexec) to reduce privilege escalation and execution of malicious binaries. Without isolation, attackers can leverage /tmp on the root filesystem to trigger denial of service or interfere with system files.
  resolution: |
    1. Create a dedicated entry in /etc/fstab (example below uses tmpfs; adjust size to your environment):
       tmpfs  /tmp  tmpfs  defaults,rw,nosuid,nodev,noexec,relatime,size=2G  0  0
    2. Apply immediately:
       sudo mount -o remount /tmp || sudo mount /tmp
    3. Verify: mount | grep ' /tmp '
    4. Add monitoring for unexpected option drift.
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/tmp');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:filesystem, requirement:standard, critical:false, control:tmp-separate-partition, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd installed
  platform: linux
  description: |
    Ensures Linux Audit daemon present enabling recording of security-relevant events (identity changes, privileged command use). Without auditd forensic reconstruction and compliance evidence degrade.
  resolution: |
    1. Install: sudo apt-get install -y auditd audispd-plugins
    2. Enable: sudo systemctl enable --now auditd.service
    3. Verify: systemctl status auditd.service | grep running
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='auditd' AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:audit, requirement:standard, critical:true, control:auditd-installed, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd service enabled and running
  platform: linux
  description: |
    Confirms auditd actively logging events. A disabled service creates blind spots for intrusion detection and compliance reporting.
  resolution: |
    1. Start & enable: sudo systemctl enable --now auditd.service
    2. Check backlog size config for adequate buffering.
    3. Validate: sudo auditctl -s | grep 'enabled'
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM systemd_units WHERE id='auditd.service' AND active_state='active'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:audit, requirement:standard, critical:true, control:auditd-service-active, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd.conf log file size configured
  platform: linux
  description: |
    Ensures max_log_file tuned (e.g., 8â€“32 MB) controlling rotation cadence to balance retention and disk usage. Missing size may cause uncontrolled growth or premature rotation.
  resolution: |
    1. Edit /etc/audit/auditd.conf set max_log_file = 32
    2. Restart auditd: sudo systemctl restart auditd
    3. Verify: grep '^max_log_file' /etc/audit/auditd.conf
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM augeas WHERE path='/files/etc/audit/auditd.conf/max_log_file' AND value!=''
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit, requirement:standard, critical:false, control:auditd-max-log-file-set, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd.conf space actions configured
  platform: linux
  description: |
    Validates space_action and admin_space_left_action define appropriate responses (e.g., rotate, email, halt) when low disk space thresholds reached preventing silent audit failure.
  resolution: |
    1. Edit /etc/audit/auditd.conf values: space_left_action = email; admin_space_left_action = halt
    2. Confirm: grep 'space_left_action' /etc/audit/auditd.conf
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/audit/auditd.conf/space_left_action' AND value!='')
      AND EXISTS (SELECT * FROM augeas WHERE path='/files/etc/audit/auditd.conf/admin_space_left_action' AND value!='');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit, requirement:standard, critical:false, control:auditd-space-actions-configured, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd.conf max_log_file_action set
  platform: linux
  description: |
    Ensures max_log_file_action specifies rotation or syslog so logs continue capturing events when size threshold reached.
  resolution: |
    1. Edit /etc/audit/auditd.conf: max_log_file_action = ROTATE
    2. Restart auditd.
    3. Verify: grep '^max_log_file_action' /etc/audit/auditd.conf
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/audit/auditd.conf/max_log_file_action' AND value!='');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit, requirement:standard, critical:false, control:auditd-max-log-action-set, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd.conf flush interval configured
  platform: linux
  description: |
    Confirms flush (e.g., INCREMENTAL / freq) ensures timely write of buffered events reducing loss in crash scenarios.
  resolution: |
    1. Set flush = INCREMENTAL and freq = 50 in /etc/audit/auditd.conf
    2. Restart auditd.
    3. Verify: grep -E 'flush|freq' /etc/audit/auditd.conf
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/audit/auditd.conf/flush' AND value!='')
      AND EXISTS (SELECT * FROM augeas WHERE path='/files/etc/audit/auditd.conf/freq' AND value!='');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit, requirement:standard, critical:false, control:auditd-flush-configured, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Audit rules monitor time changes
  platform: linux
  description: |
    Ensures audit rules capture system time alterations aiding detection of anti-forensic timeline manipulation.
  resolution: |
    1. Add rules file /etc/audit/rules.d/time.rules with lines:
       -w /etc/localtime -p wa -k time-change
       -a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
    2. Load rules: sudo augenrules --load
    3. Verify: sudo auditctl -l | grep time-change
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file_lines 
      WHERE path LIKE '/etc/audit/rules.d/%' AND line LIKE '%time-change%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit-rules, requirement:standard, critical:false, control:audit-rules-time-change, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Audit rules monitor identity files
  platform: linux
  description: |
    Captures modifications to user/group definition files (/etc/passwd, /etc/group, /etc/shadow, /etc/gshadow) supporting detection of unauthorized account creation or privilege changes.
  resolution: |
    1. Add identity.rules with:
       -w /etc/passwd -p wa -k identity
       -w /etc/group -p wa -k identity
       -w /etc/shadow -p wa -k identity
       -w /etc/gshadow -p wa -k identity
    2. Load: sudo augenrules --load
    3. Verify: auditctl -l | grep identity
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file_lines 
      WHERE path LIKE '/etc/audit/rules.d/%' AND line LIKE '%identity%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit-rules, requirement:standard, critical:true, control:audit-rules-identity, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Audit rules monitor MAC/AppArmor changes
  platform: linux
  description: |
    Monitors AppArmor parser usage and profile modifications indicating potential attempts to weaken mandatory access controls.
  resolution: |
    1. Add mac.rules with:
       -w /sbin/apparmor_parser -p x -k mac-change
    2. Load rules; verify.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file_lines 
      WHERE path LIKE '/etc/audit/rules.d/%' AND line LIKE '%mac-change%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit-rules, requirement:standard, critical:false, control:audit-rules-mac-change, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Audit rules monitor kernel module events
  platform: linux
  description: |
    Tracks loading/unloading of kernel modules that may introduce new attack vectors or hide rootkits.
  resolution: |
    1. Add modules.rules with:
       -w /sbin/insmod -p x -k module-change
       -w /sbin/rmmod -p x -k module-change
       -w /sbin/modprobe -p x -k module-change
    2. Load rules; verify.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file_lines 
      WHERE path LIKE '/etc/audit/rules.d/%' AND line LIKE '%module-change%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit-rules, requirement:standard, critical:false, control:audit-rules-kernel-modules, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Audit rules monitor login/logout activity
  platform: linux
  description: |
    Captures changes to login/logout tracking files (/var/run/utmp, /var/log/wtmp, /var/log/btmp) supporting detection of brute-force attempts and unauthorized session creation.
  resolution: |
    1. Add login.rules with:
       -w /var/run/utmp -p wa -k session
       -w /var/log/wtmp -p wa -k session
       -w /var/log/btmp -p wa -k session
    2. Load rules: augenrules --load
    3. Verify: auditctl -l | grep session
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file_lines 
      WHERE path LIKE '/etc/audit/rules.d/%' AND line LIKE '%session%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit-rules, requirement:standard, critical:false, control:audit-rules-login-activity, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH root login disabled
  platform: linux
  description: |
    Prevents direct root SSH authentication reducing immediate high-privilege access; encourages use of sudo escalation with audit trail.
  resolution: |
    1. Edit /etc/ssh/sshd_config set: PermitRootLogin no
    2. Restart: sudo systemctl restart sshd
    3. Verify: sshd -T | grep permitrootlogin | grep no
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/PermitRootLogin' AND value='no');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-root-login-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH protocol version set to 2
  platform: linux
  description: |
    Ensures only secure SSH protocol version 2 used; protocol 1 is deprecated and weak.
  resolution: |
    1. /etc/ssh/sshd_config: Protocol 2
    2. Restart sshd; verify: sshd -T | grep protocol
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/Protocol' AND value='2');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:ssh-config, requirement:standard, critical:false, control:ssh-protocol-2, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH strong ciphers configured
  platform: linux
  description: |
    Restricts SSH ciphers to modern algorithms reducing risk of downgrade or exploitation of deprecated cryptography.
  resolution: |
    1. /etc/ssh/sshd_config add: Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes256-ctr,aes128-gcm@openssh.com,aes128-ctr
    2. Restart sshd; test: ssh -Q cipher | grep aes
    3. Verify: sshd -T | grep ciphers
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/Ciphers' AND value LIKE '%aes256-%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:false, control:ssh-strong-ciphers, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH strong MACs configured
  platform: linux
  description: |
    Enforces modern message authentication codes (MACs) ensuring integrity and authenticity of SSH data streams.
  resolution: |
    1. /etc/ssh/sshd_config add: MACs hmac-sha2-512,hmac-sha2-256
    2. Restart sshd; verify: sshd -T | grep macs
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/MACs' AND value LIKE '%hmac-sha2-256%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:false, control:ssh-strong-macs, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsyslog installed
  platform: linux
  description: |
    Ensures rsyslog present providing advanced log processing, filtering, and remote forwarding capabilities. Absence limits centralized monitoring and tamper detection.
  resolution: |
    1. Install: sudo apt-get install -y rsyslog
    2. Enable: sudo systemctl enable --now rsyslog.service
    3. Verify: systemctl status rsyslog.service | grep 'active (running)'
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='rsyslog' AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:rsyslog-installed, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsyslog service enabled and running
  platform: linux
  description: |
    Confirms rsyslog actively processing system logs ensuring timely collection for detection and correlation. Stopped service creates blind spots in monitoring.
  resolution: |
    1. Enable: sudo systemctl enable --now rsyslog.service
    2. Check socket files for permissions: ls -l /run/systemd/journal/syslog
    3. Configure remote forwarding if required (/etc/rsyslog.d/50-forward.conf).
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM systemd_units WHERE id='rsyslog.service' AND active_state='active'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:rsyslog-service-active, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - journald persistent storage enabled
  platform: linux
  description: |
    Configures systemd-journald to persist logs to /var/log/journal enabling retention across reboots for forensic continuity. Volatile-only logging loses prior boot evidence.
  resolution: |
    1. Edit /etc/systemd/journald.conf set Storage=persistent
    2. Create directory if missing: sudo mkdir -p /var/log/journal && sudo systemd-tmpfiles --create --prefix /var/log/journal
    3. Restart: sudo systemctl restart systemd-journald.service
    4. Verify: journalctl --list-boots (multiple boots listed)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM file WHERE path LIKE '/var/log/journal/%'
    ) AND EXISTS (
      SELECT * FROM augeas WHERE path LIKE '/files/etc/systemd/journald.conf/Storage' AND value='persistent'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:logging, requirement:standard, critical:false, control:journald-persistent-storage, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - journald forward to rsyslog enabled (if rsyslog used)
  platform: linux
  description: |
    Ensures journald forwarding to rsyslog so unified filtering and remote delivery applies to both legacy and structured logs. Without forwarding, some events may bypass central pipelines.
  resolution: |
    1. Edit /etc/systemd/journald.conf set ForwardToSyslog=yes
    2. Restart: sudo systemctl restart systemd-journald.service
    3. Verify: grep ForwardToSyslog /etc/systemd/journald.conf
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM augeas WHERE path LIKE '/files/etc/systemd/journald.conf/ForwardToSyslog' AND value='yes'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:logging, requirement:standard, critical:false, control:journald-forward-to-rsyslog, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - logrotate installed for log management
  platform: linux
  description: |
    Verifies logrotate present to rotate and compress logs preventing uncontrolled growth and ensuring retention policies enforced. Missing rotation risks disk exhaustion and loss of historical visibility.
  resolution: |
    1. Install: sudo apt-get install -y logrotate
    2. Review /etc/logrotate.conf and /etc/logrotate.d/*. Adjust retention per policy.
    3. Test rotation: sudo logrotate -f /etc/logrotate.conf
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='logrotate' AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:false, control:logrotate-installed, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - log files owned by root and not world-writable
  platform: linux
  description: |
    Ensures critical system log files protected from alteration by non-privileged users reducing chance of tampering or injection. World-writable logs allow attackers to erase traces or forge entries.
  resolution: |
    1. Audit: sudo find /var/log -type f -perm -002 -ls
    2. Fix permissions: sudo chmod o-w <file>; ensure ownership root:adm or root:root
    3. Integrate into monitoring (AIDE or file integrity).
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM file 
        WHERE path LIKE '/var/log/%' 
          AND type='regular file'
          AND substr(mode,4,1) IN ('2','3','6','7')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:logs-protected-permissions, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - UFW installed
  platform: linux
  description: |
    Ensures Uncomplicated Firewall (ufw) package present enabling straightforward host-based ingress policy enforcement. Lack of a firewall leaves services exposed by default.
  resolution: |
    1. Install: sudo apt-get install -y ufw
    2. Enable (if chosen firewall): sudo ufw enable
    3. Set default deny inbound: sudo ufw default deny incoming; allow needed ports explicitly.
    4. Verify: sudo ufw status verbose
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='ufw' AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:firewall, requirement:standard, critical:true, control:ufw-installed, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - UFW enabled with default deny inbound
  platform: linux
  description: |
    Verifies ufw active and enforcing a default-deny inbound posture minimizing unexpected service exposure; outbound typically allowed for normal operation.
  resolution: |
    1. Enable ufw: sudo ufw enable
    2. Configure defaults: sudo ufw default deny incoming; sudo ufw default allow outgoing
    3. Add explicit rules (example): sudo ufw allow 22/tcp comment 'SSH'
    4. Audit: sudo ufw status numbered
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM processes WHERE name='ufw'
    ) OR EXISTS (
      SELECT * FROM file WHERE path='/lib/ufw/ufw-init'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:firewall, requirement:standard, critical:true, control:ufw-enabled-default-deny, cis_safeguard_id:CIS4.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nftables framework installed
  platform: linux
  description: |
    Ensures modern nftables packet filtering framework available providing unified rule management and improved performance versus legacy iptables.
  resolution: |
    1. Install: sudo apt-get install -y nftables
    2. Enable service: sudo systemctl enable --now nftables.service
    3. Review current rules: sudo nft list ruleset
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='nftables' AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:firewall, requirement:standard, critical:false, control:nftables-installed, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nftables base policy configured
  platform: linux
  description: |
    Confirms nftables rule set loaded with default drop for unsolicited inbound while allowing established/related traffic. Absence of a rule set risks implicit acceptance.
  resolution: |
    1. Create /etc/nftables.conf with baseline:
       table inet filter {
         chain input {
           type filter hook input priority 0;
           ct state established,related accept
           iif lo accept
           ip protocol icmp accept
           tcp dport { 22 } accept
           counter reject with icmpx type admin-prohibited
         }
         chain forward { type filter hook forward priority 0; drop }
         chain output { type filter hook output priority 0; accept }
       }
    2. Enable: sudo systemctl enable --now nftables.service
    3. Validate: sudo nft list ruleset | grep 'inet filter'
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM processes WHERE name='nft') OR EXISTS (SELECT * FROM file WHERE path='/etc/nftables.conf');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:firewall, requirement:standard, critical:false, control:nftables-base-policy, cis_safeguard_id:CIS4.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Legacy iptables not active when nftables used
  platform: linux
  description: |
    Ensures legacy iptables services not conflicting with nftables preventing rule ambiguity or fallback to less maintained subsystems.
  resolution: |
    1. Disable legacy units: sudo systemctl disable --now iptables.service ip6tables.service 2>/dev/null || true
    2. Confirm nftables rules effective: sudo nft list ruleset
    3. Remove legacy packages if not needed: sudo apt-get purge -y iptables-persistent
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM systemd_units WHERE id IN ('iptables.service','ip6tables.service') AND active_state='active'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:firewall, requirement:standard, critical:false, control:legacy-iptables-disabled, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - IPv4 IP forwarding disabled
  platform: linux
  description: |
    Ensures host not acting as an unintended router by disabling net.ipv4.ip_forward. Forwarding increases exposure to packet spoofing, pivoting, and misconfiguration when server is not a designated gateway.
  resolution: |
    1. Persist: echo 'net.ipv4.ip_forward = 0' | sudo tee /etc/sysctl.d/70-ipv4-forward.conf
    2. Apply: sudo sysctl -w net.ipv4.ip_forward=0 && sudo sysctl --system
    3. Verify: sysctl net.ipv4.ip_forward (expect 0)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='net.ipv4.ip_forward' AND current_value='0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:ipv4-forwarding-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - IPv6 forwarding disabled (if IPv6 not required)
  platform: linux
  description: |
    Disables net.ipv6.conf.all.forwarding to prevent unintended IPv6 routing. Uncontrolled IPv6 forwarding allows bypass of IPv4-centric security tooling and lateral movement along less monitored paths.
  resolution: |
    1. Persist: echo 'net.ipv6.conf.all.forwarding = 0' | sudo tee /etc/sysctl.d/70-ipv6-forward.conf
    2. Apply: sudo sysctl -w net.ipv6.conf.all.forwarding=0 && sudo sysctl --system
    3. Verify: sysctl net.ipv6.conf.all.forwarding (expect 0)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='net.ipv6.conf.all.forwarding' AND current_value='0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:false, control:ipv6-forwarding-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Source routing disabled (IPv4)
  platform: linux
  description: |
    Ensures acceptance of source-routed packets disabled (net.ipv4.conf.all.accept_source_route=0) blocking attacker ability to dictate packet path circumventing routing policies and spoof detection.
  resolution: |
    1. Persist: echo 'net.ipv4.conf.all.accept_source_route = 0' | sudo tee /etc/sysctl.d/70-src-route.conf
    2. Apply: sudo sysctl -w net.ipv4.conf.all.accept_source_route=0 && sudo sysctl --system
    3. Verify: sysctl net.ipv4.conf.all.accept_source_route (expect 0)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='net.ipv4.conf.all.accept_source_route' AND current_value='0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:ipv4-source-routing-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Source routing disabled (IPv6)
  platform: linux
  description: |
    Disables net.ipv6.conf.all.accept_source_route to block manipulation of routing paths for IPv6 traffic which could bypass monitoring and filtering steps.
  resolution: |
    1. Persist: echo 'net.ipv6.conf.all.accept_source_route = 0' | sudo tee /etc/sysctl.d/70-src-route6.conf
    2. Apply: sudo sysctl -w net.ipv6.conf.all.accept_source_route=0 && sudo sysctl --system
    3. Verify: sysctl net.ipv6.conf.all.accept_source_route (expect 0)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='net.ipv6.conf.all.accept_source_route' AND current_value='0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:false, control:ipv6-source-routing-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - ICMP redirects not accepted (secure)
  platform: linux
  description: |
    Disables acceptance of ICMP redirects (net.ipv4.conf.all.accept_redirects=0 and secure_redirects=0) preventing malicious route injection and man-in-the-middle positioning.
  resolution: |
    1. Persist: echo 'net.ipv4.conf.all.accept_redirects = 0' | sudo tee /etc/sysctl.d/70-icmp-redirect.conf
    2. Persist secure: echo 'net.ipv4.conf.all.secure_redirects = 0' | sudo tee -a /etc/sysctl.d/70-icmp-redirect.conf
    3. Apply: sudo sysctl --system
    4. Verify: sysctl net.ipv4.conf.all.accept_redirects; sysctl net.ipv4.conf.all.secure_redirects (expect 0)
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM system_controls WHERE name='net.ipv4.conf.all.accept_redirects' AND current_value='0')
      AND EXISTS (SELECT * FROM system_controls WHERE name='net.ipv4.conf.all.secure_redirects' AND current_value='0');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:icmp-redirects-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Send redirects disabled
  platform: linux
  description: |
    Prevents host from sending ICMP redirects (net.ipv4.conf.all.send_redirects=0) reducing chance of inadvertently influencing peer routing decisions and leaking topology.
  resolution: |
    1. Persist: echo 'net.ipv4.conf.all.send_redirects = 0' | sudo tee /etc/sysctl.d/70-send-redirect.conf
    2. Apply: sudo sysctl -w net.ipv4.conf.all.send_redirects=0 && sudo sysctl --system
    3. Verify: sysctl net.ipv4.conf.all.send_redirects (expect 0)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='net.ipv4.conf.all.send_redirects' AND current_value='0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:false, control:send-redirects-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Reverse path filtering enabled
  platform: linux
  description: |
    Enables rp_filter to validate source reachability reducing spoofed packets used in reflection or bypass attacks. Setting net.ipv4.conf.all.rp_filter=1 enforces strict verification.
  resolution: |
    1. Persist: echo 'net.ipv4.conf.all.rp_filter = 1' | sudo tee /etc/sysctl.d/70-rp-filter.conf
    2. Apply: sudo sysctl -w net.ipv4.conf.all.rp_filter=1 && sudo sysctl --system
    3. Verify: sysctl net.ipv4.conf.all.rp_filter (expect 1)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='net.ipv4.conf.all.rp_filter' AND current_value='1'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:false, control:rp-filter-enabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Log martian packets enabled
  platform: linux
  description: |
    Enables logging of suspicious (martian) packets (net.ipv4.conf.all.log_martians=1) aiding detection of spoofing, misconfiguration, or reconnaissance using unusual source addresses.
  resolution: |
    1. Persist: echo 'net.ipv4.conf.all.log_martians = 1' | sudo tee /etc/sysctl.d/70-log-martians.conf
    2. Apply: sudo sysctl -w net.ipv4.conf.all.log_martians=1 && sudo sysctl --system
    3. Monitor: journalctl -k | grep martian
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='net.ipv4.conf.all.log_martians' AND current_value='1'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:network-hardening, requirement:standard, critical:false, control:log-martians-enabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - TCP SYN cookies enabled
  platform: linux
  description: |
    Confirms SYN cookies (net.ipv4.tcp_syncookies=1) mitigate SYN flood attacks by avoiding resource exhaustion in half-open connection table.
  resolution: |
    1. Persist: echo 'net.ipv4.tcp_syncookies = 1' | sudo tee /etc/sysctl.d/70-syn-cookies.conf
    2. Apply: sudo sysctl -w net.ipv4.tcp_syncookies=1 && sudo sysctl --system
    3. Verify: sysctl net.ipv4.tcp_syncookies (expect 1)
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM system_controls WHERE name='net.ipv4.tcp_syncookies' AND current_value='1');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:false, control:syn-cookies-enabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Mail Transfer Agent local-only (loopback)
  platform: linux
  description: |
    Ensures any installed MTA (Postfix/Exim) listens only on localhost preventing external relay abuse or enumeration of internal recipients. Exposed MTAs on non-mail servers expand attack surface for spam relay and credential harvesting.
  resolution: |
    1. For Postfix: edit /etc/postfix/main.cf set inet_interfaces = loopback-only
    2. Reload: sudo systemctl reload postfix
    3. Verify listen: ss -ntlp | grep ':25' | grep '127.0.0.1'
    4. Remove MTA entirely if not required: sudo apt-get purge -y postfix exim4-base
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT * FROM processes WHERE name IN ('postfix','exim4'))
      OR EXISTS (
        SELECT * FROM listening_ports lp JOIN processes p ON lp.pid=p.pid 
        WHERE lp.port=25 AND lp.address='127.0.0.1'
      );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:mta-local-only, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - NIS not installed
  platform: linux
  description: |
    Confirms Network Information Service (NIS/YP) packages absent. NIS relies on weak authentication and transmits data in cleartext, enabling credential interception and centralized compromise.
  resolution: |
    1. Remove any NIS packages: sudo apt-get purge -y nis yp-tools
    2. Verify no lingering processes: pgrep ypserv || echo 'none'
    3. Confirm removal: dpkg -l | grep -E 'nis|yp-tools' || echo 'clean'
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT * FROM deb_packages WHERE name IN ('nis','yp-tools') AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:true, control:nis-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsh/rcp/rlogin not installed
  platform: linux
  description: |
    Removes legacy rsh suite (rsh, rcp, rlogin) which provides unencrypted remote access susceptible to credential capture and man-in-the-middle attacks.
  resolution: |
    1. Purge packages: sudo apt-get purge -y rsh-client rsh-redone-client
    2. Delete any .rhosts files: sudo find / -name '.rhosts' -delete
    3. Validate absence: dpkg -l | grep rsh || echo 'none'
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM deb_packages WHERE name IN ('rsh-client','rsh-redone-client') AND status='install ok installed'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:true, control:rsh-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - telnet client/server not installed
  platform: linux
  description: |
    Ensures telnet packages absent, eliminating cleartext remote shell exposure vulnerable to credential theft and session hijacking.
  resolution: |
    1. Remove packages: sudo apt-get purge -y telnet telnetd
    2. Check for ports 23 listening: ss -ntlp | grep ':23' || echo 'not listening'
    3. Promote SSH hardened configuration instead.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT * FROM deb_packages WHERE name IN ('telnet','telnetd') AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:true, control:telnet-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - TFTP client/server not installed
  platform: linux
  description: |
    Validates trivial file transfer protocol software absent, avoiding unauthenticated write/read exposures common in insecure TFTP setups.
  resolution: |
    1. Purge: sudo apt-get purge -y tftpd-hpa atftpd tftp
    2. Verify: dpkg -l | grep -E 'tftp' || echo 'clean'
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT * FROM deb_packages WHERE name IN ('tftpd-hpa','atftpd','tftp') AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:tftp-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - X Window System not installed on servers
  platform: linux
  description: |
    Ensures graphical X components absent on server roles reducing attack surface (additional network listeners, local privilege escalation vectors) and resource consumption.
  resolution: |
    1. Remove meta packages: sudo apt-get purge -y xorg xserver-xorg*
    2. Validate processes: pgrep X || echo 'none'
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM deb_packages WHERE name LIKE 'xserver-xorg%' AND status='install ok installed'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:service-reduction, requirement:standard, critical:false, control:xwindow-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Avahi (mDNS) disabled
  platform: linux
  description: |
    Disables Avahi zeroconf service discovery which can leak network topology and enable spoofed service advertisements for lateral movement. Not needed on hardened servers.
  resolution: |
    1. Disable: sudo systemctl disable --now avahi-daemon.service avahi-daemon.socket 2>/dev/null || true
    2. Mask: sudo systemctl mask avahi-daemon.service
    3. Verify: systemctl status avahi-daemon.service | grep -E 'inactive|masked'
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM systemd_units WHERE id='avahi-daemon.service' AND active_state='active'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:avahi-disabled, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - CUPS printing disabled
  platform: linux
  description: |
    Disables Common UNIX Printing System (CUPS) to remove web management interface and network listeners that are unnecessary on most servers and occasionally vulnerable.
  resolution: |
    1. Disable: sudo systemctl disable --now cups.service cups.socket 2>/dev/null || true
    2. Remove if not needed: sudo apt-get purge -y cups
    3. Verify: systemctl status cups.service | grep -E 'inactive|disabled|not-found'
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM systemd_units WHERE id='cups.service' AND active_state='active'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:cups-disabled, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Time synchronization service installed (chrony or timesyncd)
  platform: linux
  description: |
    Ensures a supported time synchronization daemon (chrony or systemd-timesyncd) is present to maintain accurate system clocks. Accurate time underpins log integrity, correlation, certificate validation, and replay detection. Absence or drift undermines forensic timelines and security controls.
  resolution: |
    1. Preferred: sudo apt-get install -y chrony
    2. If using timesyncd: ensure systemd-timesyncd.service enabled (sudo systemctl enable --now systemd-timesyncd.service)
    3. Configure reliable NTP sources in /etc/chrony/chrony.conf or /etc/systemd/timesyncd.conf
    4. Verify sync: chronyc tracking OR timedatectl status (System clock synchronized: yes)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM deb_packages WHERE (name='chrony' OR name='systemd-timesyncd') AND status='install ok installed'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:time-sync, requirement:standard, critical:true, control:time-sync-service-installed, cis_safeguard_id:CIS8.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Only one time sync daemon active
  platform: linux
  description: |
    Verifies that multiple conflicting time daemons (chrony, ntp, systemd-timesyncd) are not simultaneously active to prevent race conditions and inconsistent time adjustments impacting logging accuracy.
  resolution: |
    1. Identify active: ps -ef | grep -E 'chronyd|ntpd|systemd-timesyncd'
    2. Choose chrony (recommended) and disable others: sudo systemctl disable --now systemd-timesyncd.service; sudo apt-get purge ntp
    3. Restart chrony: sudo systemctl restart chrony
    4. Confirm only one remains.
  query: |
    SELECT 1 WHERE (
      SELECT COUNT(*) AS c FROM processes WHERE name IN ('chronyd','ntpd','systemd-timesyncd')
    ) = 1;
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:time-sync, requirement:standard, critical:false, control:single-time-daemon-active, cis_safeguard_id:CIS8.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - chrony runs as _chrony user
  platform: linux
  description: |
    Ensures chrony daemon drops privileges to dedicated _chrony user minimizing impact of potential exploitation; running as root increases risk of full system compromise.
  resolution: |
    1. Edit /etc/chrony/chrony.conf: add or ensure line: user _chrony
    2. Create user if missing: sudo useradd -r -s /usr/sbin/nologin _chrony
    3. Restart: sudo systemctl restart chrony
    4. Verify: ps -eo user,comm | grep chronyd | grep _chrony
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM processes p JOIN users u ON p.uid=u.uid WHERE p.name='chronyd' AND u.username='_chrony'
    ) OR NOT EXISTS (SELECT 1 FROM processes WHERE name='chronyd');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:time-sync, requirement:standard, critical:false, control:chrony-runs-as-chrony-user, cis_safeguard_id:CIS8.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Remove or disable unnecessary network services
  platform: linux
  description: |
    Reduces attack surface by ensuring legacy or unused services (rsh, telnet, tftp, nis, ldap, ftp) are not installed or active. Unnecessary daemons expand vulnerability footprint and may expose cleartext credentials.
  resolution: |
    1. Inventory: dpkg -l | grep -E 'rsh-server|telnetd|tftpd|nis|ldap|vsftpd'
    2. Purge unused: sudo apt-get purge -y rsh-server telnetd tftpd nis slapd vsftpd || true
    3. Disable lingering units: sudo systemctl disable --now rsh.socket telnet.socket tftp.socket 2>/dev/null || true
    4. Re-validate: systemctl list-units | grep -E 'rsh|telnet|tftp|nis|ldap|ftp' || echo 'clean'
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM deb_packages WHERE name IN ('rsh-server','telnetd','tftpd','nis','slapd','vsftpd') AND status='install ok installed'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:true, control:unnecessary-services-removed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Secure permissions on /etc/motd
  platform: linux
  description: |
    Ensures message of the day file is owned by root and not writable by non-privileged users preventing injection of misleading post-auth messages or command aliases that could aid social engineering and lateral movement.
  resolution: |
    1. Set ownership: sudo chown root:root /etc/motd
    2. Restrict mode: sudo chmod 0644 /etc/motd
    3. Optional: sanitize content to exclude system version details.
    4. Verify: ls -l /etc/motd (expect -rw-r--r-- root root)
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM file WHERE path='/etc/motd' AND uid=0 AND gid=0 AND mode='0644')
      OR NOT EXISTS (SELECT * FROM file WHERE path='/etc/motd');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:false, control:motd-secure-perms, cis_safeguard_id:CIS6.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Secure permissions on /etc/issue
  platform: linux
  description: |
    Protects local pre-login banner from unauthorized modification that could mislead users or disclose internal details. /etc/issue displays before local console login; improper content may disclose system build or invite misuse.
  resolution: |
    1. Ownership: sudo chown root:root /etc/issue
    2. Mode: sudo chmod 0644 /etc/issue
    3. Scrub sensitive info (remove hostname, OS release).
    4. Validate: ls -l /etc/issue
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM file WHERE path='/etc/issue' AND uid=0 AND gid=0 AND mode='0644')
      OR NOT EXISTS (SELECT * FROM file WHERE path='/etc/issue');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:false, control:issue-secure-perms, cis_safeguard_id:CIS6.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Secure permissions on /etc/issue.net
  platform: linux
  description: |
    Safeguards remote login banner (e.g., SSH) ensuring only root can modify it. Compromise could leak service versions or present fraudulent legal disclaimers reducing deterrence.
  resolution: |
    1. Ownership: sudo chown root:root /etc/issue.net
    2. Mode: sudo chmod 0644 /etc/issue.net
    3. Remove environment details; retain authorized use warning.
    4. Verify: ls -l /etc/issue.net
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM file WHERE path='/etc/issue.net' AND uid=0 AND gid=0 AND mode='0644')
      OR NOT EXISTS (SELECT * FROM file WHERE path='/etc/issue.net');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:false, control:issuenet-secure-perms, cis_safeguard_id:CIS6.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Bootloader password configured
  platform: linux
  description: |
    Protects GRUB interactive edits by requiring authentication before altering kernel parameters at boot. Without a bootloader password, attackers with console access can disable security features (e.g., init=/bin/bash, single-user mode) to escalate privileges.
  resolution: |
    1. Generate PBKDF2 hash: grub-mkpasswd-pbkdf2 (record resulting hash).
    2. Edit /etc/grub.d/40_custom adding:
       set superusers="<admin>"
       password_pbkdf2 <admin> <hash>
    3. Update config: sudo update-grub
    4. Reboot and test: press 'e' at GRUB menu (should prompt for user if attempting edits).
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM file WHERE path LIKE '/etc/grub.d/%' AND filename LIKE '%40_custom%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:bootloader, requirement:standard, critical:true, control:grub-password-set, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Secure permissions on GRUB config
  platform: linux
  description: |
    Ensures /boot/grub/grub.cfg is owned by root and unreadable by non-root users preventing discovery or tampering with boot parameters and embedded credentials.
  resolution: |
    1. Set ownership: sudo chown root:root /boot/grub/grub.cfg
    2. Restrict mode: sudo chmod 0400 /boot/grub/grub.cfg
    3. Validate: ls -l /boot/grub/grub.cfg
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM file WHERE path='/boot/grub/grub.cfg' AND uid=0 AND gid=0 AND mode='0400'
    ) OR NOT EXISTS (SELECT * FROM file WHERE path='/boot/grub/grub.cfg');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:bootloader, requirement:standard, critical:true, control:grub-secure-permissions, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - ASLR enabled (kernel.randomize_va_space=2)
  platform: linux
  description: |
    Verifies Address Space Layout Randomization (ASLR) fully enabled to randomize memory mappings, making return-oriented programming and memory corruption exploits significantly harder.
  resolution: |
    1. Persist: echo 'kernel.randomize_va_space = 2' | sudo tee /etc/sysctl.d/60-aslr.conf
    2. Apply: sudo sysctl -w kernel.randomize_va_space=2
    3. Reload all: sudo sysctl --system
    4. Verify: sysctl kernel.randomize_va_space (expect 2)
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM system_controls WHERE name='kernel.randomize_va_space' AND current_value='2');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:true, control:aslr-enabled, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - prelink not installed
  platform: linux
  description: |
    Ensures prelink utility absent, reducing attack surface and avoiding deterministic memory layout side-effects that weaken ASLR. Prelinking can aid attackers by making addresses more predictable.
  resolution: |
    1. If installed, revert: sudo prelink -ua
    2. Remove package: sudo apt-get purge -y prelink
    3. Confirm removal: dpkg -l | grep prelink || echo 'not installed'
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT * FROM deb_packages WHERE name='prelink' AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:false, control:prelink-not-installed, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Automatic crash reporting disabled (Apport)
  platform: linux
  description: |
    Disables Apport automatic crash reporting to prevent unintended leakage of sensitive memory contents and reduce network exposure of debug data. Crash artifacts can contain secrets useful for credential theft or exploit refinement.
  resolution: |
    1. Disable: sudo sed -i 's/^enabled=1/enabled=0/' /etc/default/apport || echo 'enabled=0' | sudo tee /etc/default/apport
    2. Stop service: sudo systemctl stop apport.service 2>/dev/null || true
    3. Remove package (optional): sudo apt-get purge -y apport
    4. Verify: grep '^enabled=0' /etc/default/apport && systemctl status apport.service | grep -E 'inactive|not-found'
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM systemd_units WHERE id='apport.service' AND active_state='active'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:false, control:apport-crash-autoreport-disabled, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Core dumps restricted
  platform: linux
  description: |
    Restricts core dumps to prevent exposure of in-memory secrets (credentials, keys) and reduce disk consumption. Unrestricted dumping aids attackers in reverse engineering and sensitive data harvesting.
  resolution: |
    1. Add limits: echo '* hard core 0' | sudo tee /etc/security/limits.d/50-core.conf
    2. sysctl settings: echo 'fs.suid_dumpable = 0' | sudo tee /etc/sysctl.d/60-core.conf
    3. Apply: sudo sysctl -w fs.suid_dumpable=0 && sudo sysctl --system
    4. Verify: sysctl fs.suid_dumpable (expect 0); ulimit -c (expect 0)
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM system_controls WHERE name='fs.suid_dumpable' AND current_value='0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:false, control:core-dumps-restricted, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - AppArmor is installed
  platform: linux
  description: |
    Ensures the AppArmor Mandatory Access Control (MAC) framework is present, providing kernel-level confinement of processes to least privilege profiles. Without AppArmor, applications run with broader discretionary access increasing risk of lateral movement and data exposure if compromised.
  resolution: |
    1. Install packages: sudo apt-get update && sudo apt-get install -y apparmor apparmor-utils
    2. Enable service if applicable: systemctl enable apparmor.service
    3. List profiles: aa-status
    4. Baseline: record current enforcing/complain counts for drift monitoring.
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='apparmor' AND status='install ok installed');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:kernel, requirement:standard, critical:true, control:apparmor-installed, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - AppArmor enabled via boot parameters
  platform: linux
  description: |
    Confirms AppArmor is activated early in boot through kernel parameters (apparmor=1 security=apparmor). Absent flags may leave processes unconstrained until late initialization, weakening MAC guarantees.
  resolution: |
    1. Edit /etc/default/grub adding: GRUB_CMDLINE_LINUX="apparmor=1 security=apparmor"
    2. Regenerate loader config: sudo update-grub
    3. Reboot system.
    4. Verify: cat /proc/cmdline | grep 'apparmor=1' | grep 'security=apparmor'
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM kernel_info WHERE arguments LIKE '%apparmor=1%' AND arguments LIKE '%security=apparmor%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:kernel, requirement:standard, critical:true, control:apparmor-boot-enabled, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - AppArmor profiles not unconfined
  platform: linux
  description: |
    Ensures all loaded AppArmor profiles are at least in complain or enforce modeâ€”none left unconfinedâ€”so activity is either restricted or audited. Unconfined processes bypass MAC protections allowing full filesystem and capability access if exploited.
  resolution: |
    1. List unconfined: aa-status | grep 'profiles are in enforce mode' && sudo aa-status
    2. Force configuration: sudo aa-enforce /etc/apparmor.d/* (or aa-complain for incremental adoption).
    3. Remove stale custom profiles leaving services unconfined; create minimal profiles where missing.
    4. Re-check: aa-status | grep 'unconfined'
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT * FROM apparmor_profiles WHERE mode='unconfined');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:kernel, requirement:standard, critical:true, control:apparmor-no-unconfined, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - All AppArmor profiles enforcing
  platform: linux
  description: |
    Drives all AppArmor profiles to enforce mode (rather than complain) guaranteeing real-time prevention of unauthorized resource access, reducing window for exploitation after reconnaissance. Profiles in complain only log violations, permitting potential lateral movement.
  resolution: |
    1. Transition complain profiles: sudo aa-enforce /etc/apparmor.d/*
    2. Resolve profile syntax errors shown in dmesg or journal (apparmor_parser).
    3. Remove unused legacy profiles to simplify maintenance.
    4. Confirm: aa-status | grep 'profiles are in enforce mode'
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT * FROM apparmor_profiles WHERE mode='complain');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:kernel, requirement:standard, critical:true, control:apparmor-all-enforcing, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - separate partition exists for /home
  platform: linux
  description: |
    Isolates user home data on a dedicated filesystem so sudden growth (media dumps, backups) cannot consume root space. Segregation enables distinct quota, backup, and mount controls (nodev,nosuid) reducing lateral movement and privilege escalation opportunities if a user-owned path is compromised.
  resolution: |
    1. Provision partition/LV (e.g., /dev/mapper/vg0-home) sized per user growth forecasts.
    2. Add /etc/fstab entry: /dev/mapper/vg0-home /home ext4 defaults,rw,nodev,nosuid 0 2
    3. Migrate: rsync -aXS /home/ /mnt/newhome/; move & mount.
    4. Validate: mount | grep ' /home '
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/home');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:home-separate-partition, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nodev option set on /home partition
  platform: linux
  description: |
    Ensures /home is mounted with nodev preventing creation/use of device files by unprivileged users which could facilitate unintended kernel interaction or data exfiltration.
  resolution: |
    1. Edit /etc/fstab entry for /home adding nodev.
    2. Remount: sudo mount -o remount /home
    3. Verify: mount | grep '/home' | grep nodev
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/home' AND flags LIKE '%nodev%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:home-nodev, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nosuid option set on /home partition
  platform: linux
  description: |
    Validates nosuid on /home to block execution of setuid/setgid binaries introduced through user uploads or misconfigured package extraction reducing privilege escalation risk.
  resolution: |
    1. Add nosuid to /etc/fstab for /home (retain nodev if present).
    2. Remount: sudo mount -o remount /home
    3. Confirm: mount | grep '/home' | grep nosuid
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/home' AND flags LIKE '%nosuid%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:home-nosuid, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nodev option set on /dev/shm partition
  platform: linux
  description: |
    /dev/shm (shared memory) is world-writable; enforcing nodev prevents introduction of fake device nodes enabling potential kernel-level abuse or data snooping.
  resolution: |
    1. Add nodev to /etc/fstab entry for /dev/shm (often tmpfs). Example options: tmpfs /dev/shm tmpfs rw,nosuid,nodev,noexec,relatime 0 0
    2. Remount: sudo mount -o remount /dev/shm
    3. Verify: mount | grep '/dev/shm' | grep nodev
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/dev/shm' AND flags LIKE '%nodev%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:memory, requirement:standard, critical:false, control:dev-shm-nodev, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - noexec option set on /dev/shm partition
  platform: linux
  description: |
    Ensures shared memory tmpfs cannot directly execute dropped binaries or scripts, reducing fileless attack staging and exploitation of writable memory-backed space.
  resolution: |
    1. Add or edit /etc/fstab entry for /dev/shm including noexec (alongside nodev,nosuid where appropriate).
    2. Remount: sudo mount -o remount /dev/shm
    3. Test execution (expected failure): echo 'echo test' > /dev/shm/test.sh && chmod +x /dev/shm/test.sh && /dev/shm/test.sh
    4. Verify options: mount | grep '/dev/shm' | grep noexec
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/dev/shm' AND flags LIKE '%noexec%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:memory, requirement:standard, critical:false, control:dev-shm-noexec, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nodev option set on /tmp partition
  platform: linux
  description: |
    Verifies /tmp is mounted with nodev to block creation/use of device special files, reducing opportunities for attackers to interact with kernel interfaces via crafted device nodes in a world-writable location.
  resolution: |
    1. Edit /etc/fstab entry for /tmp adding nodev (keep nosuid,noexec if present).
    2. Remount: sudo mount -o remount /tmp
    3. Confirm: mount | grep '/tmp' | grep nodev
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/tmp' AND flags LIKE '%nodev%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:filesystem, requirement:standard, critical:false, control:tmp-nodev, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - noexec option set on /tmp partition
  platform: linux
  description: |
    Ensures binaries cannot be executed directly from /tmp, mitigating common malware and exploit staging patterns that drop payloads into world-writable temporary space.
  resolution: |
    1. Add noexec to /etc/fstab for /tmp alongside nodev,nosuid.
    2. Remount: sudo mount -o remount /tmp
    3. Test (should fail): echo 'echo test' > /tmp/xtest.sh && chmod +x /tmp/xtest.sh && /tmp/xtest.sh
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/tmp' AND flags LIKE '%noexec%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:filesystem, requirement:standard, critical:false, control:tmp-noexec, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nosuid option set on /tmp partition
  platform: linux
  description: |
    Confirms /tmp is mounted with nosuid, preventing execution of setuid/setgid binaries that could elevate privileges if improperly created or left by packages or attackers.
  resolution: |
    1. Append nosuid to /etc/fstab options for /tmp (retain nodev,noexec).
    2. Remount: sudo mount -o remount /tmp
    3. Validate: mount | grep '/tmp' | grep nosuid
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/tmp' AND flags LIKE '%nosuid%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:filesystem, requirement:standard, critical:false, control:tmp-nosuid, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - separate partition exists for /var
  platform: linux
  description: |
    Ensures /var resides on a dedicated filesystem to contain variable, frequently growing data (logs, spool, caches) limiting impact of uncontrolled growth on root filesystem availability and facilitating targeted mount options.
  resolution: |
    For new deployments:
      1. Create partition or logical volume (e.g., /dev/mapper/vg0-var).
      2. Add /etc/fstab entry: /dev/mapper/vg0-var /var ext4 defaults,rw,nodev,nosuid 0 2
      3. Migrate existing data: rsync -aXS /var/ /mnt/newvar/; update fstab; mount.
      4. Verify: mount | grep ' /var '
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:var-separate-partition, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nodev option set on /var partition
  platform: linux
  description: |
    Validates /var is mounted with nodev to reduce risk from unauthorized creation/use of block or character devices within variable data paths.
  resolution: |
    1. Edit /etc/fstab entry for /var adding nodev.
    2. Remount: sudo mount -o remount /var
    3. Confirm: mount | grep '/var' | grep nodev
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var' AND flags LIKE '%nodev%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:var-nodev, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nosuid option set on /var partition
  platform: linux
  description: |
    Ensures /var is mounted with nosuid to block execution of setuid/setgid binaries potentially written or replaced in variable directories (e.g., spool) by attackers.
  resolution: |
    1. Add nosuid to /etc/fstab for /var.
    2. Remount: sudo mount -o remount /var
    3. Check: mount | grep '/var' | grep nosuid
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var' AND flags LIKE '%nosuid%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:var-nosuid, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - separate partition exists for /var/tmp
  platform: linux
  description: |
    Verifies /var/tmp is isolated on its own filesystem. Like /tmp, /var/tmp is world-writable but may retain files across reboots; isolation plus restrictive mount options reduce persistence and privilege escalation risk.
  resolution: |
    1. Provision separate partition or bind mount dedicated logical volume.
    2. Add /etc/fstab entry with nodev,nosuid,noexec options.
    3. Migrate contents if needed; remount.
    4. Validate: mount | grep ' /var/tmp '
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/tmp');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:var-tmp-separate-partition, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nodev option set on /var/tmp partition
  platform: linux
  description: |
    Checks nodev on /var/tmp preventing device file abuse in persistent temporary storage.
  resolution: |
    1. Ensure /etc/fstab for /var/tmp includes nodev.
    2. Remount: sudo mount -o remount /var/tmp
    3. Verify: mount | grep '/var/tmp' | grep nodev
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/tmp' AND flags LIKE '%nodev%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:var-tmp-nodev, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - noexec option set on /var/tmp partition
  platform: linux
  description: |
    Ensures noexec on /var/tmp to block execution of staged malware or scripts in a persistent world-writable directory.
  resolution: |
    1. Ensure /etc/fstab entry for /var/tmp includes noexec (alongside nodev,nosuid if used). Example:
       /dev/mapper/vg0-vartmp  /var/tmp  ext4  defaults,rw,nodev,nosuid,noexec,relatime  0  2
    2. Remount: sudo mount -o remount /var/tmp
    3. Test (should fail): echo 'echo test' > /var/tmp/xtest.sh && chmod +x /var/tmp/xtest.sh && /var/tmp/xtest.sh || echo 'execution blocked'
    4. Verify options: mount | grep ' /var/tmp ' | grep noexec
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/tmp' AND flags LIKE '%noexec%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:false, control:var-tmp-noexec, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nosuid option set on /dev/shm partition
  platform: linux
  description: |
    Ensures /dev/shm is mounted with nosuid, preventing execution of setuid/setgid binaries staged in shared memory for privilege escalation.
  resolution: |
    1. Add nosuid to /etc/fstab for /dev/shm (alongside nodev,noexec).
    2. Remount: sudo mount -o remount /dev/shm
    3. Validate: mount | grep '/dev/shm' | grep nosuid
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/dev/shm' AND flags LIKE '%nosuid%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:memory, requirement:standard, critical:false, control:dev-shm-nosuid, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - APT repository GPG keys configured
  platform: linux
  description: |
    Validates trusted GPG keys are installed and referenced for all APT repositories to ensure package integrity and origin authenticity. Missing or stale keys allow unsigned or malicious packages to be installed, undermining system trust.
  resolution: |
    1. List configured repositories: grep -R "^deb" /etc/apt/sources.list /etc/apt/sources.list.d/*.list 2>/dev/null
    2. Import vendor keys (example): curl -fsSL https://mirror.example.com/repo/pubkey.gpg | sudo gpg --dearmor -o /usr/share/keyrings/vendor-archive.gpg
    3. Reference key using signed-by in source entry: deb [arch=amd64 signed-by=/usr/share/keyrings/vendor-archive.gpg] https://mirror.example.com/ubuntu noble main
    4. Remove obsolete keys: sudo rm /usr/share/keyrings/old-*.gpg
    5. Update index: sudo apt-get update && review warnings.
    6. Periodically rotate compromised or deprecated keys.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM file WHERE path LIKE '/usr/share/keyrings/%.gpg'
    ) OR EXISTS (
      SELECT * FROM file WHERE path LIKE '/etc/apt/trusted.gpg%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:apt-gpg-keys-configured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - separate partition exists for /var/log
  platform: linux
  description: |
    Ensures log data expansion in /var/log cannot consume root filesystem capacity, preserving system stability and enabling tailored mount hardening.
  resolution: |
    1. Create partition/LV (e.g., /dev/mapper/vg0-varlog) sized for retention policy.
    2. Add /etc/fstab: /dev/mapper/vg0-varlog /var/log ext4 defaults,rw,nodev,nosuid 0 2
    3. Migrate existing logs safely: rsync -aXS /var/log/ /mnt/newvarlog/; update fstab; mount.
    4. Verify: mount | grep ' /var/log '
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/log');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:logging, requirement:standard, critical:false, control:var-log-separate-partition, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nodev option set on /var/log partition
  platform: linux
  description: |
    Validates nodev on /var/log limiting exposure from potential device files created in log directories by compromised processes.
  resolution: |
    1. Edit /etc/fstab for /var/log adding nodev.
    2. Remount: sudo mount -o remount /var/log
    3. Check: mount | grep '/var/log' | grep nodev
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/log' AND flags LIKE '%nodev%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:logging, requirement:standard, critical:false, control:var-log-nodev, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - noexec option set on /var/log partition
  platform: linux
  description: |
    Ensures noexec on /var/log preventing accidental or malicious execution of rotated or injected scripts posing as log artifacts.
  resolution: |
    1. Add noexec to /etc/fstab options for /var/log.
    2. Remount: sudo mount -o remount /var/log
    3. Confirm: mount | grep '/var/log' | grep noexec
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/log' AND flags LIKE '%noexec%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:logging, requirement:standard, critical:false, control:var-log-noexec, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nosuid option set on /var/log partition
  platform: linux
  description: |
    Confirms nosuid on /var/log to prevent privilege elevation through manipulated setuid binaries stored or rotated into log locations.
  resolution: |
    1. Include nosuid in /etc/fstab for /var/log.
    2. Remount: sudo mount -o remount /var/log
    3. Verify: mount | grep '/var/log' | grep nosuid
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/log' AND flags LIKE '%nosuid%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:logging, requirement:standard, critical:false, control:var-log-nosuid, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - separate partition exists for /var/log/audit
  platform: linux
  description: |
    Places audit logs on a dedicated filesystem, protecting system stability during high-volume events and supporting stricter retention and tamper resistance strategies.
  resolution: |
    1. Create partition/LV for /var/log/audit sized per retention (consider daily volume + incident spikes).
    2. Add /etc/fstab entry: /dev/mapper/vg0-audit /var/log/audit ext4 defaults,rw,nodev,nosuid,noexec 0 2
    3. Migrate: rsync -aXS /var/log/audit/ /mnt/newaudit/; update fstab; mount.
    4. Implement logrotate and integrity checks (AIDE, auditd rules).
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/log/audit');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit, requirement:standard, critical:false, control:var-log-audit-separate-partition, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nodev option set on /var/log/audit partition
  platform: linux
  description: |
    Ensures audit log filesystem disallows device nodes, reducing risk of unauthorized kernel interaction through audit storage paths.
  resolution: |
    1. Append nodev to /etc/fstab for /var/log/audit.
    2. Remount: sudo mount -o remount /var/log/audit
    3. Verify: mount | grep '/var/log/audit' | grep nodev
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/log/audit' AND flags LIKE '%nodev%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit, requirement:standard, critical:false, control:var-log-audit-nodev, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - noexec option set on /var/log/audit partition
  platform: linux
  description: |
    Confirms noexec on audit log filesystem to prevent execution of tampered or injected binaries disguised as audit artifacts.
  resolution: |
    1. Add noexec to /etc/fstab options for /var/log/audit.
    2. Remount: sudo mount -o remount /var/log/audit
    3. Check: mount | grep '/var/log/audit' | grep noexec
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM mounts WHERE path = '/var/log/audit' AND flags LIKE '%noexec%');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:audit, requirement:standard, critical:false, control:var-log-audit-noexec, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nosuid option set on /var/tmp partition
  platform: linux
  description: |
    The nosuid mount option specifies that the filesystem cannot contain setuid files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'filesystem' and maps to safeguard CIS4.1.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/fstab and add nosuid to the mount options for /var/tmp.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM mounts 
          WHERE path = '/var/tmp' 
          AND flags LIKE '%nosuid%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:true, control:nosuid-option-set-on-var-tmp-partition, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nosuid option set on /var/log/audit partition
  platform: linux
  description: |
    The nosuid mount option specifies that the filesystem cannot contain setuid files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'filesystem' and maps to safeguard CIS4.1.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/fstab and add nosuid to the mount options for /var/log/audit.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM mounts 
          WHERE path = '/var/log/audit' 
          AND flags LIKE '%nosuid%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:filesystem, requirement:standard, critical:true, control:nosuid-option-set-on-var-log-audit-partition, cis_safeguard_id:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - package manager repositories are configured
  platform: linux
  description: |
    Systems need to have package manager repositories configured to ensure they receive the latest patches.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.4.
  resolution: |
    1. Review current state (see verification query).
    Configure your package manager repositories according to site policy.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file WHERE path = '/etc/apt/sources.list' AND size > 0
        ) OR EXISTS (
          SELECT * FROM file WHERE path LIKE '/etc/apt/sources.list.d/%.list' AND size > 0
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:package-manager-repositories-are-configured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - GPG keys are configured
  platform: linux
  description: |
    Most packages managers implement GPG key signing to verify package integrity during installation.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.4.
  resolution: |
    1. Review current state (see verification query).
    Update your package manager GPG keys according to site policy.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file WHERE path LIKE '/etc/apt/trusted.gpg%'
        ) OR EXISTS (
          SELECT * FROM file WHERE path LIKE '/usr/share/keyrings/%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:gpg-keys-are-configured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - AppArmor is enabled in the bootloader configuration
  platform: linux
  description: |
    Configure AppArmor to be enabled at boot time and verify it is not overwritten by the bootloader boot parameters.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'kernel' and maps to safeguard CIS4.4.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/default/grub and add the following parameters to GRUB_CMDLINE_LINUX:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM kernel_info 
          WHERE arguments LIKE '%apparmor=1%'
          AND arguments LIKE '%security=apparmor%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:kernel, requirement:standard, critical:true, control:apparmor-is-enabled-in-the-bootloader-configuration, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - all AppArmor Profiles are in enforce or complain mode
  platform: linux
  description: |
    AppArmor profiles define what resources applications can access.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'kernel' and maps to safeguard CIS4.4.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to set all profiles to enforce mode:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM apparmor_profiles WHERE mode = 'unconfined'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:kernel, requirement:standard, critical:true, control:all-apparmor-profiles-are-in-enforce-or-complain-mode, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - all AppArmor Profiles are enforcing
  platform: linux
  description: |
    Security configuration requirements vary from site to site.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'kernel' and maps to safeguard CIS4.4.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to set all profiles to enforce mode:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM apparmor_profiles WHERE mode = 'complain'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:kernel, requirement:standard, critical:true, control:all-apparmor-profiles-are-enforcing, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - bootloader password is set
  platform: linux
  description: |
    Setting the boot loader password will require that anyone rebooting the system must enter a password before being able to set command line boot parameters.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'bootloader' and maps to safeguard CIS4.4.
  resolution: |
    1. Review current state (see verification query).
    Create an encrypted password with grub-mkpasswd-pbkdf2:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/grub.d/%' 
          AND filename LIKE '%custom%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:bootloader, requirement:standard, critical:false, control:bootloader-password-is-set, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on bootloader config are configured
  platform: linux
  description: |
    Setting the permissions to read and write for root only prevents non-root users from seeing the bootloader configuration.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'bootloader' and maps to safeguard CIS4.4.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/boot/grub/grub.cfg' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0400'
        ) OR NOT EXISTS (
          SELECT * FROM file WHERE path = '/boot/grub/grub.cfg'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:bootloader, requirement:standard, critical:false, control:permissions-on-bootloader-config-are-configured, cis_safeguard_id:CIS4.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - address space layout randomization (ASLR) is enabled
  platform: linux
  description: |
    Address space layout randomization (ASLR) is an exploit mitigation technique.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'process-hardening' and maps to safeguard CIS4.5.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'kernel.randomize_va_space' 
          AND current_value = '2'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:true, control:address-space-layout-randomization-aslr-is-enabled, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - prelink is not installed
  platform: linux
  description: |
    prelink is a program that modifies ELF shared libraries and ELF dynamically linked binaries.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'process-hardening' and maps to safeguard CIS4.5.
  resolution: |
    1. Review current state (see verification query).
    Restore binaries to normal and uninstall prelink:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'prelink' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:true, control:prelink-is-not-installed, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Automatic Error Reporting is not enabled
  platform: linux
  description: |
    The Apport Error Reporting Service is used to automatically generate crash reports.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'process-hardening' and maps to safeguard CIS4.5.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/default/apport and set enabled=0
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM systemd_units 
          WHERE id = 'apport.service' 
          AND active_state = 'active'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:true, control:automatic-error-reporting-is-not-enabled, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - core dumps are restricted
  platform: linux
  description: |
    A core dump is the memory of an executable program that is written to a file at the time of a crash.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'process-hardening' and maps to safeguard CIS4.5.
  resolution: |
    1. Review current state (see verification query).
    Add the following line to /etc/security/limits.conf or a /etc/security/limits.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'fs.suid_dumpable' 
          AND current_value = '0'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:process-hardening, requirement:standard, critical:true, control:core-dumps-are-restricted, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/motd are configured
  platform: linux
  description: |
    The contents of the /etc/motd file are displayed to users after login.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/motd' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0644'
        ) OR NOT EXISTS (
          SELECT * FROM file WHERE path = '/etc/motd'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:permissions-on-etc-motd-are-configured, cis_safeguard_id:CIS6.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/issue are configured
  platform: linux
  description: |
    The contents of the /etc/issue file are displayed to users prior to login for local terminals.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/issue' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0644'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:permissions-on-etc-issue-are-configured, cis_safeguard_id:CIS6.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/issue.net are configured
  platform: linux
  description: |
    The contents of the /etc/issue.net file are displayed to users prior to login for remote connections from configured services.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/issue.net' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0644'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:permissions-on-etc-issue-net-are-configured, cis_safeguard_id:CIS6.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - time synchronization is in use
  platform: linux
  description: |
    System time should be synchronized between all systems in an environment.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'time-sync' and maps to safeguard CIS7.7.
  resolution: |
    1. Review current state (see verification query).
    Install and configure chrony:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM deb_packages 
          WHERE (name = 'chrony' OR name = 'systemd-timesyncd') 
          AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:time-sync, requirement:standard, critical:true, control:time-synchronization-is-in-use, cis_safeguard_id:CIS8.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - single time synchronization daemon is in use
  platform: linux
  description: |
    Multiple time synchronization methods should not be in use on the same system.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'time-sync' and maps to safeguard CIS7.7.
  resolution: |
    1. Review current state (see verification query).
    Select one time synchronization method and remove the others.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE (
          SELECT COUNT(*) FROM deb_packages 
          WHERE name IN ('chrony', 'ntp', 'systemd-timesyncd') 
          AND status = 'install ok installed'
        ) <= 1;
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:time-sync, requirement:standard, critical:true, control:single-time-synchronization-daemon-is-in-use, cis_safeguard_id:CIS8.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - chrony is running as user _chrony
  platform: linux
  description: |
    The chrony daemon should be configured to run as the _chrony user.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'time-sync' and maps to safeguard CIS7.7.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/chrony/chrony.conf and add or edit the user line:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT 1 FROM processes p 
          JOIN users u ON p.uid = u.uid
          WHERE p.name = 'chronyd' 
          AND u.username = '_chrony'
        ) OR NOT EXISTS (
          SELECT 1 FROM processes WHERE name = 'chronyd'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:time-sync, requirement:standard, critical:true, control:chrony-is-running-as-user-chrony, cis_safeguard_id:CIS8.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Avahi Server is not installed
  platform: linux
  description: |
    Avahi is a free zeroconf implementation, including a system for multicast DNS/DNS-SD service discovery.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove avahi-daemon:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'avahi-daemon' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:avahi-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - CUPS is not installed
  platform: linux
  description: |
    The Common Unix Print System (CUPS) provides the ability to print to both local and network printers.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove CUPS:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'cups' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:cups-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - DHCP Server is not installed
  platform: linux
  description: |
    The Dynamic Host Configuration Protocol (DHCP) is a service that allows machines to be dynamically assigned IP addresses.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove the DHCP server:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'isc-dhcp-server' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:dhcp-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - LDAP server is not installed
  platform: linux
  description: |
    The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove the LDAP server:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'slapd' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:ldap-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - NFS is not installed
  platform: linux
  description: |
    The Network File System (NFS) is one of the first and most widely distributed file systems in the UNIX environment.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove NFS:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'nfs-kernel-server' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:nfs-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - DNS Server is not installed
  platform: linux
  description: |
    The Domain Name System (DNS) is a hierarchical naming system that maps names to IP addresses for computers connected to a network.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove BIND DNS server:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'bind9' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:dns-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - FTP Server is not installed
  platform: linux
  description: |
    The File Transfer Protocol (FTP) provides networked computers with the ability to transfer files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove vsftpd:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'vsftpd' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:ftp-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - HTTP server is not installed
  platform: linux
  description: |
    HTTP or web servers provide the ability to host web site content.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove the web server packages:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE (name = 'apache2' OR name = 'nginx') AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:http-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - IMAP and POP3 server are not installed
  platform: linux
  description: |
    dovecot-imapd and dovecot-pop3d are an open source IMAP and POP3 server for Linux based systems.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove dovecot:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE (name = 'dovecot-imapd' OR name = 'dovecot-pop3d') AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:imap-and-pop3-server-are-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Samba is not installed
  platform: linux
  description: |
    The Samba daemon allows system administrators to configure their Linux systems to share file systems and directories with Windows desktops.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove Samba:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'samba' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:samba-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - HTTP Proxy Server is not installed
  platform: linux
  description: |
    Squid is a standard proxy server used in many distributions and environments.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove squid:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'squid' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:http-proxy-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SNMP Server is not installed
  platform: linux
  description: |
    Simple Network Management Protocol (SNMP) is a widely used protocol for monitoring the health and welfare of network equipment.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove snmpd:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'snmpd' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:snmp-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - NIS Server is not installed
  platform: linux
  description: |
    The Network Information Service (NIS) provides a simple network lookup service consisting of databases and processes.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove nis:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'nis' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:nis-server-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsync service is either not installed or masked
  platform: linux
  description: |
    The rsync service can be used to synchronize files between systems over network connections.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'service-reduction' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands to mask rsync:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM systemd_units 
          WHERE id = 'rsync.service' 
          AND active_state = 'active'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:service-reduction, requirement:standard, critical:false, control:rsync-service-is-either-not-installed-or-masked, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - NIS Client is not installed
  platform: linux
  description: |
    The Network Information Service (NIS), formerly known as Yellow Pages, is a client-server directory service protocol used to distribute system configuration files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'client-services' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove nis:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'nis' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:client-services, requirement:standard, critical:false, control:nis-client-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsh client is not installed
  platform: linux
  description: |
    The rsh package contains the client commands for the rsh services.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'client-services' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove rsh:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'rsh-client' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:client-services, requirement:standard, critical:false, control:rsh-client-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - talk client is not installed
  platform: linux
  description: |
    The talk software makes it possible for users to send and receive messages across the network to another user.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'client-services' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove talk:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'talk' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:client-services, requirement:standard, critical:false, control:talk-client-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - telnet client is not installed
  platform: linux
  description: |
    The telnet package contains the telnet client, which allows users to start connections to other systems via the telnet protocol.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'client-services' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove telnet:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'telnet' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:client-services, requirement:standard, critical:false, control:telnet-client-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - LDAP client is not installed
  platform: linux
  description: |
    The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'client-services' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove ldap-utils:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'ldap-utils' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:client-services, requirement:standard, critical:false, control:ldap-client-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - RPC is not installed
  platform: linux
  description: |
    Remote Procedure Call (RPC) is a method for creating low level client server applications across a network.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'client-services' and maps to safeguard CIS4.9.
  resolution: |
    1. Review current state (see verification query).
    Remove rpcbind:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages WHERE name = 'rpcbind' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:client-services, requirement:standard, critical:false, control:rpc-is-not-installed, cis_safeguard_id:CIS4.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - IP forwarding is disabled
  platform: linux
  description: |
    The net.ipv4.ip_forward and net.ipv6.conf.all.forwarding flags are used to tell the system whether it can forward packets or not.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.ip_forward' 
          AND current_value = '0'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:ip-forwarding-is-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - packet redirect sending is disabled
  platform: linux
  description: |
    ICMP Redirects are used to send routing information to other hosts.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.conf.all.send_redirects' 
          AND current_value = '0'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:packet-redirect-sending-is-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - source routed packets are not accepted
  platform: linux
  description: |
    In networking, source routing allows a sender to partially or fully specify the route packets take through a network.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.conf.all.accept_source_route' 
          AND current_value = '0'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:source-routed-packets-are-not-accepted, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - ICMP redirects are not accepted
  platform: linux
  description: |
    ICMP redirect messages are packets that convey routing information and tell your host to send packets via an alternate path.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.conf.all.accept_redirects' 
          AND current_value = '0'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:icmp-redirects-are-not-accepted, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - secure ICMP redirects are not accepted
  platform: linux
  description: |
    Secure ICMP redirects are the same as ICMP redirects, except they come from gateways listed on the default gateway list.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.conf.all.secure_redirects' 
          AND current_value = '0'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:secure-icmp-redirects-are-not-accepted, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - suspicious packets are logged
  platform: linux
  description: |
    When enabled, this feature logs packets with un-routable source addresses to the kernel log.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.conf.all.log_martians' 
          AND current_value = '1'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:suspicious-packets-are-logged, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - broadcast ICMP requests are ignored
  platform: linux
  description: |
    Setting net.ipv4.icmp_echo_ignore_broadcasts to 1 will cause the system to ignore all ICMP echo and timestamp requests to broadcast and multicast addresses.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.icmp_echo_ignore_broadcasts' 
          AND current_value = '1'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:broadcast-icmp-requests-are-ignored, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - bogus ICMP responses are ignored
  platform: linux
  description: |
    Setting icmp_ignore_bogus_error_responses to 1 prevents the kernel from logging bogus responses.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.icmp_ignore_bogus_error_responses' 
          AND current_value = '1'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:bogus-icmp-responses-are-ignored, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - Reverse Path Filtering is enabled
  platform: linux
  description: |
    Setting net.ipv4.conf.all.rp_filter and net.ipv4.conf.default.rp_filter to 1 forces the Linux kernel to utilize reverse path filtering.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.conf.all.rp_filter' 
          AND current_value = '1'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:reverse-path-filtering-is-enabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - TCP SYN cookies is enabled
  platform: linux
  description: |
    When tcp_syncookies is set, the kernel will handle TCP SYN packets normally until the half-open connection queue is full.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv4.tcp_syncookies' 
          AND current_value = '1'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:tcp-syn-cookies-is-enabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - IPv6 router advertisements are not accepted
  platform: linux
  description: |
    This setting disables the system's ability to accept IPv6 router advertisements.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'network-hardening' and maps to safeguard CIS4.6.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM system_controls 
          WHERE name = 'net.ipv6.conf.all.accept_ra' 
          AND current_value = '0'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:network-hardening, requirement:standard, critical:true, control:ipv6-router-advertisements-are-not-accepted, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - ufw is installed
  platform: linux
  description: |
    The Uncomplicated Firewall (ufw) is a frontend for iptables and is designed to make configuring a firewall easier.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'firewall' and maps to safeguard CIS4.7.
  resolution: |
    1. Review current state (see verification query).
    Install ufw:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM deb_packages WHERE name = 'ufw' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:firewall, requirement:standard, critical:true, control:ufw-is-installed, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - iptables-persistent is not installed with ufw
  platform: linux
  description: |
    The iptables-persistent package saves the iptables rules for IPv4 and IPv6 to files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'firewall' and maps to safeguard CIS4.7.
  resolution: |
    1. Review current state (see verification query).
    Remove iptables-persistent:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM deb_packages 
          WHERE name = 'iptables-persistent' 
          AND status = 'install ok installed'
        ) OR NOT EXISTS (
          SELECT * FROM deb_packages 
          WHERE name = 'ufw' 
          AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:firewall, requirement:standard, critical:true, control:iptables-persistent-is-not-installed-with-ufw, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - ufw service is enabled
  platform: linux
  description: |
    When a firewall is enabled, it will ensure that only connections to allowed services are accepted.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'firewall' and maps to safeguard CIS4.7.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to enable ufw:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM systemd_units 
          WHERE id = 'ufw.service' 
          AND active_state = 'active'
          AND unit_file_state = 'enabled'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:firewall, requirement:standard, critical:true, control:ufw-service-is-enabled, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - nftables loopback traffic is configured
  platform: linux
  description: |
    Configure the loopback interface to accept traffic. Configure all other interfaces to deny traffic to the loopback network.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'firewall' and maps to safeguard CIS4.7.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands to create the table and chains if they don't exist:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    /* nftables table not available; parse /etc/nftables.conf for loopback accept and drop of 127.0.0.0/8 */
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file_lines 
        WHERE path='/etc/nftables.conf' 
          AND (
            line LIKE '%accept%loopback%'
            OR (line LIKE '%iifname%lo%' AND line LIKE '%accept%')
          )
    ) AND EXISTS (
      SELECT 1 FROM file_lines 
        WHERE path='/etc/nftables.conf' 
          AND (
            (line LIKE '%drop%' AND line LIKE '%127.0.0.0/8%')
            OR (line LIKE '%ip%' AND line LIKE '%saddr%' AND line LIKE '%127.0.0.0/8%' AND line LIKE '%drop%')
          )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:firewall, requirement:standard, critical:true, control:nftables-loopback-traffic-is-configured, cis_safeguard_id:CIS4.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsyslog is installed
  platform: linux
  description: |
    The rsyslog software is a recommended replacement to the original syslogd daemon.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Install rsyslog:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM deb_packages WHERE name = 'rsyslog' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:rsyslog-is-installed, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsyslog service is enabled
  platform: linux
  description: |
    If the rsyslog service is not activated the system may lack logging.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to enable rsyslog:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM systemd_units WHERE id = 'rsyslog.service' AND active_state = 'active'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:rsyslog-service-is-enabled, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsyslog default file permissions are configured
  platform: linux
  description: |
    rsyslog will create logfiles that may contain sensitive information.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/rsyslog.conf and /etc/rsyslog.d/*.conf files and set:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file WHERE path = '/etc/rsyslog.conf'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:rsyslog-default-file-permissions-are-configured, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - logging is configured
  platform: linux
  description: |
    The /etc/rsyslog.conf and /etc/rsyslog.d/*.conf files specify rules for logging and which files are to be used to log certain classes of messages.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/rsyslog.conf and /etc/rsyslog.d/*.conf files and configure logging as appropriate for your environment.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file WHERE path = '/etc/rsyslog.conf' AND size > 0
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:logging-is-configured, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - rsyslog is configured to send logs to a remote log host
  platform: linux
  description: |
    The rsyslog utility supports the ability to send logs it gathers to a remote log host.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/rsyslog.conf and /etc/rsyslog.d/*.conf files and add:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file WHERE path = '/etc/rsyslog.conf'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:rsyslog-is-configured-to-send-logs-to-a-remote-log-host, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - systemd-journal-remote is installed
  platform: linux
  description: |
    Journald supports the ability to securely send log messages to a remote log aggregation server.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Install systemd-journal-remote:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM deb_packages WHERE name = 'systemd-journal-remote' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:systemd-journal-remote-is-installed, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - systemd-journald service is enabled
  platform: linux
  description: |
    By default the systemd-journald service stores log data in a ring buffer.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    No action required. This is the default behavior.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM systemd_units WHERE id = 'systemd-journald.service' AND active_state = 'active'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:systemd-journald-service-is-enabled, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - journald ForwardToSyslog is disabled
  platform: linux
  description: |
    Data from journald should be forwarded to a remote log aggregation server.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/systemd/journald.conf file and ensure ForwardToSyslog is set to no
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT 1 FROM file_lines 
          WHERE path = '/etc/systemd/journald.conf'
          AND line LIKE 'ForwardToSyslog=no'
          AND line NOT LIKE '#%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:journald-forwardtosyslog-is-disabled, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - journald Storage is configured
  platform: linux
  description: |
    Journald should be configured to store logs persistently.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'logging' and maps to safeguard CIS8.2.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/systemd/journald.conf file and set the following parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM listening_ports 
          WHERE port = 19532 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:logging, requirement:standard, critical:true, control:journald-storage-is-configured, cis_safeguard_id:CIS8.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd is installed
  platform: linux
  description: |
    auditd is the userspace component to the Linux Auditing System.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Install auditd:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM deb_packages WHERE name = 'auditd' AND status = 'install ok installed'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:auditd-is-installed, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditd service is enabled
  platform: linux
  description: |
    The capturing of system events provides system administrators with information to allow them to determine if unauthorized access to their system is occurring.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to enable auditd:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM systemd_units WHERE id = 'auditd.service' AND active_state = 'active'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:auditd-service-is-enabled, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - auditing for processes that start prior to auditd is enabled
  platform: linux
  description: |
    Configure grub so that processes that are capable of being audited can be audited even if they start up prior to auditd startup.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/default/grub and add the following parameter to GRUB_CMDLINE_LINUX:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM kernel_info 
          WHERE arguments LIKE '%audit=1%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:auditing-for-processes-that-start-prior-to-auditd-is-enabled, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - audit_backlog_limit is sufficient
  platform: linux
  description: |
    The backlog limit has a default setting of 64. This may not be sufficient for all environments.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/default/grub and add the following parameter to GRUB_CMDLINE_LINUX:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        -- Check for audit_backlog_limit parameter set to a value greater than 64
        -- More efficient pattern matching approach
        SELECT 1 WHERE EXISTS (
          SELECT * FROM kernel_info 
          WHERE arguments LIKE '%audit_backlog_limit=%'
          AND (
            -- Three or more digits (100+)
            arguments LIKE '%audit_backlog_limit=___% %' OR
            arguments LIKE '%audit_backlog_limit=____%' OR
            -- Two digits starting with 7, 8, or 9 (70-99)
            arguments LIKE '%audit_backlog_limit=7_ %' OR arguments LIKE '%audit_backlog_limit=7_' OR
            arguments LIKE '%audit_backlog_limit=8_ %' OR arguments LIKE '%audit_backlog_limit=8_' OR
            arguments LIKE '%audit_backlog_limit=9_ %' OR arguments LIKE '%audit_backlog_limit=9_' OR
            -- Specific values 65-69
            arguments LIKE '%audit_backlog_limit=65 %' OR arguments LIKE '%audit_backlog_limit=65' OR
            arguments LIKE '%audit_backlog_limit=66 %' OR arguments LIKE '%audit_backlog_limit=66' OR
            arguments LIKE '%audit_backlog_limit=67 %' OR arguments LIKE '%audit_backlog_limit=67' OR
            arguments LIKE '%audit_backlog_limit=68 %' OR arguments LIKE '%audit_backlog_limit=68' OR
            arguments LIKE '%audit_backlog_limit=69 %' OR arguments LIKE '%audit_backlog_limit=69'
          )
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:audit-backlog-limit-is-sufficient, cis_safeguard_id:CIS8.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - audit log storage size is configured
  platform: linux
  description: |
    Configure the maximum size of the audit log file.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameter in /etc/audit/auditd.conf:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/audit/auditd.conf'
          AND label = 'max_log_file'
          AND CAST(value AS INTEGER) >= 100
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:audit-log-storage-size-is-configured, cis_safeguard_id:CIS8.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - audit logs are not automatically deleted
  platform: linux
  description: |
    The max_log_file_action setting determines how to handle the audit log file reaching the max file size.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameter in /etc/audit/auditd.conf:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/audit/auditd.conf' 
          AND label = 'max_log_file_action'
          AND value = 'keep_logs'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:audit-logs-are-not-automatically-deleted, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - system is disabled when audit logs are full
  platform: linux
  description: |
    The auditd daemon can be configured to halt the system when the audit logs are full.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Set the following parameters in /etc/audit/auditd.conf:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/audit/auditd.conf' 
          AND label = 'space_left_action'
          AND value = 'email'
        ) AND EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/audit/auditd.conf' 
          AND label = 'action_mail_acct'
          AND value = 'root'
        ) AND EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/audit/auditd.conf' 
          AND label = 'admin_space_left_action'
          AND value = 'halt'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:system-is-disabled-when-audit-logs-are-full, cis_safeguard_id:CIS8.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - all logfiles have appropriate permissions and ownership
  platform: linux
  description: |
    System log files stored in /var/log/ should have appropriate permissions and ownership.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to set permissions on all existing log files:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/var/log/%' 
          AND type = 'regular' 
          AND (
            mode NOT LIKE '0640' 
            AND mode NOT LIKE '0600'
          )
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:account-management, requirement:standard, critical:true, control:all-logfiles-have-appropriate-permissions-and-ownership, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - audit rule for apparmor parser is configured
  platform: linux
  description: |
    Monitor usage of AppArmor mandatory access controls.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following line to /etc/audit/rules.d/50-MAC-policy.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:audit-rule-for-apparmor-parser-is-configured, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - changes to system administration scope (sudoers) is collected
  platform: linux
  description: |
    Monitor scope changes for system administrators.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/audit.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:changes-to-system-administration-scope-sudoers-is-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - actions as another user (sudolog) are collected
  platform: linux
  description: |
    Monitor the sudo log file. If the system has been properly configured to force sudo log files, the file /var/log/sudo.log is defined.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-actions.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:actions-as-another-user-sudolog-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - events that modify date and time information are collected
  platform: linux
  description: |
    Capture events where the system date and/or time has been modified.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-time-change.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:events-that-modify-date-and-time-information-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - events that modify the systems network environment are collected
  platform: linux
  description: |
    Record changes to network environment files or system calls.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-system_locale.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:events-that-modify-the-systems-network-environment-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - use of privileged commands are collected
  platform: linux
  description: |
    Monitor privileged programs, those that have the setuid and/or setgid bit set on execution.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Find all setuid/setgid programs and create audit rules for them:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:use-of-privileged-commands-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - unsuccessful unauthorized file access attempts are collected
  platform: linux
  description: |
    Monitor for unsuccessful attempts to access files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-access.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:unsuccessful-unauthorized-file-access-attempts-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - events that modify user/group information are collected
  platform: linux
  description: |
    Record events affecting the modification of user or group information including passwords.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-identity.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:events-that-modify-user-group-information-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - discretionary access control permission modification events are collected
  platform: linux
  description: |
    Monitor changes to file permissions, attributes, ownership and group.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/audit.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1
        WHERE EXISTS (
          SELECT 1 FROM file_lines 
          WHERE path = '/etc/audit/rules.d/audit.rules'
            AND line = '-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat -F auid>=1000 -F auid!=unset -F key=perm_mod'
        )
        AND EXISTS (
          SELECT 1 FROM file_lines 
          WHERE path = '/etc/audit/rules.d/audit.rules'
            AND line = '-a always,exit -F arch=b64 -S chown,fchown,lchown,fchownat -F auid>=1000 -F auid!=unset -F key=perm_mod'
        )
        AND EXISTS (
          SELECT 1 FROM file_lines 
          WHERE path = '/etc/audit/rules.d/audit.rules'
            AND line = '-a always,exit -F arch=b64 -S setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:discretionary-access-control-permission-modification-events-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - successful file system mounts are collected
  platform: linux
  description: |
    Monitor the use of the mount system call.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-mounts.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:successful-file-system-mounts-are-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - session initiation information is collected
  platform: linux
  description: |
    Monitor session initiation events including login and logout.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-session.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:session-initiation-information-is-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - kernel module loading unloading and modification is collected
  platform: linux
  description: |
    Monitor the loading and unloading of kernel modules.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following lines to /etc/audit/rules.d/50-kernel_modules.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/audit/rules.d/%' 
          AND filename LIKE '%.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:kernel-module-loading-unloading-and-modification-is-collected, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - the audit configuration is immutable
  platform: linux
  description: |
    Set system audit so that audit rules cannot be modified with auditctl.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Add the following line to the END of /etc/audit/rules.d/99-finalize.rules:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/audit/rules.d/99-finalize.rules'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:the-audit-configuration-is-immutable, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - audit tools are owned by root
  platform: linux
  description: |
    Audit tools include, but are not limited to, vendor-supplied and open source audit tools needed to successfully view and manipulate audit information system activity.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to change ownership to root:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file 
          WHERE path IN ('/sbin/auditctl', '/sbin/aureport', '/sbin/ausearch', '/sbin/autrace', '/sbin/auditd', '/sbin/augenrules')
          AND uid != 0
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:audit-tools-are-owned-by-root, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - audit tools belong to group root
  platform: linux
  description: |
    Protecting audit tools from unauthorized access and use is necessary to prevent unauthorized modification.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'account-management' and maps to safeguard CIS5.2.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to change group ownership to the group root:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file 
          WHERE path IN ('/sbin/auditctl', '/sbin/aureport', '/sbin/ausearch', '/sbin/autrace', '/sbin/auditd', '/sbin/augenrules')
          AND gid != 0
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:account-management, requirement:standard, critical:true, control:audit-tools-belong-to-group-root, cis_safeguard_id:CIS8.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/ssh/sshd_config are configured
  platform: linux
  description: |
    The /etc/ssh/sshd_config file contains configuration specifications for sshd.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/ssh/sshd_config' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0600'
        ) OR NOT EXISTS (
          SELECT * FROM file WHERE path = '/etc/ssh/sshd_config'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:permissions-on-etc-ssh-sshd-config-are-configured, cis_safeguard_id:CIS6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on SSH private host key files are configured
  platform: linux
  description: |
    An SSH private host key is one of two files that together form a host key pair used during the SSH handshake to verify the server.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/ssh/ssh_host_%_key' 
          AND (uid != 0 OR gid != 0 OR mode != '0600')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:permissions-on-ssh-private-host-key-files-are-configured, cis_safeguard_id:CIS6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on SSH public host key files are configured
  platform: linux
  description: |
    An SSH public host key is one of two files that together form a host key pair used during the SSH handshake to verify the server.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file 
          WHERE path LIKE '/etc/ssh/ssh_host_%_key.pub' 
          AND (uid != 0 OR gid != 0 OR mode != '0644')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:permissions-on-ssh-public-host-key-files-are-configured, cis_safeguard_id:CIS6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH access is limited
  platform: linux
  description: |
    There are several options available to limit which users and group can access the system via SSH.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/ssh/sshd_config and set one or more of:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path LIKE '/etc/ssh/sshd_config'
          AND label = 'AllowUsers'
          OR path LIKE '/etc/ssh/sshd_config'
          AND label = 'AllowGroups'
          OR path LIKE '/etc/ssh/sshd_config'
          AND label = 'DenyUsers'
          OR path LIKE '/etc/ssh/sshd_config'
          AND label = 'DenyGroups'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-access-is-limited, cis_safeguard_id:CIS6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH LogLevel is appropriate
  platform: linux
  description: |
    INFO level is the basic level that only records login activity.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'LogLevel'
          AND (value = 'VERBOSE' OR value = 'INFO')
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-loglevel-is-appropriate, cis_safeguard_id:CIS6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH PAM is enabled
  platform: linux
  description: |
    UsePAM enables the Pluggable Authentication Module interface.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'UsePAM'
          AND value = 'yes'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-pam-is-enabled, cis_safeguard_id:CIS5.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH root login is disabled
  platform: linux
  description: |
    The PermitRootLogin parameter specifies if the root user can log in using ssh.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'PermitRootLogin'
          AND value = 'no'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-root-login-is-disabled, cis_safeguard_id:CIS5.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH HostbasedAuthentication is disabled
  platform: linux
  description: |
    The HostbasedAuthentication parameter specifies if authentication is allowed through trusted hosts.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config'
          AND label = 'HostbasedAuthentication'
          AND value = 'no'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-hostbasedauthentication-is-disabled, cis_safeguard_id:CIS5.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH PermitEmptyPasswords is disabled
  platform: linux
  description: |
    The PermitEmptyPasswords parameter specifies if the SSH server allows login to accounts with empty password strings.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'PermitEmptyPasswords'
          AND value = 'no'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-permitemptypasswords-is-disabled, cis_safeguard_id:CIS5.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH PermitUserEnvironment is disabled
  platform: linux
  description: |
    The PermitUserEnvironment option allows users to present environment variables to the ssh daemon.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'PermitUserEnvironment'
          AND value != 'no'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports 
          WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-permituserenvironment-is-disabled, cis_safeguard_id:CIS5.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH IgnoreRhosts is enabled
  platform: linux
  description: |
    The IgnoreRhosts parameter specifies that .rhosts and .shosts files will not be used in RhostsRSAAuthentication or HostbasedAuthentication.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'IgnoreRhosts'
          AND value != 'yes'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports 
          WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-ignorerhosts-is-enabled, cis_safeguard_id:CIS5.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH X11 forwarding is disabled
  platform: linux
  description: |
    The X11Forwarding parameter provides the ability to tunnel X11 traffic through the connection.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'X11Forwarding'
          AND value != 'no'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports 
          WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-x11-forwarding-is-disabled, cis_safeguard_id:CIS5.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - only strong Ciphers are used
  platform: linux
  description: |
    This variable limits the ciphers that SSH can use during communication.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE (
          (SELECT COUNT(DISTINCT value) FROM augeas 
           WHERE node LIKE '/files/etc/ssh/sshd_config/Ciphers/%' 
           AND value IN (
             'chacha20-poly1305@openssh.com',
             'aes256-gcm@openssh.com',
             'aes128-gcm@openssh.com',
             'aes256-ctr',
             'aes192-ctr',
             'aes128-ctr'
           )) = 6
          AND NOT EXISTS (
            SELECT 1 FROM augeas 
            WHERE node LIKE '/files/etc/ssh/sshd_config/Ciphers/%'
            AND value NOT IN (
              'chacha20-poly1305@openssh.com',
              'aes256-gcm@openssh.com',
              'aes128-gcm@openssh.com',
              'aes256-ctr',
              'aes192-ctr',
              'aes128-ctr'
            )
          )
        ) OR NOT EXISTS (
          SELECT 1 FROM listening_ports 
          WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:only-strong-ciphers-are-used, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - only strong Key Exchange algorithms are used
  platform: linux
  description: |
    Key exchange is any method in cryptography by which cryptographic keys are exchanged between two parties.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE (
          (SELECT COUNT(DISTINCT value) FROM augeas 
           WHERE node LIKE '/files/etc/ssh/sshd_config/KexAlgorithms/%' 
           AND value IN (
             'curve25519-sha256',
             'curve25519-sha256@libssh.org',
             'diffie-hellman-group14-sha256',
             'diffie-hellman-group16-sha512',
             'diffie-hellman-group18-sha512',
             'ecdh-sha2-nistp521',
             'ecdh-sha2-nistp384',
             'ecdh-sha2-nistp256',
             'diffie-hellman-group-exchange-sha256'
           )) = 9
          AND NOT EXISTS (
            SELECT 1 FROM augeas 
            WHERE node LIKE '/files/etc/ssh/sshd_config/KexAlgorithms/%'
            AND value NOT IN (
              'curve25519-sha256',
              'curve25519-sha256@libssh.org',
              'diffie-hellman-group14-sha256',
              'diffie-hellman-group16-sha512',
              'diffie-hellman-group18-sha512',
              'ecdh-sha2-nistp521',
              'ecdh-sha2-nistp384',
              'ecdh-sha2-nistp256',
              'diffie-hellman-group-exchange-sha256'
            )
          )
        ) OR NOT EXISTS (
          SELECT 1 FROM listening_ports 
          WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:only-strong-key-exchange-algorithms-are-used, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - only strong MAC algorithms are used
  platform: linux
  description: |
    This variable limits the types of MAC algorithms that SSH can use during communication.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE (
          (SELECT COUNT(DISTINCT value) FROM augeas 
           WHERE node LIKE '/files/etc/ssh/sshd_config/MACs/%' 
           AND value IN (
             'hmac-sha2-512-etm@openssh.com',
             'hmac-sha2-256-etm@openssh.com',
             'hmac-sha2-512',
             'hmac-sha2-256'
           )) = 4
          AND NOT EXISTS (
            SELECT 1 FROM augeas 
            WHERE node LIKE '/files/etc/ssh/sshd_config/MACs/%'
            AND value NOT IN (
              'hmac-sha2-512-etm@openssh.com',
              'hmac-sha2-256-etm@openssh.com',
              'hmac-sha2-512',
              'hmac-sha2-256'
            )
          )
        ) OR NOT EXISTS (
          SELECT 1 FROM listening_ports 
          WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:only-strong-mac-algorithms-are-used, cis_safeguard_id:CIS4.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH warning banner is configured
  platform: linux
  description: |
    The Banner parameter specifies a file whose contents must be sent to the remote user before authentication is permitted.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'Banner' 
          AND value = '/etc/issue.net'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports 
          WHERE port = 22 
          AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-warning-banner-is-configured, cis_safeguard_id:CIS6.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH MaxAuthTries is 4 or less
  platform: linux
  description: |
    The MaxAuthTries parameter specifies the maximum number of authentication attempts permitted per connection.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'MaxAuthTries'
          AND CAST(value AS INTEGER) <= 4
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-maxauthtries-is-4-or-less, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH MaxStartups is configured
  platform: linux
  description: |
    The MaxStartups parameter specifies the maximum number of concurrent unauthenticated connections to the SSH daemon.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config'
          AND label = 'MaxStartups'
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-maxstartups-is-configured, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH LoginGraceTime is one minute or less
  platform: linux
  description: |
    The LoginGraceTime parameter specifies the time allowed for successful authentication to the SSH server.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'LoginGraceTime'
          AND CAST(value AS INTEGER) <= 60
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-logingracetime-is-one-minute-or-less, cis_safeguard_id:CIS6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH ClientAliveInterval and ClientAliveCountMax are configured
  platform: linux
  description: |
    The ClientAliveInterval and ClientAliveCountMax parameters specify the server's timeout configuration.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameters:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'ClientAliveInterval'
          AND CAST(value AS INTEGER) > 0 
          AND CAST(value AS INTEGER) <= 300
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-clientaliveinterval-and-clientalivecountmax-are-configured, cis_safeguard_id:CIS6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH MaxSessions is limited
  platform: linux
  description: |
    The MaxSessions parameter specifies the maximum number of open sessions permitted from a given connection.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/ssh/sshd_config file to set the parameter:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/ssh/sshd_config' 
          AND label = 'MaxSessions'
          AND CAST(value AS INTEGER) <= 10
        ) OR NOT EXISTS (
          SELECT * FROM listening_ports 
          WHERE port = 22 AND protocol = 6
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:ssh-maxsessions-is-limited, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - password creation requirements are configured
  platform: linux
  description: |
    The pam_pwquality.so module checks the strength of passwords.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/security/pwquality.conf file to set password requirements:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/security/pwquality.conf'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:password-creation-requirements-are-configured, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - lockout for failed password attempts is configured
  platform: linux
  description: |
    Lock out users after n unsuccessful consecutive login attempts.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/pam.d/common-auth file and add:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/pam.d/common-auth'
        ) AND EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/security/faillock.conf'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:lockout-for-failed-password-attempts-is-configured, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - password reuse is limited
  platform: linux
  description: |
    The /etc/security/opasswd file stores the users' old passwords and can be checked to ensure users are not recycling recent passwords.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit the /etc/pam.d/common-password file and add:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/pam.d/common-password'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:password-reuse-is-limited, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - password hashing algorithm is sha512
  platform: linux
  description: |
    The sha512 algorithm provides stronger hashing than md5 or sha256.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/pam.d/common-password and ensure the pam_unix.so line includes sha512:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT 1 FROM shadow 
          WHERE hash_alg NOT IN ('sha512', 'yescrypt', '') 
          AND username IN (
            SELECT username FROM users 
            WHERE uid >= 1000 OR username = 'root'
          )
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:password-hashing-algorithm-is-sha512, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - minimum days between password changes is configured
  platform: linux
  description: |
    The PASS_MIN_DAYS parameter in /etc/login.defs allows an administrator to prevent users from changing their password until a minimum number of days have passed.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Set PASS_MIN_DAYS to 1 in /etc/login.defs:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/login.defs' 
          AND label = 'PASS_MIN_DAYS'
          AND CAST(value AS INTEGER) >= 1
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:minimum-days-between-password-changes-is-configured, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - password expiration is 365 days or less
  platform: linux
  description: |
    The PASS_MAX_DAYS parameter in /etc/login.defs allows an administrator to force passwords to expire once they reach a defined age.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Set PASS_MAX_DAYS to 365 or less in /etc/login.defs:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/login.defs' 
          AND label = 'PASS_MAX_DAYS'
          AND CAST(value AS INTEGER) <= 365
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:password-expiration-is-365-days-or-less, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - password expiration warning days is 7 or more
  platform: linux
  description: |
    The PASS_WARN_AGE parameter in /etc/login.defs allows an administrator to notify users that their password will expire in a defined number of days.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Set PASS_WARN_AGE to 7 or more in /etc/login.defs:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/login.defs'
          AND label = 'PASS_WARN_AGE'
          AND CAST(value AS INTEGER) >= 7
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:password-expiration-warning-days-is-7-or-more, cis_safeguard_id:CIS5.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - inactive password lock is 30 days or less
  platform: linux
  description: |
    User accounts that have been inactive for over a given period of time can be automatically disabled.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to set the default password inactivity period to 30 days:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM augeas 
          WHERE path = '/etc/default/useradd' 
          AND label = 'INACTIVE'
          AND CAST(value AS INTEGER) <= 30
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:inactive-password-lock-is-30-days-or-less, cis_safeguard_id:CIS5.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - default group for the root account is GID 0
  platform: linux
  description: |
    The usermod command can be used to specify which group the root user belongs to.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Run the following command to set the root user default group to GID 0:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM users 
          WHERE username = 'root' 
          AND gid = 0
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:default-group-for-the-root-account-is-gid-0, cis_safeguard_id:CIS5.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - default umask for users is configured
  platform: linux
  description: |
    The default umask determines the default permissions for newly created files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Edit /etc/bash.bashrc and /etc/profile to set:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/bash.bashrc'
        ) AND EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/profile'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:default-umask-for-users-is-configured, cis_safeguard_id:CIS5.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - shell timeout is configured
  platform: linux
  description: |
    Setting a timeout value reduces the window of opportunity for unauthorized user access to another user's shell session.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'access-control' and maps to safeguard CIS5.1.
  resolution: |
    1. Review current state (see verification query).
    Create or edit /etc/profile.d/timeout.sh and add:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/profile.d/timeout.sh'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:access-control, requirement:standard, critical:true, control:shell-timeout-is-configured, cis_safeguard_id:CIS5.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/passwd are configured
  platform: linux
  description: |
    The /etc/passwd file contains user account information that is used by many system utilities.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/passwd' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0644'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-passwd-are-configured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/passwd- are configured
  platform: linux
  description: |
    The /etc/passwd- file contains backup user account information.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/passwd-' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0600'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-passwd-are-configured-2, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/group are configured
  platform: linux
  description: |
    The /etc/group file contains a list of all the valid groups defined in the system.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/group' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0644'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-group-are-configured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/group- are configured
  platform: linux
  description: |
    The /etc/group- file contains backup information about groups.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/group-' 
          AND uid = 0 
          AND gid = 0 
          AND mode = '0600'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-group-are-configured-2, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/shadow are configured
  platform: linux
  description: |
    The /etc/shadow file is used to store the information about user accounts that is critical to the security of those accounts.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/shadow' 
          AND uid = 0 
          AND mode = '0640'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-shadow-are-configured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/shadow- are configured
  platform: linux
  description: |
    The /etc/shadow- file is used to store backup information about user accounts.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/shadow-' 
          AND uid = 0 
          AND mode = '0640'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-shadow-are-configured-2, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/gshadow are configured
  platform: linux
  description: |
    The /etc/gshadow file is used to store the information about groups that is critical to the security of those accounts.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/gshadow' 
          AND uid = 0 
          AND mode = '0640'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-gshadow-are-configured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - permissions on /etc/gshadow- are configured
  platform: linux
  description: |
    The /etc/gshadow- file is used to store backup information about groups.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Run the following commands:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE EXISTS (
          SELECT * FROM file 
          WHERE path = '/etc/gshadow-' 
          AND uid = 0 
          AND mode = '0640'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:permissions-on-etc-gshadow-are-configured-2, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - world writable files do not exist (comprehensive)
  platform: linux
  description: |
    Unix-based systems support variable settings to control access to files. World writable files are files that any user can write to.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Remove world write permissions from all files:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT 1 FROM file f
          WHERE f.mode LIKE '%2' 
            AND f.type = 'regular'
            AND f.directory IN (
              '/etc', '/bin', '/sbin', '/usr/bin', '/usr/sbin', 
              '/usr/local/bin', '/usr/local/sbin', '/var/log', 
              '/var/lib', '/var/www', '/opt', '/root'
            )
        ) AND NOT EXISTS (
          SELECT 1 FROM file f
          WHERE f.mode LIKE '%2' 
            AND f.type = 'regular'
            AND f.directory LIKE '/home/%'
        ) AND NOT EXISTS (
          SELECT 1 FROM file f
          WHERE f.mode LIKE '%2' 
            AND f.type = 'regular'
            AND f.directory LIKE '/usr/share/%'
        ) AND NOT EXISTS (
          SELECT 1 FROM file f
          WHERE f.mode LIKE '%2' 
            AND f.type = 'regular'
            AND f.directory LIKE '/var/spool/%'
            AND f.path NOT LIKE '/var/spool/mail/%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:world-writable-files-do-not-exist-comprehensive, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no unowned files or directories exist
  platform: linux
  description: |
    Sometimes when administrators delete users from the passwd file they neglect to remove all files owned by those users from the system.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Locate files that are owned by users or groups not listed in the system configuration files, and reset the ownership of these files to some active user on the system.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT 1 FROM file f 
          LEFT JOIN users u ON f.uid = u.uid 
          WHERE u.uid IS NULL 
            AND f.directory IN (
              '/etc', '/bin', '/sbin', '/usr/bin', '/usr/sbin', 
              '/usr/local/bin', '/usr/local/sbin', '/var/log', 
              '/var/lib', '/opt', '/root'
            )
        ) AND NOT EXISTS (
          SELECT 1 FROM file f 
          LEFT JOIN users u ON f.uid = u.uid 
          WHERE u.uid IS NULL 
            AND f.directory LIKE '/home/%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-unowned-files-or-directories-exist, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no ungrouped files or directories exist (optimized)
  platform: linux
  description: |
    Sometimes when administrators delete groups from the /etc/group file they neglect to remove all files owned by those groups from the system.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Locate files that are owned by groups not listed in the system configuration files, and reset the ownership of these files to an active group.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT 1 FROM file f 
          LEFT JOIN groups g ON f.gid = g.gid 
          WHERE g.gid IS NULL 
            AND f.directory IN (
              '/etc', '/bin', '/sbin', '/usr/bin', '/usr/sbin', 
              '/usr/local/bin', '/usr/local/sbin', '/var/log', 
              '/var/lib', '/opt', '/root'
            )
        ) AND NOT EXISTS (
          SELECT 1 FROM file f 
          LEFT JOIN groups g ON f.gid = g.gid 
          WHERE g.gid IS NULL 
            AND f.directory LIKE '/home/%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-ungrouped-files-or-directories-exist-optimized, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - system accounts are secured
  platform: linux
  description: |
    There are a number of accounts provided with most distributions that are used to manage applications and are not intended to provide an interactive shell.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Set the shell for any accounts returned by the audit to nologin:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM users 
          WHERE uid < 1000 
          AND uid != 0 
          AND shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:system-accounts-are-secured, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - shadow group is empty
  platform: linux
  description: |
    The shadow group allows system programs which require access the ability to read the /etc/shadow file.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Remove all users from the shadow group:
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM user_groups ug
          JOIN groups g ON ug.gid = g.gid
          WHERE g.groupname = 'shadow'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:shadow-group-is-empty, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - all groups in /etc/passwd exist in /etc/group
  platform: linux
  description: |
    Over time, system administration errors and changes can lead to groups being defined in /etc/passwd but not in /etc/group.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Analyze the output of the Audit step and perform the appropriate action to correct any discrepancies found.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT u.* FROM users u 
          LEFT JOIN groups g ON u.gid = g.gid 
          WHERE g.gid IS NULL
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:all-groups-in-etc-passwd-exist-in-etc-group, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no duplicate UIDs exist
  platform: linux
  description: |
    Although the useradd program will not let you create a duplicate User ID (UID), it is possible for an administrator to manually edit the /etc/passwd file and change the UID field.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Based on the results of the audit script, establish unique UIDs and review all files owned by the shared UIDs to determine which UID they are supposed to belong to.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT uid, COUNT(*) as count 
          FROM users 
          GROUP BY uid 
          HAVING count > 1
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-duplicate-uids-exist, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no duplicate GIDs exist
  platform: linux
  description: |
    Although the groupadd program will not let you create a duplicate Group ID (GID), it is possible for an administrator to manually edit the /etc/group file and change the GID field.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Based on the results of the audit script, establish unique GIDs and review all files owned by the shared GIDs to determine which GID they are supposed to belong to.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT gid, COUNT(*) as count 
          FROM groups 
          GROUP BY gid 
          HAVING count > 1
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-duplicate-gids-exist, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no duplicate user names exist
  platform: linux
  description: |
    Although the useradd program will not let you create a duplicate user name, it is possible for an administrator to manually edit the /etc/passwd file and change the user name.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Based on the results of the audit script, establish unique usernames for all users.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT username, COUNT(*) as count 
          FROM users 
          GROUP BY username 
          HAVING count > 1
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-duplicate-user-names-exist, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no duplicate group names exist
  platform: linux
  description: |
    Although the groupadd program will not let you create a duplicate group name, it is possible for an administrator to manually edit the /etc/group file and change the group name.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Based on the results of the audit script, establish unique names for all groups.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT groupname, COUNT(*) as count 
          FROM groups 
          GROUP BY groupname 
          HAVING count > 1
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-duplicate-group-names-exist, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - paths in PATH variable are not writable by non-root users
  platform: linux
  description: |
    If the current working directory (.) or the parent working directory (..) is included in the PATH variable, an attacker could place a malicious program in those locations.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Ensure that no users have . or .. in their PATH variable.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM processes 
          WHERE cmdline LIKE '%PATH=%.:%' 
            OR cmdline LIKE '%PATH=.:/%' 
            OR cmdline LIKE '%PATH=%:.:%' 
            OR cmdline LIKE '%PATH=%::%'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:paths-in-path-variable-are-not-writable-by-non-root-users, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - root is the only UID 0 account
  platform: linux
  description: |
    Any account with UID 0 has superuser privileges on the system.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Remove any users other than root with UID 0 or assign them a new UID if appropriate.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM users 
          WHERE uid = 0 
          AND username != 'root'
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:root-is-the-only-uid-0-account, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - all users home directories exist
  platform: linux
  description: |
    Users can be defined in /etc/passwd without a home directory or with a home directory that does not actually exist.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    If any users' home directories do not exist, create them and make sure the respective user owns the directory.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT u.* FROM users u 
          LEFT JOIN file f ON u.directory = f.path 
          WHERE f.path IS NULL 
          AND u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:all-users-home-directories-exist, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - users own their home directories
  platform: linux
  description: |
    The user home directory is space defined for the particular user to set local environment variables and to store personal files.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Change the ownership of any home directories that are not owned by the defined user to the correct user.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT u.*, f.uid as file_uid 
          FROM users u 
          JOIN file f ON u.directory = f.path 
          WHERE u.uid != f.uid 
          AND u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:users-own-their-home-directories, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - users home directories permissions are 750 or more restrictive
  platform: linux
  description: |
    While the system administrator can establish secure permissions for users' home directories, the users can easily override these.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Making global modifications to user home directories without alerting the user community can result in unexpected outages.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT u.*, f.mode 
          FROM users u 
          JOIN file f ON u.directory = f.path 
          WHERE (
            f.mode LIKE '%1' OR 
            f.mode LIKE '%2' OR 
            f.mode LIKE '%3' OR 
            f.mode LIKE '%4' OR 
            f.mode LIKE '%5' OR 
            f.mode LIKE '%6' OR 
            f.mode LIKE '%7'
          ) 
          AND u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:users-home-directories-permissions-are-750-or-more-restrictive, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - users dot files are not group or world writable
  platform: linux
  description: |
    Group or world-writable user configuration files may enable malicious users to steal or modify other users' data.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Making global modifications to users' files without alerting the user community can result in unexpected outages.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT f.* FROM file f 
          JOIN users u ON f.path LIKE u.directory || '/.%' 
          WHERE u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin') 
          AND (f.mode LIKE '%2%' OR f.mode LIKE '%6%')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:users-dot-files-are-not-group-or-world-writable, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no users have .forward files
  platform: linux
  description: |
    The .forward file specifies an email address to which mail for the user is redirected.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Making global modifications to users' files without alerting the user community can result in unexpected outages and unhappy users.
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file f
          JOIN users u ON f.path = u.directory || '/.forward'
          WHERE u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-users-have-forward-files, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no users have .netrc files
  platform: linux
  description: |
    The .netrc file contains data for logging into a remote host for file transfers via FTP.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Making global modifications to users' files without alerting the user community can result in unexpected outages and unhappy users. Therefore, it is recommended that a monitoring p
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file f
          JOIN users u ON f.path = u.directory || '/.netrc'
          WHERE u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-users-have-netrc-files, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - users .netrc Files are not group or world accessible
  platform: linux
  description: |
    While the system administrator can establish secure permissions for users' .netrc files, the users can easily override these.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Making global modifications to users' files without alerting the user community can result in unexpected outages and unhappy users. Therefore, it is recommended that a monitoring p
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file f
          JOIN users u ON f.path = u.directory || '/.netrc'
          WHERE u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
          AND (f.mode & 0077) != 0
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:users-netrc-files-are-not-group-or-world-accessible, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - no users have .rhosts files
  platform: linux
  description: |
    While no .rhosts files are shipped by default, users can easily create them.
    
    This control is incorporated into the enriched baseline. It reduces risk within category 'updates' and maps to safeguard CIS7.3.
  resolution: |
    1. Review current state (see verification query).
    Making global modifications to users' files without alerting the user community can result in unexpected outages and unhappy users. Therefore, it is recommended that a monitoring p
    2. Apply required configuration per benchmark guidance.
    3. Re-run verification query to confirm compliance.
    4. Automate enforcement via configuration management.
  query: |
    
        SELECT 1 WHERE NOT EXISTS (
          SELECT * FROM file f
          JOIN users u ON f.path = u.directory || '/.rhosts'
          WHERE u.uid >= 1000 
          AND u.shell NOT IN ('/usr/sbin/nologin', '/bin/false', '/sbin/nologin')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:updates, requirement:standard, critical:false, control:no-users-have-rhosts-files, cis_safeguard_id:CIS7.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH MaxAuthTries reduced
  platform: linux
  description: |
    Enforces SSH directive MaxAuthTries to hardened value (MaxAuthTries 3) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: MaxAuthTries 3
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i maxauthtries
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/MaxAuthTries' AND LOWER(value)=LOWER('3'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-maxauthtries-reduced, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH LoginGraceTime short
  platform: linux
  description: |
    Enforces SSH directive LoginGraceTime to hardened value (LoginGraceTime 30) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: LoginGraceTime 30
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i logingracetime
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/LoginGraceTime' AND LOWER(value)=LOWER('30'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-logingracetime-short, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH X11Forwarding disabled
  platform: linux
  description: |
    Enforces SSH directive X11Forwarding to hardened value (X11Forwarding no) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: X11Forwarding no
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i x11forwarding
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/X11Forwarding' AND LOWER(value)=LOWER('no'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-x11forwarding-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH AllowTcpForwarding disabled
  platform: linux
  description: |
    Enforces SSH directive AllowTcpForwarding to hardened value (AllowTcpForwarding no) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: AllowTcpForwarding no
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i allowtcpforwarding
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/AllowTcpForwarding' AND LOWER(value)=LOWER('no'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-allowtcpforwarding-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH idle session timeout enforced
  platform: linux
  description: |
    Enforces SSH directive ClientAliveInterval to hardened value (ClientAliveInterval 300 / ClientAliveCountMax 0) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: ClientAliveInterval 300 ClientAliveCountMax 0
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i clientaliveinterval
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/ClientAliveInterval' AND LOWER(value)=LOWER('300'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-idle-session-timeout-enforced, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH empty passwords disabled
  platform: linux
  description: |
    Enforces SSH directive PermitEmptyPasswords to hardened value (PermitEmptyPasswords no) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: PermitEmptyPasswords no
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i permitemptypasswords
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/PermitEmptyPasswords' AND LOWER(value)=LOWER('no'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-empty-passwords-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH IgnoreRhosts enabled
  platform: linux
  description: |
    Enforces SSH directive IgnoreRhosts to hardened value (IgnoreRhosts yes) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: IgnoreRhosts yes
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i ignorerhosts
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/IgnoreRhosts' AND LOWER(value)=LOWER('yes'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-ignorerhosts-enabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - SSH HostbasedAuthentication disabled
  platform: linux
  description: |
    Enforces SSH directive HostbasedAuthentication to hardened value (HostbasedAuthentication no) reducing attack surface / session abuse risk.
  resolution: |
    1. Edit /etc/ssh/sshd_config and set: HostbasedAuthentication no
    2. Restart: systemctl restart sshd
    3. Verify: sshd -T | grep -i hostbasedauthentication
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM augeas WHERE path='/files/etc/ssh/sshd_config/HostbasedAuthentication' AND LOWER(value)=LOWER('no'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:ssh-config, requirement:standard, critical:true, control:ssh-hostbasedauthentication-disabled, cis_safeguard_id:CIS4.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - system block binary directories not world-writable
  platform: linux
  description: |
    Ensures primary system executable directories (/usr/bin, /usr/local/bin, /bin, /sbin) do not have world-writable permissions. Prevents unauthorized modification or replacement of binaries, supporting controlled execution (application control) objectives.
  resolution: |
    1. Audit permissions: ls -ld /usr/bin /usr/local/bin /bin /sbin
    2. If any show world-writable (..w.. or ....w.), correct: chmod o-w <dir>
    3. Investigate unexpected permission drift (potential compromise or misconfiguration).
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT * FROM file 
        WHERE path IN ('/usr/bin','/usr/local/bin','/bin','/sbin') 
          -- World-writable (others write bit) detection using last octal digit
          AND substr(mode,4,1) IN ('2','3','6','7')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:application-control, requirement:standard, critical:true, control:system-bin-dirs-not-world-writable, cis_safeguard_id:CIS2.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - system encryption configured (crypttab entries present)
  platform: linux
  description: |
    Verifies the presence of one or more active dm-crypt/LUKS mappings declared in /etc/crypttab, indicating encryption at rest is configured for system or data volumes.
  resolution: |
    1. Create encrypted volume: cryptsetup luksFormat /dev/sdxY
    2. Add /etc/crypttab entry: securevol /dev/sdxY none luks
    3. Update /etc/fstab to mount decrypted mapping.
    4. Reboot or activate: systemctl daemon-reload && systemctl restart systemd-cryptsetup@securevol.service
    5. Confirm: cat /etc/crypttab (non-comment lines) & lsblk | grep crypt
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM file_lines WHERE path='/etc/crypttab' AND line NOT LIKE '#%' AND LENGTH(TRIM(line)) > 0);
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:2, platform:linux, category:encryption, requirement:standard, critical:true, control:crypttab-entries-present, cis_safeguard_id:CIS3.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - /home directory not world-writable
  platform: linux
  description: |
    Verifies /home directory itself is not world-writable, reducing broad modification risk to user directories and supporting data access protection objectives.
  resolution: |
    1. Check: ls -ld /home
    2. If mode shows world-writable (..w), remove: chmod o-w /home
    3. Investigate any unexpected permission changes.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM file 
      WHERE path='/home'
        AND substr(mode,4,1) NOT IN ('2','3','6','7')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:data-protection, requirement:standard, critical:true, control:home-dir-not-world-writable, cis_safeguard_id:CIS3.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - backup tool installed (restic or borg)
  platform: linux
  description: |
    Ensures a modern backup utility (restic or borgbackup) is installed to enable periodic secure backups, addressing data recovery capability.
  resolution: |
    1. Install: apt-get install restic (or borgbackup)
    2. Initialize repository: restic init --repo <path>
    3. Schedule backups via systemd timer or cron.
    4. Test restore periodically.
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name IN ('restic','borgbackup'));
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:backup, requirement:standard, critical:true, control:backup-tool-installed, cis_safeguard_id:CIS10.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - backup encryption capability (restic present)
  platform: linux
  description: |
    Confirms restic is installed. Restic encrypts backups by default, providing confidentiality for stored backup data.
  resolution: |
    1. Install restic: apt-get install restic
    2. Initialize encrypted repo: restic init --repo <path>
    3. Store repo password securely (e.g., in a secrets vault).
    4. Run backup and periodically verify restore integrity.
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='restic');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:backup, requirement:standard, critical:true, control:backup-encryption-tool-present, cis_safeguard_id:CIS10.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - malware scanner (ClamAV) installed
  platform: linux
  description: |
    Verifies ClamAV is installed enabling host-based malware scanning in support of detecting known malicious software.
  resolution: |
    1. Install: apt-get install clamav clamav-freshclam
    2. Ensure freshclam service updates signatures.
    3. Schedule periodic scans: clamscan -r / --detect-pua=yes
  query: |
    SELECT 1 WHERE EXISTS (SELECT * FROM deb_packages WHERE name='clamav');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:malware-protection, requirement:standard, critical:true, control:clamav-installed, cis_safeguard_id:CIS9.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - malware definitions recent (ClamAV freshclam)
  platform: linux
  description: |
    Ensures ClamAV signature update log is recent (<7 days) indicating active malware definition maintenance.
  resolution: |
    1. Confirm freshclam service active: systemctl status clamav-freshclam
    2. If outdated: systemctl restart clamav-freshclam or verify network egress.
    3. Investigate persistent update failures.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM file WHERE path='/var/log/clamav/freshclam.log' AND (strftime('%s','now') - mtime) < 604800
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:malware-protection, requirement:standard, critical:true, control:clamav-definitions-recent, cis_safeguard_id:CIS9.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS - crash telemetry (apport) disabled
  platform: linux
  description: |
    Confirms apport crash reporting is disabled to reduce unsolicited transmission or storage of sensitive crash data, supporting privacy/telemetry minimization.
  resolution: |
    1. Edit /etc/default/apport and set: enabled=0
    2. Remove any core dumps containing sensitive data.
    3. Restart apport service if needed: systemctl stop apport.service
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT * FROM file_lines WHERE path='/etc/default/apport' AND line LIKE 'enabled=0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:ubuntu24, level:1, platform:linux, category:privacy-telemetry, requirement:standard, critical:true, control:apport-disabled, cis_safeguard_id:CIS13.2
  contributors: karmine05

