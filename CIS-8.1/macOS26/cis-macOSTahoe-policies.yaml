apiVersion: v1
kind: policy
spec:
  name: CIS 1.1 (L1) Ensure Apple-provided Software Updates Are Installed (Automated)
  platform: darwin
  description: |
    Software vendors release security patches and software updates for their products when security vulnerabilities are discovered. There is no simple way to complete this action without a network connection to an Apple software repository. Please ensure appropriate access for this control. This check is only for what Apple provides through software update.
    Note: This query may be longer than the avg query and may take more than 10 seconds to run.
  resolution: |
    Graphical Method:
    Perform the following to install all available software updates:
      1. Open System Settings 
      2. Select General
      3. Select Software Update
      4. Select Update All
  query: SELECT 1 FROM software_update WHERE software_update_required = '0';
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:updates, requirement:fleetd, critical:false, control:apple-provided-software-current, cis_category:Install Updates, Patches and Additional Security Software, cis_subcategory:Ensure Apple-provided Software Updates Are Installed, cis_safeguard_ids:CIS1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.2 (L2) Audit History and Remove History Items (Manual)
  platform: darwin
  description: |
    Audits retention of Safari browsing history; organizations may require periodic removal to reduce data exposure and privacy risk.
  resolution: |
    Configure Safari to clear history per organizational schedule or deploy MDM profile enforcing history retention limits.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Safari' AND 
            name='HistoryAgeInDaysLimit' AND 
            value = 1
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Safari' AND 
            name='HistoryAgeInDaysLimit' AND 
            value != 1
        );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:browser, requirement:mdm, critical:false, control:safari-history-audited, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.1 (L1) Ensure Automatic Opening of Safe Files in Safari Is Disabled (Automated)
  platform: darwin
  description: |
    Disables automatic opening of so-called "safe" files after download to prevent unintended execution or launch of malicious content.
  resolution: |
    Enforce via MDM Safari preference disabling AutoOpenSafeDownloads.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Safari' AND 
            name='AutoOpenSafeDownloads' AND 
            (value = 0 OR value = 'false')
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Safari' AND 
            name='AutoOpenSafeDownloads' AND 
            (value != 0 AND value != 'false')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:browser, requirement:mdm, critical:false, control:safari-auto-open-safe-files-disabled, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.3 (L1) Ensure Warn When Visiting A Fraudulent Website in Safari Is Enabled ..371 (Automated)
  platform: darwin
  description: |
    Ensures phishing/malware warning feature active to alert users of known fraudulent sites.
  resolution: |
    Enforce via MDM Safari preference WarnAboutFraudulentWebsites set true.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies
        WHERE domain='com.apple.Safari'
          AND name='WarnAboutFraudulentWebsites'
          AND (value=1 OR value='true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies
        WHERE domain='com.apple.Safari'
          AND name='WarnAboutFraudulentWebsites'
          AND (value!=1 AND value!='true')
      );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:browser, requirement:mdm, critical:false, control:safari-fraudulent-website-warning, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.2 (L1) Ensure System Integrity Protection Status (SIP) Is Enabled (Automated)
  platform: darwin
  description: |
    Ensures advertising privacy protection enabled limiting ad tracking vectors in Safari.
  resolution: |
    Configure Safari > Privacy: enable advertising privacy protection; deploy profile where supported.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM users AS u
      LEFT JOIN (
        SELECT * FROM plist WHERE
          path LIKE '/Users/%/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist' AND
          key = 'WebKitPreferences.privateClickMeasurementEnabled' AND
          value = '1') AS p
      ON p.path = CONCAT(u.directory, '/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist')
      WHERE u.directory LIKE '/Users/%' AND
      p.value IS NULL
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:browser-privacy, requirement:fda, critical:false, control:safari-ad-privacy-protection, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.7 (L1) Ensure Show Full Website Address in Safari Is Enabled (Automated)
  platform: darwin
  description: |
    Displays full URL in address bar improving user awareness of actual destination host/path mitigating phishing.
  resolution: |
    Apply MDM Safari ShowFullURLInSmartSearchField true.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Safari' AND 
            name='ShowFullURLInSmartSearchField' AND 
            (value = 1 OR value = 'true') 
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Safari' AND 
            name='ShowFullURLInSmartSearchField' AND 
            (value != 1 AND value != 'true')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:browser, requirement:mdm, critical:false, control:safari-show-full-address, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.10 (L1) Ensure Show Status Bar Is Enabled (Automated)
  platform: darwin
  description: |
    Shows status bar revealing target link destinations aiding phishing detection.
  resolution: |
    Enforce via MDM Safari ShowStatusBar true or script defaults write.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies
        WHERE domain='com.apple.Safari'
          AND name='ShowOverlayStatusBar'
          AND (value=1 OR value='true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies
        WHERE domain='com.apple.Safari'
          AND name='ShowOverlayStatusBar'
          AND (value!=1 AND value!='true')
      );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:browser, requirement:mdm, critical:false, control:safari-show-status-bar, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.10
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.4.1 (L1) Ensure Secure Keyboard Entry Terminal.app Is Enabled (Automated)
  platform: darwin
  description: |
    Secure Keyboard Entry reduces risk of keystroke interception by other processes when typing sensitive data in Terminal.app.
  resolution: |
    Enable in Terminal > Settings > Profiles > Keyboard or deploy MDM preference.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Terminal' AND 
            name='SecureKeyboardEntry' AND 
            (value = 1 OR value = 'true')
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.Terminal' AND 
            name='SecureKeyboardEntry' AND 
            (value != 1 AND value != 'true')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:terminal, requirement:mdm, critical:false, control:terminal-secure-keyboard-entry, cis_category:Applications, cis_subcategory:Terminal, cis_safeguard_ids:CIS6.4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 3.2 (L2) Ensure Security Auditing Flags For User-Attributable Events Are Configured Per Local Organizational Requirements (Automated)
  platform: darwin
  description: |
    Verifies audit_control flag configuration includes required user-attributable event classes (ex, ad, lo) to support forensic accountability.
  resolution: |
    Edit /etc/security/audit_control flags line to include required classes (e.g. lo,ad,ex) per policy then restart audit: sudo audit -s
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT line
      FROM file_lines
      WHERE path='/etc/security/audit_control'
        AND (
          (
            line LIKE 'flags:%'
            AND line LIKE '%-fm%'
            AND line LIKE '%ad%'
            AND line LIKE '%-ex%'
            AND line LIKE '%aa%'
            AND line LIKE '%-fr%'
            AND line LIKE '%lo%'
            AND line LIKE '%-fw%'
          )
          OR (
            line LIKE 'flags:%'
            AND line LIKE '%-all%'
            AND line LIKE '%ad%'
            AND line LIKE '%aa%'
            AND line LIKE '%lo%'
          )
        )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:audit, requirement:standard, critical:false, control:audit-flags-user-events, cis_category:Logging and Auditing, cis_subcategory:Logging and Auditing, cis_safeguard_ids:CIS3.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.1.1 (L1) Audit Show All Filename Extensions (Manual)
  platform: darwin
  description: |
    Displays full file extensions preventing spoofing of executable or malicious content disguised by hidden extensions.
  resolution: |
    Set Finder preference AppleShowAllExtensions true (defaults write NSGlobalDomain AppleShowAllExtensions -bool true).
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM users AS u
      LEFT JOIN (
        SELECT * FROM plist WHERE
          path LIKE '/Users/%/Library/Preferences/.GlobalPreferences.plist' AND
          key = 'AppleShowAllExtensions' AND
          value = '1') AS p
      ON p.path = CONCAT(u.directory, '/Library/Preferences/.GlobalPreferences.plist')
        WHERE u.directory LIKE '/Users/%' AND
        p.value IS NULL
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:ui-awareness, requirement:standard, critical:false, control:show-all-filename-extensions, cis_category:Applications, cis_subcategory:Finder, cis_safeguard_ids:CIS6.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.5 (L1) Ensure a Separate Timestamp Is Enabled for Each User/tty Combo (Automated)
  platform: darwin
  description: |
    Ensures sudo uses per-terminal timestamp files preventing cross-user reuse of cached credentials.
  resolution: |
    In sudoers avoid timestamp_type=global; enforce tty_tickets (default) or explicitly set Defaults timestamp_type=tty.
  query: |
    SELECT 1 WHERE EXISTS(
      SELECT
        COALESCE(JSON_EXTRACT(
          json_result, '$.Type of authentication timestamp record'
        ), '') AS type_of_auth_timestamp_record
      FROM sudo_info WHERE type_of_auth_timestamp_record = 'tty'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authz, requirement:fleetd, critical:false, control:per-tty-sudo-timestamp, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure a Separate Timestamp Is Enabled for Each User/tty Combo, cis_safeguard_ids:CIS5.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.3.1 (L1) Ensure all user storage APFS volumes are encrypted (Manual)
  platform: darwin
  description: |
    Confirms all mounted user data APFS volumes have encryption enabled protecting data at rest.
  resolution: |
    Enable encryption on unencrypted APFS volumes via Disk Utility or diskutil apfs encryptVolume.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM apfs_volumes
      WHERE role NOT IN ('VM','Update','Recovery','Preboot','xART','Hardware')
        AND filevault != 1
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:encryption, requirement:fleetd, critical:false, control:apfs-user-volumes-encrypted, cis_category:System Access, Authentication and Authorization, cis_subcategory:Encryption, cis_safeguard_ids:CIS5.3.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.3.1 (L1) Ensure all user storage APFS volumes are encrypted (Manual) [corestorage-user-volumes-encrypted]
  platform: darwin
  description: |
    Ensures legacy CoreStorage logical volumes (if present) are encrypted to maintain confidentiality of residual deployments.
  resolution: |
    Convert or enable encryption: diskutil coreStorage convert <LVUUID> -passphrase
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM corestorage_logical_volume_families
      WHERE EncryptionType != 'AES-XTS'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:encryption, requirement:fleetd, critical:false, control:corestorage-user-volumes-encrypted, cis_category:System Access, Authentication and Authorization, cis_subcategory:Encryption, cis_safeguard_ids:CIS5.3.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.7 (L1) Ensure an Administrator Account Cannot Login to Another User's Active and Locked Session (Automated)
  platform: darwin
  description: |
    Prevents administrative user from taking over a locked active user session without authentication, preserving user session integrity.
  resolution: |
    Ensure fast user switching and session takeover restrictions are configured; require proper unlock of original session.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT JSON_EXTRACT(json_result, '$.rule') AS rule
      FROM authdb
      WHERE right_name = 'system.login.screensaver' AND 
      rule LIKE '%authenticate-session-owner%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authz, requirement:fleetd, critical:false, control:admin-cannot-takeover-locked-session, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure an Administrator Account Cannot Login to Another User's Active and Locked Session, cis_safeguard_ids:CIS5.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.6 (L1) Ensure the "root" Account Is Disabled (Automated)
  platform: darwin
  description: |
    Ensures the root user cannot directly authenticate reducing risk of full privilege compromise without traceability.
  resolution: |
    dsenableroot -d (verify root login disabled) or use Directory Utility.
  query: SELECT 1 from dscl WHERE command = 'read' AND path = '/Users/root' AND key = 'AuthenticationAuthority' AND value = '';
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:accounts, requirement:fleetd, critical:false, control:root-account-disabled, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure the "root" Account Is Disabled, cis_safeguard_ids:CIS5.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.9 (L1) Ensure the Guest Home Folder Does Not Exist (Automated)
  platform: darwin
  description: |
    Validates removal of residual Guest user home directory to prevent data persistence or reuse.
  resolution: |
    Remove Guest home: sudo rm -rf /Users/Guest
  query: SELECT 1 WHERE NOT EXISTS (SELECT * FROM file WHERE path = '/Users/Guest');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:accounts, requirement:standard, critical:false, control:guest-home-folder-removed, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure the Guest Home Folder Does Not Exist, cis_safeguard_ids:CIS5.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.5 (L2) Audit Hide IP Address in Safari Setting (Manual)
  platform: darwin
  description: |
    Enables IP address hiding (via iCloud Private Relay / proxy) to reduce passive tracking. Organizational choice based on network policy.
  resolution: |
    Enable Hide IP feature in Safari preferences or via profile.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM plist
        WHERE path LIKE '/Users/%/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist'
          AND key='WBSPrivacyProxyAvailabilityTraffic'
          AND ((CAST(value AS INT) >> 2) & 1)=1
      )
      AND NOT EXISTS (
        SELECT 1 FROM plist
        WHERE path LIKE '/Users/%/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist'
          AND key='WBSPrivacyProxyAvailabilityTraffic'
          AND ((CAST(value AS INT) >> 2) & 1)=0
      )
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:browser-privacy, requirement:standard, critical:false, control:safari-hide-ip-enabled, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.5 (L2) Audit Hide IP Address in Safari Setting (Manual) [safari-hide-ip-disabled]
  platform: darwin
  description: |
    Disables IP hiding where inspection, legal logging, or region-specific access is required. Organizational choice.
  resolution: |
    Disable Hide IP in Safari or profile setting.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM plist
        WHERE path LIKE '/Users/%/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist'
          AND key='WBSPrivacyProxyAvailabilityTraffic'
          AND ((CAST(value AS INT) >> 2) & 1)=0
      )
      AND NOT EXISTS (
        SELECT 1 FROM plist
        WHERE path LIKE '/Users/%/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist'
          AND key='WBSPrivacyProxyAvailabilityTraffic'
          AND ((CAST(value AS INT) >> 2) & 1)=1
      )
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:browser-privacy, requirement:standard, critical:false, control:safari-hide-ip-disabled, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.1.1 (L1) Ensure External Intelligence Extensions Is Disabled (Automated)
  platform: darwin
  description: |
    Disables AI/ML external intelligence content extensions to reduce data leakage and unvetted code execution.
  resolution: |
    Enforce via MDM disabling external intelligence extensions.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM managed_policies WHERE domain='com.apple.IntelligencePlatform' AND name='ExternalIntelligenceExtensionsEnabled' AND (value=1 OR value='true')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy, requirement:mdm, critical:false, control:external-intelligence-extensions-disabled, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.1.3 (L1) Ensure Mail Summarization Is Disabled (Automated)
  platform: darwin
  description: |
    Disables mail summarization to prevent potential leakage of sensitive email contents in notification or summary contexts.
  resolution: |
    Deploy MDM profile disabling Mail intelligent summaries.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM managed_policies WHERE domain='com.apple.mail' AND name='SummarizationEnabled' AND (value=1 OR value='true')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy, requirement:mdm, critical:false, control:mail-summarization-disabled, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.1.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.1.4 (L1) Ensure Notes Summarization Is Disabled (Automated)
  platform: darwin
  description: |
    Disables notes summarization preventing analysis or display of sensitive note contents in summaries.
  resolution: |
    Deploy MDM profile disabling Notes intelligent summaries.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM managed_policies WHERE domain='com.apple.notes' AND name='SummarizationEnabled' AND (value=1 OR value='true')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy, requirement:mdm, critical:false, control:notes-summarization-disabled, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.1.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.1.2 (L1) Ensure Writing Tools Is Disabled (Automated)
  platform: darwin
  description: |
    Disables system writing assistance / generative tools where policy restricts AI-based text generation for sensitive data handling.
  resolution: |
    Apply MDM disabling system writing tools features.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM managed_policies WHERE domain='com.apple.writingtools' AND name='WritingToolsEnabled' AND (value=1 OR value='true')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy, requirement:mdm, critical:false, control:writing-tools-disabled, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.3 (L2) Ensure Complex Password Must Contain Alphabetic Characters Is Configured (Manual)
  platform: darwin
  description: |
    Ensures password policy enforces at least one alphabetic (A-Z or a-z) and one numeric (0-9) character to increase password entropy and resist simple brute force.
  resolution: |
    Enforce via MDM profile (Password policy payload) requiring alphanumeric composition.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.mobiledevice.passwordpolicy' AND 
            name='requireAlphanumeric' AND 
            (value = 1 OR value = 'true')
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.mobiledevice.passwordpolicy' AND 
            name='requireAlphanumeric' AND 
            (value != 1 AND value != 'true')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:authn, requirement:mdm, critical:false, control:password-requires-alpha-numeric, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.3 (L2) Ensure Complex Password Must Contain Alphabetic Characters Is Configured (Manual) [password-requires-special]
  platform: darwin
  description: |
    Ensures password policy mandates inclusion of at least one non-alphanumeric (symbol) character increasing complexity against dictionary attacks.
  resolution: |
    Enforce via MDM password payload enabling special character requirement.
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.mobiledevice.passwordpolicy' AND 
            name='minComplexChars' AND 
            value >= 1
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.mobiledevice.passwordpolicy' AND 
            name='minComplexChars' AND 
            value < 1
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:authn, requirement:mdm, critical:false, control:password-requires-special, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.6 (L2) Ensure Complex Password Must Contain Uppercase and Lowercase Characters Is Configured (Manual)
  platform: darwin
  description: |
    Ensures password policy requires mixed case characters to expand effective keyspace and reduce successful guess rates.
  resolution: |
    Configure password policy enforcing both uppercase and lowercase usage.
  query: SELECT 1 FROM  pwd_policy where min_mixed_case_characters >= 1;
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:authn, requirement:fleetd, critical:false, control:password-requires-mixed-case, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.1 (L1) Ensure Password Account Lockout Threshold Is Configured (Automated)
  platform: darwin
  description: |
    Enforces lockout after a defined number of failed authentication attempts to slow brute force attacks.
  resolution: |
    Set failed attempt threshold (e.g., 5) via password policy / security command.
  query: SELECT 1 FROM  pwd_policy where max_failed_attempts <= 5;
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authn, requirement:fleetd, critical:false, control:password-lockout-threshold, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.2 (L1) Ensure Password Minimum Length Is Configured (Automated)
  platform: darwin
  description: |
    Ensures a minimum password length to increase resistance to brute force. CIS commonly recommends >= 14 where feasible.
  resolution: |
    Set minimum length in password policy (e.g., pwpolicy -setminlength 14).
  query: |
    SELECT 1 
    FROM (
    SELECT cast(lengthtxt as integer(2)) minlength 
    FROM (
    SELECT SUBSTRING(length, 1, 2) AS lengthtxt 
    FROM (
    SELECT policy_description, policy_identifier, split(policy_content, '{', 1) AS length 
    FROM password_policy 
    WHERE policy_identifier LIKE '%minLength')) 
    WHERE minlength >= 15);
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authn, requirement:standard, critical:false, control:password-min-length, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.7 (L1) Ensure Password Age Is Configured (Automated)
  platform: darwin
  description: |
    Limits maximum password lifetime forcing periodic changes reducing exposure window of compromised credentials.
  resolution: |
    Set max age (e.g., 365 days or per org policy) in password policy.
  query: |
    SELECT 1 WHERE
    EXISTS(SELECT 1 FROM pwd_policy WHERE expires_every_n_days <= 365)
    OR
    EXISTS(SELECT 1 FROM pwd_policy WHERE days_to_expiration <= 365);
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authn, requirement:fleetd, critical:false, control:password-max-age, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.8 (L1) Ensure Password History Is Set to at least 24 (Automated)
  platform: darwin
  description: |
    Prevents reuse of recently used passwords (history >= 24) mitigating rapid cycle reuse to bypass aging controls.
  resolution: |
    Enforce password history length (24 or more) via MDM password payload.
  query: SELECT 1 FROM pwd_policy WHERE history_depth >= 24;
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authn, requirement:mdm, critical:false, control:password-history-24, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.8
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.11 (L1) Ensure Logging Is Enabled for Sudo (Automated)
  platform: darwin
  description: |
    Ensures sudo command usage is logged for accountability and forensic review.
  resolution: |
    Configure sudoers with proper log settings (defaults log_output, use syslog or iolog_dir).
  query: |
    SELECT 1 AS result
    FROM (
      SELECT 1 FROM file_lines
      WHERE path = '/etc/sudoers'
        AND line LIKE '%Defaults%log_allowed%'
        AND line NOT LIKE '%!log_allowed%'
        AND line NOT LIKE '#%'
      UNION ALL
      SELECT 1 FROM file_lines
      WHERE path LIKE '/etc/sudoers.d/%'
        AND line LIKE '%Defaults%log_allowed%'
        AND line NOT LIKE '%!log_allowed%'
        AND line NOT LIKE '#%'
    ) AS matches
    LIMIT 1;
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:audit, requirement:fleetd, critical:false, control:sudo-logging-enabled, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure Logging Is Enabled for Sudo, cis_safeguard_ids:CIS5.11
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.4 (L1) Ensure the Sudo Timeout Period Is Set to Zero (Automated)
  platform: darwin
  description: |
    Requires re-authentication for every sudo invocation by setting timestamp timeout to 0 reducing risk of privilege reuse.
  resolution: |
    In sudoers set: Defaults timestamp_timeout=0
  query: |
    SELECT 1 WHERE EXISTS(
      SELECT * FROM file WHERE path = '/etc/sudoers.d' AND uid = 0 AND gid = 0
    ) AND EXISTS(
      SELECT
        COALESCE(JSON_EXTRACT(
          json_result, '$.Authentication timestamp timeout'
        ), '') AS authentication_timestamp_timeout
      FROM sudo_info WHERE authentication_timestamp_timeout = '0.0 minutes'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authz, requirement:fleetd, critical:false, control:sudo-timeout-zero, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure the Sudo Timeout Period Is Set to Zero, cis_safeguard_ids:CIS5.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 3.4 (L1) Ensure Security Auditing Retention Is Enabled (Automated)
  platform: darwin
  description: |
    Ensures /var/log/install.log retention keeps at least 365 days and no global max size limiting future entries.
  resolution: |
    Edit /etc/asl/com.apple.install and set ttl=365 (or greater) and remove any all_max= entry.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM file_lines
        WHERE path='/etc/asl/com.apple.install'
          AND line LIKE 'ttl=%'
          AND CAST(REPLACE(line,'ttl=','') AS INT) >= 365
      )
      AND NOT EXISTS (
        SELECT 1 FROM file_lines
        WHERE path='/etc/asl/com.apple.install'
          AND line LIKE '%all_max=%'
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:audit, requirement:standard, critical:false, control:install-log-retained-365-days, cis_category:Logging and Auditing, cis_subcategory:Ensure install.log Is Retained for 365 or More Days and No Maximum Size, cis_safeguard_ids:CIS3.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 3.4 (L1) Ensure Security Auditing Retention Is Enabled (Automated) [expire-after:60d OR 5G]
  platform: darwin
  description: |
    Verifies audit_control expire-after retains at least 60 days or 5G so audit trail is sufficient for investigations.
  resolution: |
    Set line in /etc/security/audit_control: expire-after:60d OR 5G
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path = '/etc/security/audit_control'
        AND CAST(regex_match(line, 'expire-after:(\\d+)d OR (\\d+)G', 1) AS INTEGER) >= 60
        AND CAST(regex_match(line, 'expire-after:(\\d+)d OR (\\d+)G', 2) AS INTEGER) >= 5
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:audit, requirement:standard, critical:false, control:audit-retention-configured, cis_category:Logging and Auditing, cis_subcategory:Ensure install.log Is Retained for 365 or More Days and No Maximum Size, cis_safeguard_ids:CIS3.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 3.5 (L1) Ensure Access to Audit Records Is Controlled (Automated)
  platform: darwin
  description: |
    Ensures /var/audit and configured audit directory plus audit_control are owned by root:wheel and have restrictive modes (0440 files, 0400 audit_control) to prevent tampering.
  resolution: |
    chown -R root:wheel /etc/security/audit_control; chmod 400 /etc/security/audit_control
    For audit dir from audit_control: chown -R root:wheel <dir>; chmod -R og-rw <dir>
  query: |
    SELECT 1 WHERE (
      NOT EXISTS (SELECT 1 FROM file WHERE path LIKE '/var/audit/%' AND (uid != 0 OR gid != 0 OR mode != '0440'))
      AND NOT EXISTS (
        SELECT 1 FROM file WHERE path = '/etc/security/audit_control' AND mode != '0400'
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:audit, requirement:standard, critical:false, control:access-to-audit-records-controlled, cis_category:Logging and Auditing, cis_subcategory:Ensure install.log Is Retained for 365 or More Days and No Maximum Size, cis_safeguard_ids:CIS3.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 4.1 (L2) Ensure Bonjour Advertising Services Is Disabled (Automated)
  platform: darwin
  description: |
    Disables multicast advertisement to reduce unnecessary service exposure on local networks.
  resolution: |
    MDM profile: com.apple.mDNSResponder NoMulticastAdvertisements => <true/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.mDNSResponder' AND name='NoMulticastAdvertisements' AND (value=1 OR value='true'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.mDNSResponder' AND name='NoMulticastAdvertisements' AND (value!=1 AND value!='true'))
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:network, requirement:mdm, critical:false, control:bonjour-advertising-disabled, cis_category:Network Configurations, cis_subcategory:Ensure Bonjour Advertising Services Is Disabled, cis_safeguard_ids:CIS4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 4.2 (L1) Ensure HTTP Server Is Disabled (Automated)
  platform: darwin
  description: |
    Ensures built-in Apache httpd is not running reducing attack surface of endpoint systems.
  resolution: |
    launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM processes WHERE path='/usr/sbin/httpd');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:network, requirement:standard, critical:false, control:http-server-disabled, cis_category:Network Configurations, cis_subcategory:Ensure HTTP Server Is Disabled, cis_safeguard_ids:CIS4.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 4.3 (L1) Ensure NFS Server Is Disabled (Automated)
  platform: darwin
  description: |
    Disables legacy NFS file sharing components (nfsd, /etc/exports) to minimize exposure and data leakage.
  resolution: |
    launchctl disable system/com.apple.nfsd; rm -f /etc/exports
  query: |
    SELECT 1 WHERE (
      NOT EXISTS(SELECT 1 FROM processes WHERE path='/sbin/nfsd')
      AND NOT EXISTS(SELECT 1 FROM file WHERE path='/etc/exports')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:network, requirement:standard, critical:false, control:nfs-server-disabled, cis_category:Network Configurations, cis_subcategory:Ensure NFS Server Is Disabled, cis_safeguard_ids:CIS4.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.1 (L1) Ensure Home Folders Are Secure (Automated)
  platform: darwin
  description: |
    Validates user home directories are not group/other readable beyond minimal execute traversal as allowed (0700/0701/0710/0711 only).
  resolution: |
    chmod -R og-rwx /Users/<user> (or) chmod -R og-rw /Users/<user> if execute needed.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM file WHERE path LIKE '/Users/%' AND path != '/Users/Shared/' AND mode NOT IN ('0700','0701','0710','0711')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:accounts, requirement:standard, critical:false, control:home-folders-secure, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.2 (L1) Ensure System Integrity Protection Status (SIP) Is Enabled (Automated) [sip-enabled]
  platform: darwin
  description: |
    Confirms SIP is active preventing modification of protected system locations and runtime attachment to system processes.
  resolution: |
    Reboot to Recovery and run: csrutil enable
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sip_config WHERE config_flag='sip' AND enabled=1);
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:system-protection, requirement:standard, critical:false, control:sip-enabled, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.3 (L1) Ensure Apple Mobile File Integrity (AMFI) Is Enabled (Automated)
  platform: darwin
  description: |
    Verifies AMFI code signing enforcement preventing unsigned code execution.
  resolution: |
    Clear nvram boot-args if disabling flags present: nvram boot-args=""
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM nvram_info
      WHERE amfi_enabled='1'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:system-protection, requirement:fleetd, critical:false, control:amfi-enabled, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.4 (L1) Ensure Signed System Volume (SSV) Is Enabled (Automated)
  platform: darwin
  description: |
    Confirms SSV cryptographic seal integrity ensuring system volume tamper detection.
  resolution: |
    If disabled, backup data and perform clean OS reinstall to restore sealed system integrity.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM csrutil_info WHERE ssv_enabled='1');
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:system-protection, requirement:fleetd, critical:false, control:ssv-enabled, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.5 (L1) Ensure Appropriate Permissions Are Enabled for System Wide Applications (Automated)
  platform: darwin
  description: |
    Ensures /Applications bundles are not world-writable preventing malicious tampering.
  resolution: |
    find /Applications -iname '*.app' -type d -perm -2 -exec chmod -R o-w {} +
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM apps LEFT JOIN file ON file.path = apps.path
      WHERE apps.path LIKE '/Applications/%' AND (CAST(SUBSTR(file.mode,-1) AS INTEGER) & 0x2) != 0
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:application-control, requirement:standard, critical:false, control:applications-not-world-writable, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.6 (L1) Ensure No World Writable Folders Exist in the System Folder (Automated)
  platform: darwin
  description: |
    Detects world-writable directories under /System/Volumes/Data/System excluding expected Apple Drop Box locations.
  resolution: |
    find /System/Volumes/Data/System -type d -perm -2 ! -path '*Drop Box*' -exec chmod o-w {} +
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM find_cmd WHERE directory='/System/Volumes/Data/System' AND type='d' AND perm='-2' AND path NOT LIKE '%Drop Box%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:application-control, requirement:standard, critical:false, control:no-world-writable-system-dirs, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.1.7 (L2) Ensure No World Writable Folders Exist in the Library Folder (Automated)
  platform: darwin
  description: |
    Detects world-writable Library directories lacking sticky bit or rootless attribute which could permit unauthorized modifications.
  resolution: |
    find /Library -type d -perm -002 ! -perm -1000 ! -xattrname com.apple.rootless -exec chmod o-w {} +
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM file f
      WHERE f.path LIKE '/Library/%' AND f.type='directory'
        AND (CAST(SUBSTR(f.mode,-1) AS INTEGER) & 2) = 2
        AND NOT ((CAST(f.mode AS INTEGER) & 01000) = 01000)
        AND NOT EXISTS (
          SELECT 1 FROM extended_attributes ea WHERE ea.path = f.path AND ea.key='com.apple.rootless'
        )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:application-control, requirement:fleetd, critical:false, control:no-world-writable-library-dirs, cis_category:System Access, Authentication and Authorization, cis_subcategory:File System Permissions and Access Controls, cis_safeguard_ids:CIS5.1.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.1.1 (L2) Ensure Location Services Is Enabled (Automated)
  platform: darwin
  description: |
    Disables location services globally where organizational policy dictates no application may access location data.
  resolution: |
    System Settings > Privacy & Security > Location Services: turn off.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM location_services WHERE enabled = 0
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:privacy-location, requirement:standard, critical:false, control:location-services-disabled-all, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.1 (L2) Location Services (Manual)
  platform: darwin
  description: |
    Ensures only an approved allowlist of applications have location access when location services are enabled.
  resolution: |
    Adjust allowed apps in System Settings > Privacy & Security > Location Services per approved list.
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM location_services WHERE enabled = 0)
      OR NOT EXISTS (
        SELECT 1 FROM plist WHERE 
          path='/var/db/locationd/clients.plist'  
          AND subkey = 'Authorized'  
          AND value = '1'  
          AND NOT (
            key LIKE '%:com.apple.TV' OR
            key LIKE '%com.apple.locationd.bundle-/System/Library/PrivateFrameworks/CoreParsec.framework' OR
            key LIKE '%:com.apple.locationd.bundle-/System/Library/LocationBundles/DoNotDisturb.bundle'
          )
      )
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:privacy-location, requirement:standard, critical:false, control:location-services-allowlist, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.4 (L1) Ensure Limit Ad Tracking Is Enabled (Automated)
  platform: darwin
  description: |
    Disables Apple personalized advertising to reduce privacy exposure.
  resolution: |
    MDM profile: com.apple.applicationaccess allowApplePersonalizedAdvertising => <false/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowApplePersonalizedAdvertising' AND (value=0 OR value='false'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowApplePersonalizedAdvertising' AND (value!=0 AND value!='false'))
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy-advertising, requirement:mdm, critical:false, control:limit-ad-tracking-enabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.8 (L1) Ensure an Administrator Password Is Required to Access System-Wide Preferences (Automated)
  platform: darwin
  description: |
    Requires admin authentication for system-wide settings to restrict unauthorized changes.
  resolution: |
    System Settings > Privacy & Security > Advanced > Enable 'Require an administrator password to access system-wide settings'.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM authdb WHERE right_name = 'system.preferences' AND json_extract(json_result, '$.shared') == 0
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authz, requirement:fleetd, critical:false, control:admin-password-for-prefs, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.8
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.7.1 (L2) Ensure Screen Saver Corners Are Secure (Automated)
  platform: darwin
  description: |
    Ensures no hot corner disables screen saver; prevents bypass of lock via corner trigger.
  resolution: |
    Remove 'Disable Screen Saver' from any hot corner in Desktop & Dock > Hot Corners.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.dock.plist' AND key IN ('wvous-br-corner','wvous-bl-corner','wvous-tr-corner','wvous-tl-corner') AND value = 6
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:screen-lock, requirement:fda, critical:false, control:secure-screen-corners, cis_category:System Settings, cis_subcategory:Desktop & Dock, cis_safeguard_ids:CIS2.7.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.8.1 (L1) Audit Universal Control Settings (Manual)
  platform: darwin
  description: |
    Validates Universal Control is enabled when allowed for multi-device productivity.
  resolution: |
    MDM profile: com.apple.universalcontrol Disable => <false/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.universalcontrol' AND name='Disable' AND (value=0 OR value='false'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.universalcontrol' AND name='Disable' AND (value!=0 AND value!='false'))
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:continuity, requirement:mdm, critical:false, control:universal-control-enabled, cis_category:System Settings, cis_subcategory:Displays, cis_safeguard_ids:CIS2.8.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.8.1 (L1) Audit Universal Control Settings (Manual) [universal-control-disabled]
  platform: darwin
  description: |
    Ensures Universal Control disabled where data segregation or device isolation is required.
  resolution: |
    MDM profile: com.apple.universalcontrol Disable => <true/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.universalcontrol' AND name='Disable' AND (value=1 OR value='true'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.universalcontrol' AND name='Disable' AND (value!=1 AND value!='true'))
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:continuity, requirement:mdm, critical:false, control:universal-control-disabled, cis_category:System Settings, cis_subcategory:Displays, cis_safeguard_ids:CIS2.8.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.10.2 (L1) Ensure Power Nap Is Disabled for Intel Macs (Automated)
  platform: darwin
  description: |
    Disables Power Nap preventing background network activity during sleep that could expose the system.
  resolution: |
    pmset -a powernap 0
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM (
        SELECT COALESCE(JSON_EXTRACT(JSON_EXTRACT(json_result,'$.AC Power:'),'$.powernap'),'') AS powernap_ac,
               COALESCE(JSON_EXTRACT(JSON_EXTRACT(json_result,'$.Battery Power:'),'$.powernap'),'') AS powernap_battery
        FROM pmset WHERE getting='custom'
      ) WHERE powernap_battery != '1' AND powernap_ac != '1'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:power, requirement:fleetd, critical:false, control:powernap-disabled, cis_category:System Settings, cis_subcategory:Battery (Energy Saver), cis_safeguard_ids:CIS2.10.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.10.1.2 (L2) Ensure Sleep and Display Sleep Is Enabled on Apple Silicon Devices (Automated)
  platform: darwin
  description: |
    Ensures appropriate inactivity sleep and display sleep timing to reduce exposure of unlocked sessions.
  resolution: |
    pmset -a sleep 15; pmset -a displaysleep 10
  query: |
    SELECT 1 WHERE (
      NOT EXISTS (SELECT 1 FROM system_info WHERE cpu_type LIKE 'arm64%') OR EXISTS (
        SELECT 1 FROM (
          SELECT CASE WHEN JSON_EXTRACT(json_result,'$.Battery Power:') IS NOT NULL THEN JSON_EXTRACT(json_result,'$.Battery Power:') ELSE JSON_EXTRACT(json_result,'$.AC Power:') END AS power_settings
          FROM pmset WHERE getting='custom'
        ) WHERE CAST(JSON_EXTRACT(power_settings,'$.sleep') AS INTEGER) <= 15
          AND CAST(JSON_EXTRACT(power_settings,'$.displaysleep') AS INTEGER) <= 10
          AND CAST(JSON_EXTRACT(power_settings,'$.displaysleep') AS INTEGER) <= CAST(JSON_EXTRACT(power_settings,'$.sleep') AS INTEGER)
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:power, requirement:fleetd, critical:false, control:sleep-settings-enforced, cis_category:System Settings, cis_subcategory:Battery (Energy Saver), cis_safeguard_ids:CIS2.10.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.10.3 (L1) Ensure Wake for Network Access Is Disabled (Automated)
  platform: darwin
  description: |
    Disables wake-on-network to reduce remote activation risk while unattended.
  resolution: |
    pmset -a womp 0
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM (
        SELECT COALESCE(JSON_EXTRACT(JSON_EXTRACT(json_result,'$.AC Power:'),'$.womp'),'') AS womp_ac,
               COALESCE(JSON_EXTRACT(JSON_EXTRACT(json_result,'$.Battery Power:'),'$.womp'),'') AS womp_battery
        FROM pmset WHERE getting='custom'
      ) WHERE womp_battery != '1' AND womp_ac != '1'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:power, requirement:fleetd, critical:false, control:wake-on-network-disabled, cis_category:System Settings, cis_subcategory:Battery (Energy Saver), cis_safeguard_ids:CIS2.10.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.10.1.1 (L2) Ensure the OS Is Not Active When Resuming from Standby (Intel) (Manual)
  platform: darwin
  description: |
    Ensures hibernation / standby security parameters protect FileVault keys after sleep.
  resolution: |
    Apply pmset parameters per architecture to enforce hibernation and key destruction.
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM system_info WHERE (hardware_model LIKE 'Mac%' OR hardware_model LIKE 'MacBook%'))
      AND EXISTS (
        SELECT 1 FROM (
          SELECT JSON_EXTRACT(json_result,'$.System-wide power settings:') AS system_wide_power_settings FROM pmset
        ) WHERE JSON_EXTRACT(system_wide_power_settings,'$.DestroyFVKeyOnStandby') = '1'
      ) AND (
        (
          EXISTS (SELECT 1 FROM system_info WHERE cpu_type IN ('x86_64h','x86_64')) AND EXISTS (
            SELECT 1 FROM (
              SELECT JSON_EXTRACT(json_result,'$.Battery Power:') AS battery FROM pmset WHERE getting='custom'
            ) WHERE CAST(JSON_EXTRACT(battery,'$.standbydelaylow') AS INTEGER) <= 900
              AND CAST(JSON_EXTRACT(battery,'$.standbydelayhigh') AS INTEGER) <= 900
              AND CAST(JSON_EXTRACT(battery,'$.highstandbythreshold') AS INTEGER) >= 90
              AND CAST(JSON_EXTRACT(battery,'$.hibernatemode') AS INTEGER) = 25
          )
        ) OR (
          EXISTS (SELECT 1 FROM system_info WHERE cpu_type LIKE 'arm64%') AND EXISTS (
            SELECT 1 FROM (
              SELECT JSON_EXTRACT(json_result,'$.Battery Power:') AS battery FROM pmset WHERE getting='custom'
            ) WHERE CAST(JSON_EXTRACT(battery,'$.standby') AS INTEGER) <= 900
          )
        )
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:power, requirement:fleetd+fda, critical:false, control:secure-sleep-hibernate, cis_category:System Settings, cis_subcategory:Battery (Energy Saver), cis_safeguard_ids:CIS2.10.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.11.2 (L1) Ensure Require Password After Screen Saver Begins or Display Is Turned Off Is Enabled for 5 Seconds or Immediately (Automated)
  platform: darwin
  description: |
    Requires password on wake within 05 seconds to protect unattended sessions.
  resolution: |
    MDM profile: com.apple.screensaver askForPassword => <true/> askForPasswordDelay <=5
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='askForPassword' AND (value=1 OR value='true'))
      AND EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='askForPasswordDelay' AND value <= 5)
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='askForPassword' AND (value!=1 AND value!='true'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='askForPasswordDelay' AND value > 5)
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:screen-lock, requirement:mdm, critical:false, control:password-on-wake, cis_category:System Settings, cis_subcategory:Lock Screen, cis_safeguard_ids:CIS2.11.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.5 (L1) Ensure Gatekeeper Is Enabled (Automated)
  platform: darwin
  description: |
    Ensures Gatekeeper allows only App Store and identified developers reducing malicious code execution.
  resolution: |
    System Settings > Privacy & Security > Allow apps downloaded from: App Store and identified developers.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM gatekeeper WHERE assessments_enabled = 1 AND dev_id_enabled = 1
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:application-control, requirement:standard, critical:false, control:gatekeeper-enabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.3.1 (L1) Ensure Share Mac Analytics Is Disabled (Automated)
  platform: darwin
  description: |
    Disables transmission of diagnostic/usage data reducing external data exposure.
  resolution: |
    MDM profiles to disable analytics and Siri sharing keys across related domains.
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.SubmitDiagInfo' AND name='AutoSubmit' AND (value=0 OR value='false'))
      AND EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowDiagnosticSubmission' AND (value=0 OR value='false'))
      AND EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.Accessibility' AND name='AXSAudioDonationSiriImprovementEnabled' AND (value=0 OR value='false'))
      AND EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='Siri Data Sharing Opt-In Status' AND value=2)
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy-telemetry, requirement:mdm, critical:false, control:diagnostics-disabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.3.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.11.1 (L1) Ensure an Inactivity Interval of 15 Minutes Or Less for the Screen Saver Is Enabled (Automated)
  platform: darwin
  description: |
    Enforces automatic screen saver start within 20 minutes to reduce exposure of unlocked sessions.
  resolution: |
    MDM profile: com.apple.screensaver idleTime <=1200
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='idleTime' AND CAST(value AS INT) <= 1200)
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.screensaver' AND name='idleTime' AND CAST(value AS INT) > 1200)
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:screen-lock, requirement:mdm, critical:false, control:screen-saver-idle-time, cis_category:System Settings, cis_subcategory:Lock Screen, cis_safeguard_ids:CIS2.11.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.11.3 (L1) Ensure a Custom Message for the Login Screen Is Enabled (Automated)
  platform: darwin
  description: |
    Ensures login banner present to provide legal/authorization notice.
  resolution: |
    Configure Lock Screen > Show message when locked.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM plist WHERE path='/Library/Preferences/com.apple.loginwindow.plist' AND key='LoginwindowText' AND value != ''
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:login, requirement:standard, critical:false, control:login-banner-configured, cis_category:System Settings, cis_subcategory:Lock Screen, cis_safeguard_ids:CIS2.11.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.6 (L1) Ensure FileVault Is Enabled (Automated)
  platform: darwin
  description: |
    Validates FileVault full disk encryption active and disabling not permitted.
  resolution: |
    Enable FileVault and enforce dontAllowFDEDisable via MDM.
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.MCX' AND name='dontAllowFDEDisable' AND (value=1 OR value='true'))
      AND EXISTS (SELECT 1 FROM disk_encryption WHERE user_uuid != '' AND filevault_status='on')
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:encryption, requirement:mdm, critical:false, control:filevault-enabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.11.4 (L1) Ensure Login Window Displays as Name and Password Is Enabled (Automated)
  platform: darwin
  description: |
    Requires both username and password entry reducing enumeration of local accounts.
  resolution: |
    MDM profile: com.apple.loginwindow SHOWFULLNAME => <true/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='SHOWFULLNAME' AND (value=1 OR value='true'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='SHOWFULLNAME' AND (value!=1 AND value!='true'))
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:login, requirement:mdm, critical:false, control:login-window-name-password, cis_category:System Settings, cis_subcategory:Lock Screen, cis_safeguard_ids:CIS2.11.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.11.5 (L1) Ensure Show Password Hints Is Disabled (Automated)
  platform: darwin
  description: |
    Disables password hints that could aid brute-force or social engineering attempts.
  resolution: |
    MDM profile: com.apple.loginwindow RetriesUntilHint => <false/> (0)
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='RetriesUntilHint' AND (value=0 OR value='false'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='RetriesUntilHint' AND (value!=0 AND value!='false'))
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:login, requirement:mdm, critical:false, control:password-hints-disabled, cis_category:System Settings, cis_subcategory:Lock Screen, cis_safeguard_ids:CIS2.11.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.12.2 (L1) Audit Touch ID (Manual)
  platform: darwin
  description: |
    Ensures no user accounts have password hints configured locally.
  resolution: |
    Remove password hints when changing passwords.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM user_login_settings WHERE password_hint_enabled = 0
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:login, requirement:fleetd, critical:false, control:no-user-password-hints, cis_category:System Settings, cis_subcategory:Touch ID & Password (Login Password), cis_safeguard_ids:CIS2.12.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.13.1 (L1) Ensure Guest Account Is Disabled (Automated)
  platform: darwin
  description: |
    Disables guest account preventing anonymous local login access.
  resolution: |
    Disable Guest User in Users & Groups.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM plist WHERE path='/Library/Preferences/com.apple.loginwindow.plist' AND key='GuestEnabled' AND value = 0
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:accounts, requirement:standard, critical:false, control:guest-account-disabled, cis_category:System Settings, cis_subcategory:Users & Groups, cis_safeguard_ids:CIS2.13.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.13.2 (L1) Ensure Guest Access to Shared Folders Is Disabled (Automated)
  platform: darwin
  description: |
    Prevents guest access to SMB shared folders mitigating unauthorized data exposure.
  resolution: |
    sysadminctl -smbGuestAccess off
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM plist WHERE path = '/Library/Preferences/SystemConfiguration/com.apple.smb.server.plist' AND key='AllowGuestAccess' AND value=0
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:sharing, requirement:standard, critical:false, control:guest-smb-access-disabled, cis_category:System Settings, cis_subcategory:Users & Groups, cis_safeguard_ids:CIS2.13.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.13.3 (L1) Ensure Automatic Login Is Disabled (Automated)
  platform: darwin
  description: |
    Ensures automatic login disabled to require authentication at boot.
  resolution: |
    MDM profile: com.apple.loginwindow com.apple.login.mcx.DisableAutoLoginClient => <true/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='com.apple.login.mcx.DisableAutoLoginClient' AND (value=1 OR value='true'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.loginwindow' AND name='com.apple.login.mcx.DisableAutoLoginClient' AND (value!=1 AND value!='true'))
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:login, requirement:mdm, critical:false, control:auto-login-disabled, cis_category:System Settings, cis_subcategory:Users & Groups, cis_safeguard_ids:CIS2.13.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.18.1 (L1) Ensure On-Device Dictation Is Enabled (Automated)
  platform: darwin
  description: |
    Forces dictation processing on-device reducing data sent to external services.
  resolution: |
    MDM profile: com.apple.applicationaccess forceOnDeviceOnlyDictation => <true/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='forceOnDeviceOnlyDictation' AND (value=1 OR value='true'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='forceOnDeviceOnlyDictation' AND (value != 1 AND value != 'true'))
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy, requirement:mdm, critical:false, control:on-device-dictation-enabled, cis_category:System Settings, cis_subcategory:Keyboard, cis_safeguard_ids:CIS2.18.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 3.4 (L1) Ensure Security Auditing Retention Is Enabled (Automated) [auditd-enabled]
  platform: darwin
  description: |
    Ensures legacy auditd active capturing security-relevant events where still required.
  resolution: |
    launchctl load -w /System/Library/LaunchDaemons/com.apple.auditd.plist
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM launchd l INNER JOIN processes p ON (l.program = p.path)
      WHERE l.label='com.apple.auditd' AND l.program_arguments = p.cmdline
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:audit, requirement:standard, critical:false, control:auditd-enabled, cis_category:Logging and Auditing, cis_subcategory:Ensure install.log Is Retained for 365 or More Days and No Maximum Size, cis_safeguard_ids:CIS3.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.4.1 (L1) Audit Menu Bar and Control Center Icons (Manual)
  platform: darwin
  description: |
    Displaying Wi-Fi status raises user awareness of active wireless connectivity which can mitigate risks in untrusted networks.
  resolution: |
    Deploy MDM profile:
      PayloadType: com.apple.controlcenter
      Key: WiFi => <integer>18</integer>
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
          domain='com.apple.controlcenter' AND name='WiFi' AND value = 18
      ) AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
          domain='com.apple.controlcenter' AND name='WiFi' AND value != 18
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:ui-awareness, requirement:mdm, critical:false, control:show-wifi-status, cis_category:System Settings, cis_subcategory:Menu Bar, cis_safeguard_ids:CIS2.4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.4.1 (L1) Audit Menu Bar and Control Center Icons (Manual) [show-bluetooth-status]
  platform: darwin
  description: |
    Showing Bluetooth status helps users recognize enabled radios and potential exposure surface for wireless attacks.
  resolution: |
    Deploy MDM profile:
      PayloadType: com.apple.controlcenter
      Key: Bluetooth => <integer>18</integer>
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
 
          domain='com.apple.controlcenter' AND name='Bluetooth' AND value = 18
      ) AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
          domain='com.apple.controlcenter' AND name='Bluetooth' AND value != 18
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:ui-awareness, requirement:mdm, critical:false, control:show-bluetooth-status, cis_category:System Settings, cis_subcategory:Menu Bar, cis_safeguard_ids:CIS2.4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.1 (L1) Ensure Siri Is Disabled (Automated)
  platform: darwin
  description: |
    Disabling Siri mitigates potential data disclosure via voice assistant queries in sensitive environments.
  resolution: |
    MDM profile: com.apple.applicationaccess allowAssistant => <false/>
  query: |
    SELECT 1 WHERE (
      EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowAssistant' AND (value = 0 OR value='false'))
      AND NOT EXISTS (SELECT 1 FROM managed_policies WHERE domain='com.apple.applicationaccess' AND name='allowAssistant' AND (value != 0 AND value!='false'))
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:mdm, critical:false, control:siri-disabled, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual)
  platform: darwin
  description: |
    Ensures Type to Siri accessibility feature is enabled when organizational policy mandates textual invocation.
  resolution: |
    Configure per user:
      defaults write com.apple.Siri.plist TypeToSiriEnabled -bool true
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='TypeToSiriEnabled' AND value='1'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-type-to-true, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual) [siri-type-to-false]
  platform: darwin
  description: |
    Ensures Type to Siri feature is disabled where policy forbids voice assistant use paths.
  resolution: |
    Configure per user:
      defaults write com.apple.Siri.plist TypeToSiriEnabled -bool false
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='TypeToSiriEnabled' AND value='0'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-type-to-false, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual) [siri-statusmenu-true]
  platform: darwin
  description: |
    Ensures Siri status menu icon visible if required for monitoring state by users/admins.
  resolution: |
    defaults write com.apple.Siri.plist StatusMenuVisible -bool true
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='StatusMenuVisible' AND value='1'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-statusmenu-true, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual) [siri-statusmenu-false]
  platform: darwin
  description: |
    Ensures Siri status menu icon hidden where minimizing assistant footprint is preferred.
  resolution: |
    defaults write com.apple.Siri.plist StatusMenuVisible -bool false
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='StatusMenuVisible' AND value='0'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-statusmenu-false, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual) [siri-voicetrigger-true]
  platform: darwin
  description: |
    Ensures Hey Siri voice trigger is enabled when allowed.
  resolution: |
    defaults write com.apple.Siri.plist VoiceTriggerUserEnabled -bool true
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='VoiceTriggerUserEnabled' AND value='1'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-voicetrigger-true, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual) [siri-voicetrigger-false]
  platform: darwin
  description: |
    Ensures voice trigger disabled for reduced inadvertent capture in sensitive areas.
  resolution: |
    defaults write com.apple.Siri.plist VoiceTriggerUserEnabled -bool false
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='VoiceTriggerUserEnabled' AND value='0'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-voicetrigger-false, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual) [siri-lockscreen-true]
  platform: darwin
  description: |
    Ensures Siri permitted at lock screen where convenience outweighs potential exposure.
  resolution: |
    defaults write com.apple.Siri.plist LockscreenEnabled -bool true
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='LockscreenEnabled' AND value='1'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-lockscreen-true, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.5.2.2 (L1) Ensure Listen for (Siri) Is Disabled (Manual) [siri-lockscreen-false]
  platform: darwin
  description: |
    Ensures Siri not accessible from lock screen, limiting potential unauthorized access to assistant data.
  resolution: |
    defaults write com.apple.Siri.plist LockscreenEnabled -bool false
  query: |
    SELECT CASE WHEN NOT EXISTS (
      SELECT 1 FROM users u LEFT JOIN (
        SELECT path,value FROM plist WHERE path LIKE '/Users/%/Library/Preferences/com.apple.Siri.plist' AND key='LockscreenEnabled' AND value='0'
      ) p ON p.path = CONCAT(u.directory, '/Library/Preferences/com.apple.Siri.plist')
      WHERE u.directory LIKE '/Users/%' AND p.value IS NULL
    ) THEN 1 ELSE 0 END AS result;
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:voice-assistant, requirement:standard, critical:false, control:siri-lockscreen-false, cis_category:System Settings, cis_subcategory:Apple Intelligence & Siri, cis_safeguard_ids:CIS2.5.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.1.1 (L2) Ensure Location Services Is Enabled (Automated) [location-services-enabled]
  platform: darwin
  description: |
    Ensures location services master switch enabled (some controls depend on accurate location data for user awareness or restrictions).
  resolution: |
    Enable via System Settings > Privacy & Security > Location Services.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM location_services WHERE enabled=1);
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:privacy-location, requirement:standard, critical:false, control:location-services-enabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.1.2 (L2) Ensure 'Show Location Icon in Control Center when System Services Request Your Location' Is Enabled (Automated)
  platform: darwin
  description: |
    Displays indicator when system services access locationimproving transparency.
  resolution: |
    Enable in System Settings > Privacy & Security > Location Services > Details.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM plist WHERE path='/Library/Preferences/com.apple.locationmenu.plist' AND key='ShowSystemServices' AND value=1
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:privacy-location, requirement:standard, critical:false, control:show-location-icon, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.3 (L1) Ensure Printer Sharing Is Disabled (Automated)
  platform: darwin
  description: |
    Printer Sharing configures the system as a print server. Disabling reduces exposure for lateral movement and misuse.
  resolution: |
    Graphical Method:
      1. Open System Settings
      2. Select General
      3. Select Sharing
      4. Set Printer Sharing to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM file_lines WHERE
        path = '/etc/cups/cupsd.conf' AND
        line LIKE '%Allow @LOCAL%'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:sharing, requirement:standard, critical:false, control:printer-sharing-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.4 (L1) Ensure Remote Login Is Disabled (Automated)
  platform: darwin
  description: |
    Remote Login (SSH server) should not be enabled on standard user endpoints; disabling reduces remote attack surface.
  resolution: |
    Graphical Method:
      1. Open System Settings
      2. Select General
      3. Select Sharing
      4. Set Remote Login to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM plist WHERE
        path = '/var/db/com.apple.xpc.launchd/disabled.plist' AND
        key = 'com.openssh.sshd' AND
        value = '0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:remote-access, requirement:standard, critical:false, control:remote-login-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.5 (L1) Ensure Remote Management Is Disabled (Automated)
  platform: darwin
  description: |
    Remote Management (Apple Remote Desktop) allows full control; disabling mitigates risk on mobile/roaming endpoints.
  resolution: |
    Graphical Method:
      1. Open System Settings
      2. Select General
      3. Select Sharing
      4. Set Remote Management to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM processes WHERE
        path = '/System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/MacOS/ARDAgent'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:remote-access, requirement:standard, critical:false, control:remote-management-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.6 (L1) Ensure Remote Apple Events Is Disabled (Automated)
  platform: darwin
  description: |
    Remote Apple Events permits inter-process scripting across hosts; disabling reduces remote execution risk.
  resolution: |
    Graphical Method:
      1. Open System Settings
      2. Select General
      3. Select Sharing
      4. Set Remote Apple Events to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM plist WHERE
        path = '/var/db/com.apple.xpc.launchd/disabled.plist' AND
        key = 'com.apple.AEServer' AND
        value = '0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:remote-access, requirement:standard, critical:false, control:remote-apple-events-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.7 (L1) Ensure Internet Sharing Is Disabled (Automated)
  platform: darwin
  description: |
    Internet Sharing enables NAT routing from the endpoint; disabling prevents unintended hotspot behavior and exposure.
  resolution: |
    Graphical Method:
      1. Open System Settings
      2. Select General
      3. Select Sharing
      4. Set Internet Sharing to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM plist WHERE
        path = '/Library/Preferences/SystemConfiguration/com.apple.nat.plist' AND
        key = 'NAT' AND
        subkey = 'Enabled' AND
        value = '1'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:network, requirement:standard, critical:false, control:internet-sharing-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.7
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.8 (L2) Ensure Content Caching Is Disabled (Automated)
  platform: darwin
  description: |
    Content Caching stores Apple content locally; disabling avoids unmanaged peer distribution and storage risk on endpoints.
  resolution: |
    Graphical Method:
      1. Open System Settings
      2. Select General
      3. Select Sharing
      4. Set Content Caching to disabled
    Profile Method:
      PayloadType: com.apple.applicationaccess
      Key: allowContentCaching => <false/>
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowContentCaching' AND 
            (value = 0 OR value = 'false')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowContentCaching' AND 
            (value != 0 AND value != 'false')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:caching, requirement:mdm, critical:false, control:content-caching-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.8
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.10 (L1) Ensure Bluetooth Sharing Is Disabled (Automated)
  platform: darwin
  description: |
    Disabling Bluetooth Sharing mitigates risk of unsolicited or malicious file transfers over short-range wireless.
  resolution: |
    Graphical Method:
      1. Open System Settings
      2. Select General
      3. Select Sharing
      4. Set Bluetooth Sharing to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM plist WHERE
        path LIKE '/Users/%/Library/Preferences/ByHost/com.apple.Bluetooth.%.plist' AND
        key = 'PrefKeyServicesEnabled' AND
        value = '1'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:sharing, requirement:standard, critical:false, control:bluetooth-sharing-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.10
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.9 (L2) Ensure Media Sharing Is Disabled (Automated)
  platform: darwin
  description: |
    Disabling Media Sharing reduces remote attack surface and prevents uncontrolled content distribution across Apple devices.
  resolution: |
    Profile Method (PayloadType com.apple.applicationaccess):
      allowMediaSharing => <false/>
      allowMediaSharingModification => <false/>
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE
          domain = 'com.apple.applicationaccess' AND
          name = 'allowMediaSharing' AND
          (value = 0 OR value = 'false')
      ) AND EXISTS (
        SELECT 1 FROM managed_policies WHERE
          domain = 'com.apple.applicationaccess' AND
          name = 'allowMediaSharingModification' AND
          (value = 0 OR value = 'false')
      ) AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE
          domain = 'com.apple.applicationaccess' AND
          name = 'allowMediaSharing' AND
          (value != 0 AND value != 'false')
      ) AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE
          domain = 'com.apple.applicationaccess' AND
          name = 'allowMediaSharingModification' AND
          (value != 0 AND value != 'false')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:sharing, requirement:mdm, critical:false, control:media-sharing-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.9
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.4.1 (L1) Ensure Backup Automatically is Enabled If Time Machine Is Enabled .118 (Automated)
  platform: darwin
  description: |
    Ensures Time Machine automatic backups are enabled when destinations configured; supports resilience and data protection.
  resolution: |
    Enable automatic backup or remove Time Machine configuration.
    Command:
      /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.TimeMachine.plist AutoBackup -bool true
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM plist WHERE path='/Library/Preferences/com.apple.TimeMachine.plist'
          AND key='AutoBackup' AND (value = 1 OR value = 'true')
      ) OR NOT EXISTS (SELECT 1 FROM time_machine_backups)
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:backup, requirement:fda, critical:false, control:time-machine-autobackup-enabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.4.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.4 (L1) Time Machine (Manual)
  platform: darwin
  description: |
    Ensures Time Machine destinations are encrypted protecting backup confidentiality.
  resolution: |
    Reconfigure Time Machine destination with encryption enabled via System Settings.
  query: |
    SELECT 1 WHERE (
      NOT EXISTS (SELECT 1 FROM time_machine_destinations) OR
      NOT EXISTS (
        SELECT 1 FROM time_machine_destinations WHERE encryption <> 'Encrypted'
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:backup, requirement:fda, critical:false, control:time-machine-encrypted, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 1.2 (L1) Ensure Download New Updates When Available Is Enabled (Automated)
  platform: darwin
  description: |
    Checks that the system is configured via MDM to automatically download updates.
  resolution: |
    Ask your system administrator to deploy an MDM profile that enables automatic update downloads.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='AutomaticDownload' AND 
            (value = 1 OR value = 'true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='AutomaticDownload' AND 
            (value != 1 AND value != 'true')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:updates, requirement:mdm, critical:false, control:auto-download-updates, cis_category:Install Updates, Patches and Additional Security Software, cis_subcategory:Ensure Download New Updates When Available Is Enabled, cis_safeguard_ids:CIS1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 1.3 (L1) Ensure Install of macOS Updates Is Enabled (Automated)
  platform: darwin
  description: |
    Ensure that macOS updates are installed after they are available from Apple.
  resolution: |
    Ask your system administrator to deploy an MDM profile that enables automatic install of macOS updates.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='AutomaticallyInstallMacOSUpdates' AND 
            (value = 1 OR value = 'true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='AutomaticallyInstallMacOSUpdates' AND 
            (value != 1 AND value != 'true')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:updates, requirement:mdm, critical:false, control:auto-install-macos-updates, cis_category:Install Updates, Patches and Additional Security Software, cis_subcategory:Ensure Install of macOS Updates Is Enabled, cis_safeguard_ids:CIS1.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 1.4 (L1) Ensure Install Application Updates from the App Store Is Enabled (Automated)
  platform: darwin
  description: |
    Ensure that application updates are installed after they are available from Apple.
  resolution: |
    Ask your system administrator to deploy an MDM profile that enables automatic updates of Apple apps.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='AutomaticallyInstallAppUpdates' AND 
            (value = 1 OR value = 'true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='AutomaticallyInstallAppUpdates' AND 
            (value != 1 AND value != 'true')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:updates, requirement:mdm, critical:false, control:auto-install-app-updates, cis_category:Install Updates, Patches and Additional Security Software, cis_subcategory:Ensure Install Application Updates from the App Store Is Enabled, cis_safeguard_ids:CIS1.4
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.10 (L1) Ensure XProtect Is Running and Updated (Automated)
  platform: darwin
  description: |
    XProtect is Apple's native signature-based antivirus technology. XProtect both finds and blocks the execution of known malware. There are many AV and Endpoint Threat Detection and Response (ETDR) tools available for macOS. The native Apple provisioned tool looks for specific known malware and is completely integrated into the OS. No matter what other tools are being used, XProtect should have the latest signatures available.
  resolution: |
    Ask your system administrator to deploy a script that will configure:
    /usr/bin/sudo /bin/launchctl load -w /Library/Apple/System/Library/LaunchDaemons/com.apple.XProtect.daemon.scan.plist
    /usr/bin/sudo /bin/launchctl load -w /Library/Apple/System/Library/LaunchDaemons/com.apple.XprotectFramework.PluginService.plist
    /usr/bin/sudo /usr/bin/xprotect update
  query: |
    SELECT CASE WHEN (
      SELECT COUNT(*)
      FROM launchd
      WHERE path IN (
          '/Library/Apple/System/Library/LaunchDaemons/com.apple.XprotectFramework.PluginService.plist',
          '/Library/Apple/System/Library/LaunchDaemons/com.apple.XProtect.daemon.scan.plist'
      )
    ) = 2 THEN 1 ELSE 0 END AS result;
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:malware-protection, requirement:standard, critical:false, control:xprotect-running-updated, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure XProtect Is Running and Updated, cis_safeguard_ids:CIS5.10
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 1.5 (L1) Ensure Install Security Responses and System Files Is Enabled (Automated)
  platform: darwin
  description: |
    Ensure that system and security updates are installed after they are available from Apple. This setting enables definition updates for XProtect and Gatekeeper. With this setting in place, new malware and adware that Apple has added to the list of malware or untrusted software will not execute.
  resolution: |
    Ask your system administrator to deploy an MDM profile that enables automatic critical system and security updates.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='CriticalUpdateInstall' AND 
            (value = 1 OR value = 'true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.SoftwareUpdate' AND 
            name='CriticalUpdateInstall' AND 
            (value != 1 AND value != 'true')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:updates, requirement:mdm, critical:false, control:install-security-responses, cis_category:Install Updates, Patches and Additional Security Software, cis_subcategory:Ensure Install Security Responses and System Files Is Enabled, cis_safeguard_ids:CIS1.5
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 1.6 (L1) Ensure Software Update Deferment Is Less Than or Equal to 30 Days (Automated)
  platform: darwin
  description: |
    Apple provides the capability to manage software updates on Apple devices through mobile device management. Part of those capabilities permit organizations to defer software updates and allow for testing. If software updates are deferred, they should not be deferred for more than 30 days.
  resolution: |
    Ask your system administrator to deploy an MDM profile configures update deferment to a value of 30 days or less.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='enforcedSoftwareUpdateDelay' AND 
            value <= 30
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='enforcedSoftwareUpdateDelay' AND 
            value > 30
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:updates, requirement:mdm, critical:false, control:software-update-deferment-<=30d, cis_category:Install Updates, Patches and Additional Security Software, cis_subcategory:Ensure Software Update Deferment Is Less Than or Equal to 30 Days, cis_safeguard_ids:CIS1.6
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.2 (L2) Audit iCloud Drive (Manual)
  platform: darwin
  description: |
    iCloud Drive is Apple's storage solution for applications on both macOS and iOS to use the same files that are resident in Apple's cloud storage. One of the concerns in public cloud storage is that proprietary data may be inappropriately stored in an end user's personal repository. Organizations that need specific controls on information should ensure that this service is turned off or the user knows what information must be stored on services that are approved for storage of controlled information. This query checks for the existence of the policy not its value (that should be set per organization's decision).
  resolution: |
    The administrator should configure this via MDM profile.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess.
      2. The key to include is allowCloudDocumentSync.
      3. The key must be set to <false/>.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudDocumentSync' AND 
            (value = 0 OR value = 'false')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudDocumentSync' AND 
            (value != 0 AND value != 'false')
      )
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:cloud-storage, requirement:mdm, critical:false, control:icloud-drive-disabled, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.2 (L2) Audit iCloud Drive (Manual) [icloud-drive-enabled]
  platform: darwin
  description: |
    iCloud Drive is Apple's storage solution for applications on both macOS and iOS to use the same files that are resident in Apple's cloud storage. This is the counterpart policy when organizational policy is to allow iCloud Drive document sync.
  resolution: |
    The administrator should configure this via MDM profile.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess.
      2. The key to include is allowCloudDocumentSync.
      3. The key must be set to <true/>.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudDocumentSync' AND 
            (value = 1 OR value = 'true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudDocumentSync' AND 
            (value != 1 AND value != 'true')
      )
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:cloud-storage, requirement:mdm, critical:false, control:icloud-drive-enabled, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.1 (L2) Audit iCloud Passwords & Keychain (Manual)
  platform: darwin
  description: |
    The iCloud keychain is Apple's password manager that works with macOS and iOS. The capability allows users to store passwords in either iOS or macOS for use in Safari on both platforms and other iOS-integrated applications. The stored passwords could be for organizational as well as for personal accounts. Ensure that the iCloud keychain is used consistently with organizational requirements.
  resolution: |
    The administrator should configure this via MDM profile.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess.
      2. The key to include is allowCloudKeychainSync.
      3. The key must be set to <false/>.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudKeychainSync' AND 
            (value = 0 OR value = 'false')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudKeychainSync' AND 
            (value != 0 AND value != 'false')
      )
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:credentials, requirement:mdm, critical:false, control:icloud-keychain-disabled, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.1 (L2) Audit iCloud Passwords & Keychain (Manual) [icloud-keychain-enabled]
  platform: darwin
  description: |
    The iCloud keychain is Apple's password manager that works with macOS and iOS. It allows password synchronization. This counterpart policy applies when organizational policy permits iCloud Keychain usage.
  resolution: |
    The administrator should configure this via MDM profile.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess.
      2. The key to include is allowCloudKeychainSync.
      3. The key must be set to <true/>.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudKeychainSync' AND 
            (value = 1 OR value = 'true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudKeychainSync' AND 
            (value != 1 AND value != 'true')
      )
    );
  purpose: Optional
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:credentials, requirement:mdm, critical:false, control:icloud-keychain-enabled, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.3 (L2) Ensure iCloud Drive Document and Desktop Sync Is Disabled (Automated)
  platform: darwin
  description: |
    Automated Document synchronization should be planned and controlled to approved storage.
  resolution: |
    The administrator should configure this via MDM profile.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess.
      2. The key to include is allowCloudDesktopAndDocuments.
      3. The key must be set to <false/>.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudDesktopAndDocuments' AND 
            (value = 0 OR value = 'false')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowCloudDesktopAndDocuments' AND 
            (value != 0 AND value != 'false')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:cloud-storage, requirement:mdm, critical:false, control:icloud-desktop-documents-disabled, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.3
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.2.1 (L1) Ensure Firewall Is Enabled (Automated)
  platform: darwin
  description: |
    A firewall minimizes the threat of unauthorized users gaining access to your system while connected to a network or the Internet.
  resolution: |
    Go to the Network pane in System Settings and ensure Firewall is active.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM alf WHERE global_state >= 1
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:firewall, requirement:standard, critical:false, control:firewall-enabled, cis_category:System Settings, cis_subcategory:Network, cis_safeguard_ids:CIS2.2.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.2.2 (L1) Ensure Firewall Stealth Mode Is Enabled (Automated)
  platform: darwin
  description: |
    While in Stealth mode, the computer will not respond to unsolicited probes, dropping that traffic. Stealth mode minimizes the threat of system discovery tools.
  resolution: |
    Perform the following steps to enable firewall stealth mode:
      1. Open System Settings
      2. Select Network
      3. Select Firewall
      4. Select Options...
      5. Set Enabled stealth mode to enabled
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM alf WHERE global_state >= 1 AND stealth_enabled = 1
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:firewall, requirement:standard, critical:false, control:firewall-stealth-mode, cis_category:System Settings, cis_subcategory:Network, cis_safeguard_ids:CIS2.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.1.1 (L1) Ensure AirDrop Is Disabled When Not Actively Transferring Files (Automated)
  platform: darwin
  description: |
    AirDrop can allow malicious files to be downloaded from unknown sources. Disabling mitigates risk of unintended data transfer.
  resolution: |
    Ask your system administrator to deploy an MDM profile that disables AirDrop.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess
      2. The key to include is allowAirDrop
      3. The key must be set to <false/>
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowAirDrop' AND 
            (value = 0 OR value = 'false')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowAirDrop' AND 
            (value != 0 AND value != 'false')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:sharing, requirement:mdm, critical:false, control:airdrop-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.1.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.1.2 (L1) Ensure AirPlay Receiver Is Disabled (Automated)
  platform: darwin
  description: |
    AirPlay receiver capability should be disabled to reduce unsolicited connection attempts and potential misuse.
  resolution: |
    The administrator should configure this via MDM profile.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess
      2. The key to include is allowAirPlayIncomingRequests
      3. The key must be set to <false/>
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowAirPlayIncomingRequests' AND 
            (value = 0 OR value = 'false')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='allowAirPlayIncomingRequests' AND 
            (value != 0 AND value != 'false')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:sharing, requirement:mdm, critical:false, control:airplay-receiver-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.1.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.2.1 (L1) Ensure Set Time and Date Automatically Is Enabled (Automated)
  platform: darwin
  description: |
    Accurate time is required for authentication protocols, logging and file timestamps. Automatic time setting ensures consistency.
  resolution: |
    The administrator should configure this via MDM profile.
    Ask your administrator to deploy a profile with the following configuration:
      1. The PayloadType string is com.apple.applicationaccess.
      2. The key to include is forceAutomaticDateAndTime.
      3. The key must be set to <true/>.
  query: |
    SELECT 1 WHERE (
      EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='forceAutomaticDateAndTime' AND 
            (value = 1 OR value = 'true')
      )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE 
            domain='com.apple.applicationaccess' AND 
            name='forceAutomaticDateAndTime' AND 
            (value != 1 AND value != 'true')
      )
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:time-sync, requirement:mdm, critical:false, control:auto-time-enabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.2.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.2.2 (L1) Ensure the Time Service Is Enabled (Automated)
  platform: darwin
  description: |
    Timed replaces ntp for time services; maintaining correct time is essential for security and logging.
  resolution: |
    Ask your system administrator to deploy a script that will configure:
    /usr/bin/sudo /bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.timed.plist
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM processes WHERE path = '/usr/libexec/timed'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:time-sync, requirement:standard, critical:false, control:timed-service-enabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.2.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.1 (L1) Ensure Screen Sharing Is Disabled (Automated)
  platform: darwin
  description: |
    Screen Sharing permits remote control of the system; disabling reduces risk of unauthorized access.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select General
    3. Select Sharing
    4. Set Screen Sharing to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM plist WHERE
        path = '/var/db/com.apple.xpc.launchd/disabled.plist' AND
        key = 'com.apple.screensharing' AND
        value = '0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:remote-access, requirement:standard, critical:false, control:screen-sharing-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.1
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.2 (L1) Ensure File Sharing Is Disabled (Automated)
  platform: darwin
  description: |
    File sharing from a user workstation increases attack surface and complexity. Hardened servers should provide shared storage.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select General
    3. Select Sharing
    4. Set File Sharing to disabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM plist WHERE
        path = '/var/db/com.apple.xpc.launchd/disabled.plist' AND
        key = 'com.apple.smbd' AND
        value = '0'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:sharing, requirement:standard, critical:false, control:file-sharing-disabled, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.2
  contributors: karmine05
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.4 (L2) Audit Security Keys Used With Apple Accounts (Manual)
  platform: darwin
  description: |
    Verifies whether Security Keys are configured for Apple Account authentication. Security Keys provide phishing-resistant two-factor authentication. Organizations should audit and document the use of Security Keys for Apple Accounts.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select your Apple Account at the top
    3. Select Sign-In & Security
    4. Review Security Keys configuration
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:apple-account, requirement:manual, critical:false, control:security-keys-apple-account-audit, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.4
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.5 (L2) Audit Freeform Sync to iCloud (Manual)
  platform: darwin
  description: |
    Audits whether Freeform app syncs data to iCloud. Organizations should assess if Freeform sync aligns with data handling policies, as collaborative whiteboard content may contain sensitive information.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select your Apple Account
    3. Select iCloud
    4. Review Freeform sync status under Apps Using iCloud
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:cloud-storage, requirement:manual, critical:false, control:freeform-icloud-sync-audit, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.5
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.1.6 (L2) Audit Find My Mac (Manual)
  platform: darwin
  description: |
    Audits Find My Mac configuration. Find My Mac enables device location and remote wipe capabilities. Organizations should document whether this feature is enabled and assess alignment with asset management policies.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select your Apple Account
    3. Select iCloud
    4. Review Find My Mac status
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:device-tracking, requirement:manual, critical:false, control:find-my-mac-audit, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.1.6
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.1.2 (L2) Audit App Store Password Settings (Manual)
  platform: darwin
  description: |
    Audits App Store password requirements for purchases and downloads. Organizations should verify that password requirements align with security policies to prevent unauthorized software installation.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select your Apple Account
    3. Select Media & Purchases
    4. Review password settings for purchases and free downloads
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:app-store, requirement:manual, critical:false, control:app-store-password-settings-audit, cis_category:System Settings, cis_subcategory:Apple Account, cis_safeguard_ids:CIS2.1.2
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.3.3.11 (L2) Ensure Computer Name Does Not Contain PII or Protected Organizational Information (Manual)
  platform: darwin
  description: |
    Verifies the computer name does not contain personally identifiable information (PII) or sensitive organizational data. Computer names are broadcast on networks and could expose sensitive information.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select General
    3. Select About
    4. Review and modify the computer Name to remove any PII or sensitive information
    Terminal Method:
    sudo scutil --set ComputerName "appropriate-name"
    sudo scutil --set LocalHostName "appropriate-name"
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:privacy, requirement:manual, critical:false, control:computer-name-no-pii, cis_category:System Settings, cis_subcategory:General, cis_safeguard_ids:CIS2.3.3.11
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.2 (L2) Full Disk Access (Manual)
  platform: darwin
  description: |
    Audits which applications have been granted Full Disk Access. Full Disk Access allows apps to access all files including protected system areas. Organizations should regularly review and document these permissions.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Privacy & Security
    3. Select Full Disk Access
    4. Review the list of applications with Full Disk Access
    Document findings and remove unnecessary permissions per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:privacy, requirement:manual, critical:false, control:full-disk-access-audit, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.2
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.3.2 (L1) Ensure Improve Siri & Dictation Is Disabled (Automated)
  platform: darwin
  description: |
    Disables sharing of Siri and Dictation audio recordings with Apple to improve their products. This prevents voice data from being transmitted to Apple for analysis.
  resolution: |
    Deploy MDM profile with com.apple.assistant.support 'Siri Data Sharing Opt-In Status' set to 0.
    Graphical Method:
    1. Open System Settings
    2. Select Privacy & Security
    3. Select Analytics & Improvements
    4. Disable Improve Siri & Dictation
  query: |
    SELECT 1 WHERE
      EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.assistant.support' AND
            name='Siri Data Sharing Opt-In Status' AND
            value = 0
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.assistant.support' AND
            name='Siri Data Sharing Opt-In Status' AND
            value != 0
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy-telemetry, requirement:mdm, critical:false, control:improve-siri-dictation-disabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.3.2
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.3.3 (L1) Ensure Improve Assistive Voice Features Is Disabled (Automated)
  platform: darwin
  description: |
    Disables sharing of assistive voice feature audio with Apple to improve accessibility features. This prevents voice data used for accessibility from being transmitted to Apple.
  resolution: |
    Deploy MDM profile to disable assistive voice improvements sharing.
    Graphical Method:
    1. Open System Settings
    2. Select Privacy & Security
    3. Select Analytics & Improvements
    4. Disable Improve Assistive Voice Features
  query: |
    SELECT 1 WHERE
      EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.Accessibility' AND
            name='AXSAudioDonationSiriImprovementEnabled' AND
            (value = 0 OR value = 'false')
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.Accessibility' AND
            name='AXSAudioDonationSiriImprovementEnabled' AND
            (value != 0 AND value != 'false')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy-telemetry, requirement:mdm, critical:false, control:improve-assistive-voice-disabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.3.3
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.3.4 (L1) Ensure 'Share with app developers' Is Disabled (Automated)
  platform: darwin
  description: |
    Disables sharing of crash data and usage statistics with third-party app developers. This reduces data exposure to external parties.
  resolution: |
    Deploy MDM profile with com.apple.applicationaccess allowDiagnosticSubmission set to false.
    Graphical Method:
    1. Open System Settings
    2. Select Privacy & Security
    3. Select Analytics & Improvements
    4. Disable Share with App Developers
  query: |
    SELECT 1 WHERE
      EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.applicationaccess' AND
            name='allowDiagnosticSubmission' AND
            (value = 0 OR value = 'false')
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.applicationaccess' AND
            name='allowDiagnosticSubmission' AND
            (value != 0 AND value != 'false')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy-telemetry, requirement:mdm, critical:false, control:share-with-app-developers-disabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.3.4
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.3.5 (L1) Ensure Share iCloud Analytics Is Disabled (Manual)
  platform: darwin
  description: |
    Verifies that iCloud Analytics sharing is disabled. iCloud Analytics shares usage data with Apple to improve iCloud services. Organizations should assess this setting against privacy requirements.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Privacy & Security
    3. Select Analytics & Improvements
    4. Disable Share iCloud Analytics
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy-telemetry, requirement:manual, critical:false, control:share-icloud-analytics-disabled, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.3.5
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.6.7 (L2) Audit Lockdown Mode (Manual)
  platform: darwin
  description: |
    Audits Lockdown Mode status. Lockdown Mode provides extreme protection for users who may be targeted by sophisticated attacks. Organizations should document whether this feature is appropriate for high-risk users.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Privacy & Security
    3. Scroll to bottom and review Lockdown Mode status
    Document findings and enable for high-risk users per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:security, requirement:manual, critical:false, control:lockdown-mode-audit, cis_category:System Settings, cis_subcategory:Privacy & Security, cis_safeguard_ids:CIS2.6.7
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.7.2 (L2) Audit iPhone Mirroring (Manual)
  platform: darwin
  description: |
    Audits iPhone Mirroring configuration. iPhone Mirroring allows users to access their iPhone from their Mac. Organizations should assess whether this feature aligns with security policies regarding device separation.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Desktop & Dock
    3. Review iPhone Mirroring settings
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:continuity, requirement:manual, critical:false, control:iphone-mirroring-audit, cis_category:System Settings, cis_subcategory:Desktop & Dock, cis_safeguard_ids:CIS2.7.2
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.9.1 (L1) Ensure Help Apple Improve Search Is Disabled (Automated)
  platform: darwin
  description: |
    Disables sharing of Spotlight search queries with Apple to improve search suggestions. This prevents search terms from being transmitted to Apple servers.
  resolution: |
    Deploy MDM profile with com.apple.Spotlight orderedItems configured to disable Spotlight Suggestions.
    Graphical Method:
    1. Open System Settings
    2. Select Siri & Spotlight
    3. Disable Help Apple Improve Search
  query: |
    SELECT 1 WHERE
      EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.Spotlight' AND
            name='SuppressSpotlightInternetResults' AND
            (value = 1 OR value = 'true')
        )
      AND NOT EXISTS (
        SELECT 1 FROM managed_policies WHERE
            domain='com.apple.Spotlight' AND
            name='SuppressSpotlightInternetResults' AND
            (value != 1 AND value != 'true')
        );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy-telemetry, requirement:mdm, critical:false, control:help-apple-improve-search-disabled, cis_category:System Settings, cis_subcategory:Spotlight, cis_safeguard_ids:CIS2.9.1
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.12.2 (L1) Audit Touch ID (Manual) [touch-id-audit]
  platform: darwin
  description: |
    Audits Touch ID configuration on the device. Organizations should document which fingers are enrolled and ensure Touch ID usage aligns with authentication policies.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Touch ID & Password
    3. Review enrolled fingerprints and Touch ID usage settings
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:authentication, requirement:manual, critical:false, control:touch-id-audit, cis_category:System Settings, cis_subcategory:Touch ID & Password (Login Password), cis_safeguard_ids:CIS2.12.2
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.14 (L2) Game Center (Manual)
  platform: darwin
  description: |
    Audits Game Center configuration and account settings. Organizations should verify Game Center usage aligns with acceptable use policies and assess any privacy implications.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Game Center
    3. Review Game Center account and settings
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:applications, requirement:manual, critical:false, control:game-center-audit, cis_category:System Settings, cis_subcategory:Game Center, cis_safeguard_ids:CIS2.14
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.15.1 (L1) Audit Notification Settings (Manual)
  platform: darwin
  description: |
    Audits notification settings across applications. Organizations should verify that notification settings do not expose sensitive information on locked screens or in notification center.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Notifications
    3. Review notification settings for each application
    4. Ensure sensitive apps do not show previews on lock screen
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:privacy, requirement:manual, critical:false, control:notification-settings-audit, cis_category:System Settings, cis_subcategory:Notifications, cis_safeguard_ids:CIS2.15.1
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.16 (L2) Wallet & Apple Pay (Manual)
  platform: darwin
  description: |
    Audits Wallet and Apple Pay configuration. Organizations should document payment methods and assess whether Apple Pay usage aligns with financial and security policies.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Wallet & Apple Pay
    3. Review configured payment cards and settings
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:applications, requirement:manual, critical:false, control:wallet-apple-pay-audit, cis_category:System Settings, cis_subcategory:Wallet & Apple Pay, cis_safeguard_ids:CIS2.16
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 2.17 (L1) Internet Accounts (Manual)
  platform: darwin
  description: |
    Audits configured Internet Accounts (email, calendar, contacts providers). Organizations should verify that only authorized accounts are configured and that they align with data handling policies.
  resolution: |
    Graphical Method:
    1. Open System Settings
    2. Select Internet Accounts
    3. Review all configured accounts
    4. Remove unauthorized accounts
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:accounts, requirement:manual, critical:false, control:internet-accounts-audit, cis_category:System Settings, cis_subcategory:Internet Accounts, cis_safeguard_ids:CIS2.17
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 3.6 (L2) Audit Software Inventory (Manual)
  platform: darwin
  description: |
    Audits installed software inventory. Organizations should maintain an accurate inventory of installed applications and verify they are authorized and properly licensed.
  resolution: |
    Graphical Method:
    1. Open Finder
    2. Navigate to Applications folder
    3. Review installed applications
    Terminal Method:
    ls -la /Applications
    system_profiler SPApplicationsDataType
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:audit, requirement:manual, critical:false, control:software-inventory-audit, cis_category:Logging and Auditing, cis_subcategory:Ensure install.log Is Retained for 365 or More Days and No Maximum Size, cis_safeguard_ids:CIS3.6
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.2.3 (L2) Ensure Complex Password Must Contain Alphabetic Characters Is Configured (Manual) [password-requires-numeric]
  platform: darwin
  description: |
    Verifies that password policy requires at least one numeric character. This increases password complexity and resistance to dictionary attacks.
  resolution: |
    Configure via MDM profile or pwpolicy:
    pwpolicy -n /Local/Default -setglobalpolicy "requiresNumeric=1"
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:authn, requirement:manual, critical:false, control:password-requires-numeric, cis_category:System Access, Authentication and Authorization, cis_subcategory:Account and Password Policy Management, cis_safeguard_ids:CIS5.2.3
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 5.8 (L2) Ensure a Login Window Banner Exists (Automated)
  platform: darwin
  description: |
    Verifies that a login window banner is configured. A login banner provides legal notice to users before authentication and can deter unauthorized access.
  resolution: |
    Create the banner file:
    sudo nano /Library/Security/PolicyBanner.txt
    Add your organization's legal notice text.
    Or deploy via MDM profile.
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT 1 FROM file WHERE
        path = '/Library/Security/PolicyBanner.txt' OR
        path = '/Library/Security/PolicyBanner.rtf' OR
        path = '/Library/Security/PolicyBanner.rtfd'
    );
  purpose: Enforcement
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:login, requirement:fleetd, critical:false, control:login-window-banner-exists, cis_category:System Access, Authentication and Authorization, cis_subcategory:Ensure a Login Window Banner Exists, cis_safeguard_ids:CIS5.8
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.2.1 (L2) Ensure Protect Mail Activity in Mail Is Enabled (Manual)
  platform: darwin
  description: |
    Verifies that Mail Privacy Protection is enabled in the Mail app. This feature hides IP address and prevents senders from knowing when emails are opened.
  resolution: |
    Graphical Method:
    1. Open Mail app
    2. Select Mail > Settings (or Preferences)
    3. Select Privacy tab
    4. Enable Protect Mail Activity
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:privacy, requirement:manual, critical:false, control:mail-protect-activity-enabled, cis_category:Applications, cis_subcategory:Mail, cis_safeguard_ids:CIS6.2.1
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.8 (L2) Audit AutoFill (Manual)
  platform: darwin
  description: |
    Audits Safari AutoFill settings. AutoFill can store sensitive information including passwords, credit cards, and contact info. Organizations should assess AutoFill usage against security policies.
  resolution: |
    Graphical Method:
    1. Open Safari
    2. Select Safari > Settings (or Preferences)
    3. Select AutoFill tab
    4. Review AutoFill settings for contacts, credit cards, usernames/passwords
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:2, platform:darwin, category:browser, requirement:manual, critical:false, control:safari-autofill-audit, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.8
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.3.10 (L1) Ensure Show Status Bar Is Enabled (Automated) [safari-popup-windows-audit]
  platform: darwin
  description: |
    Audits Safari pop-up window blocking settings. Pop-up blockers help prevent unwanted content and potential malicious pop-ups. Organizations should verify appropriate pop-up blocking is configured.
  resolution: |
    Graphical Method:
    1. Open Safari
    2. Select Safari > Settings (or Preferences)
    3. Select Websites tab
    4. Select Pop-up Windows
    5. Review pop-up blocking settings per website
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:browser, requirement:manual, critical:false, control:safari-popup-windows-audit, cis_category:Applications, cis_subcategory:Safari, cis_safeguard_ids:CIS6.3.10
  contributors: augment-agent
---
apiVersion: v1
kind: policy
spec:
  name: CIS 6.5.1 (L1) Audit Passwords (Manual)
  platform: darwin
  description: |
    Audits the Passwords app (formerly part of Keychain). Organizations should verify password management practices align with security policies and assess whether the built-in Passwords app is appropriate for credential storage.
  resolution: |
    Graphical Method:
    1. Open the Passwords app
    2. Review stored passwords and security recommendations
    3. Address any weak or compromised passwords flagged by the app
    Document findings per organizational policy.
  query: SELECT 1;
  purpose: Informational
  tags: framework:CISv8.1, benchmark:macosTahoe, level:1, platform:darwin, category:credentials, requirement:manual, critical:false, control:passwords-app-audit, cis_category:Applications, cis_subcategory:Passwords, cis_safeguard_ids:CIS6.5.1
  contributors: augment-agent